{% extends "base_topbar.html" %}
{% block title %}æ¨¡æ¿ä¸­å¿ƒ / Template Center{% endblock %}
{% block nav_header %}{% include "partials/nav.html" with nav_title="æ¨¡æ¿ä¸­å¿ƒ / Template Center" nav_subtitle="æŒ‰è§’è‰²ä¸é¡¹ç›®å…±äº«æ—¥æŠ¥ä¸ä»»åŠ¡æ¨¡æ¿ / Share report & task templates by role/project" %}{% endblock %}
{% block content %}
<div class="container" style="max-width:1100px;">
    <section style="margin:16px 0;padding:14px 16px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;">
        <form method="get" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;align-items:end;">
            <div>
                <label style="font-weight:700;font-size:13px;">å…³é”®è¯ / Keyword</label>
                <input type="text" name="q" value="{{ q }}" placeholder="æŒ‰åç§°/å†…å®¹æœç´¢ / Search by name or content" style="width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:10px;">
            </div>
            <div>
                <label style="font-weight:700;font-size:13px;">è§’è‰² / Role</label>
                <select name="role" style="width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:10px;">
                    <option value="">å…¨éƒ¨ / All</option>
                    {% for val,label in report_form.fields.role.choices %}
                        <option value="{{ val }}" {% if role_filter == val %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label style="font-weight:700;font-size:13px;">é¡¹ç›® / Project</label>
                <select name="project" style="width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:10px;">
                    <option value="">å…¨éƒ¨ / All</option>
                    {% for p in projects %}
                        <option value="{{ p.id }}" {% if project_filter == p.id %}selected{% endif %}>{{ p.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label style="font-weight:700;font-size:13px;">æ’åº / Sort</label>
                <select name="sort" style="width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:10px;">
                    <option value="version" {% if sort == 'version' %}selected{% endif %}>æŒ‰ç‰ˆæœ¬ / By version</option>
                    <option value="updated" {% if sort == 'updated' %}selected{% endif %}>æŒ‰æ›´æ–°æ—¶é—´ / By updated</option>
                </select>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button type="submit" class="btn btn-primary" style="padding:10px 14px;">ğŸ” ç­›é€‰ / Filter</button>
                <a href="{% url 'reports:template_center' %}" class="btn btn-ghost" style="padding:10px 14px;">é‡ç½® / Reset</a>
            </div>
        </form>
    </section>
    <section style="margin:24px 0;padding:18px 20px;border:1px solid #e2e8f0;border-radius:14px;background:#f8fafc;">
        <h1 style="margin:0 0 8px 0;font-size:20px;font-weight:800;">æ¨¡æ¿åˆ›å»º / Create template</h1>
        <p style="margin:0 0 14px 0;color:#475569;">æ”¯æŒé¡¹ç›®/è§’è‰²çš„å…±äº«æ¨¡æ¿ï¼Œå¹¶è‡ªåŠ¨è®°å½•ç‰ˆæœ¬ã€‚åŒè¯­æ–‡æ¡ˆ / Bilingual copy.</p>
        <p style="margin:0 0 8px 0;color:#475569;font-size:13px;">å½“å‰æ’åº / Current sort: {% if sort == 'updated' %}æŒ‰æ›´æ–°æ—¶é—´ / By updated{% else %}æŒ‰ç‰ˆæœ¬ / By version{% endif %}</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:16px;">
            <form method="post" action="" class="card" style="padding:14px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;">
                {% csrf_token %}
                <input type="hidden" name="action" value="report">
                <h3 style="margin:0 0 10px 0;">æ—¥æŠ¥æ¨¡æ¿ / Report template</h3>
                {{ report_form.as_p }}
                <button type="submit" class="btn btn-primary" style="margin-top:8px;">ä¿å­˜æ—¥æŠ¥æ¨¡æ¿ / Save report template</button>
            </form>
            <form method="post" action="" class="card" style="padding:14px;border:1px solid #e2e8f0;border-radius:12px;background:#fff;">
                {% csrf_token %}
                <input type="hidden" name="action" value="task">
                <h3 style="margin:0 0 10px 0;">ä»»åŠ¡æ¨¡æ¿ / Task template</h3>
                {{ task_form.as_p }}
                <button type="submit" class="btn btn-primary" style="margin-top:8px;">ä¿å­˜ä»»åŠ¡æ¨¡æ¿ / Save task template</button>
            </form>
        </div>
    </section>

    <section style="margin:24px 0;padding:18px 20px;border:1px solid #e2e8f0;border-radius:14px;background:#fff;">
        <h2 style="margin:0 0 12px 0;">æœ€æ–°æ¨¡æ¿ / Latest versions</h2>
        <p style="margin:0 0 12px 0;color:#64748b;font-size:13px;">ä¼˜å…ˆæ˜¾ç¤ºç¬¦åˆç­›é€‰æ¡ä»¶çš„æœ€æ–°ç‰ˆæœ¬ï¼›æœªåŒ¹é…æ—¶å¯å°è¯•æ¸…ç©ºç­›é€‰æˆ–æ›´æ¢é¡¹ç›®/è§’è‰²ã€‚ / Shows latest versions for current filters; clear or adjust filters if no match.</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px;">
            {% for tmpl in report_templates %}
            <article style="padding:12px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;">
                <div style="font-weight:700;">ğŸ“„ {{ tmpl.name }}</div>
                <div style="font-size:12px;color:#475569;">è§’è‰² / Role: {{ tmpl.get_role_display|default:"å…¨éƒ¨ / All" }} Â· é¡¹ç›® / Project: {{ tmpl.project.name|default:"å…¨å±€ / Global" }}</div>
                <div style="font-size:12px;color:#475569;">ç‰ˆæœ¬ / Version: v{{ tmpl.version }}</div>
                <div style="margin-top:6px;font-size:12px;color:#64748b;">{{ tmpl.content|truncatechars:120 }}</div>
            </article>
            {% empty %}
            <div style="color:#94a3b8;">æš‚æ— æ—¥æŠ¥æ¨¡æ¿ / No report template</div>
            {% endfor %}
        </div>
        {% if report_templates.has_other_pages %}
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap;font-size:13px;">
            {% if report_templates.has_previous %}<a class="btn btn-ghost" href="?rpage={{ report_templates.previous_page_number }}&q={{ q }}&role={{ role_filter }}&project={{ project_filter }}&sort={{ sort }}">ä¸Šä¸€é¡µ / Prev</a>{% endif %}
            <span class="chip">ç¬¬ {{ report_templates.number }} / {{ report_templates.paginator.num_pages }} é¡µ / Page</span>
            {% if report_templates.has_next %}<a class="btn btn-ghost" href="?rpage={{ report_templates.next_page_number }}&q={{ q }}&role={{ role_filter }}&project={{ project_filter }}&sort={{ sort }}">ä¸‹ä¸€é¡µ / Next</a>{% endif %}
            <form method="get" style="display:flex;gap:6px;align-items:center;">
                <input type="hidden" name="q" value="{{ q }}">
                <input type="hidden" name="role" value="{{ role_filter }}">
                <input type="hidden" name="project" value="{{ project_filter }}">
                <input type="hidden" name="sort" value="{{ sort }}">
                <label style="font-size:12px;color:#475569;">è·³è½¬ / Jump</label>
                <input type="number" name="rpage" min="1" max="{{ report_templates.paginator.num_pages }}" style="width:70px;padding:6px 8px;border:1px solid #e2e8f0;border-radius:8px;">
                <button class="btn btn-ghost" type="submit" style="padding:8px 10px;">Go</button>
            </form>
        </div>
        {% endif %}
        <h3 style="margin:16px 0 10px 0;">ä»»åŠ¡æ¨¡æ¿ / Task templates</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px;">
            {% for tmpl in task_templates %}
            <article style="padding:12px;border:1px solid #e2e8f0;border-radius:10px;background:#f8fafc;">
                <div style="font-weight:700;">âœ… {{ tmpl.name }}</div>
                <div style="font-size:12px;color:#475569;">è§’è‰² / Role: {{ tmpl.get_role_display|default:"å…¨éƒ¨ / All" }} Â· é¡¹ç›® / Project: {{ tmpl.project.name|default:"å…¨å±€ / Global" }}</div>
                <div style="font-size:12px;color:#475569;">ç‰ˆæœ¬ / Version: v{{ tmpl.version }}</div>
                <div style="margin-top:6px;font-size:12px;color:#64748b;">{{ tmpl.title }} â€” {{ tmpl.content|truncatechars:120 }}</div>
            </article>
            {% empty %}
            <div style="color:#94a3b8;">æš‚æ— ä»»åŠ¡æ¨¡æ¿ / No task template</div>
            {% endfor %}
        </div>
        {% if task_templates.has_other_pages %}
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap;font-size:13px;">
            {% if task_templates.has_previous %}<a class="btn btn-ghost" href="?tpage={{ task_templates.previous_page_number }}&q={{ q }}&role={{ role_filter }}&project={{ project_filter }}&sort={{ sort }}">ä¸Šä¸€é¡µ / Prev</a>{% endif %}
            <span class="chip">ç¬¬ {{ task_templates.number }} / {{ task_templates.paginator.num_pages }} é¡µ / Page</span>
            {% if task_templates.has_next %}<a class="btn btn-ghost" href="?tpage={{ task_templates.next_page_number }}&q={{ q }}&role={{ role_filter }}&project={{ project_filter }}&sort={{ sort }}">ä¸‹ä¸€é¡µ / Next</a>{% endif %}
            <form method="get" style="display:flex;gap:6px;align-items:center;">
                <input type="hidden" name="q" value="{{ q }}">
                <input type="hidden" name="role" value="{{ role_filter }}">
                <input type="hidden" name="project" value="{{ project_filter }}">
                <input type="hidden" name="sort" value="{{ sort }}">
                <label style="font-size:12px;color:#475569;">è·³è½¬ / Jump</label>
                <input type="number" name="tpage" min="1" max="{{ task_templates.paginator.num_pages }}" style="width:70px;padding:6px 8px;border:1px solid #e2e8f0;border-radius:8px;" required>
                <button class="btn btn-ghost" type="submit" style="padding:8px 10px;">Go</button>
            </form>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}
