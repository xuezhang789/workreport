{% extends "base_topbar.html" %}
{% load tz %}
{% block title %}绩效看板 / Performance Board{% endblock %}
{% block nav_header %}{% include "partials/nav.html" with nav_title="绩效与统计看板 / Performance & Stats" nav_subtitle="项目与角色完成率、逾期率、连签趋势 / Completion, overdue, streak insights" %}{% endblock %}
{% block extra_styles %}
        :root {
            /* 现代化设计系统 - 增强版本 */
            --primary: #2563eb;
            --primary-2: #3b82f6;
            --primary-3: #60a5fa;
            --accent: #06b6d4;
            --accent-2: #0891b2;
            --success: #10b981;
            --success-2: #059669;
            --warning: #f59e0b;
            --warning-2: #d97706;
            --danger: #ef4444;
            --danger-2: #dc2626;
            --info: #8b5cf6;
            --info-2: #7c3aed;
            --bg-card: rgba(255, 255, 255, 0.98);
            --bg-section: rgba(248, 250, 252, 0.9);
            --bg-glass: rgba(255, 255, 255, 0.8);
            --bg-glass-heavy: rgba(255, 255, 255, 0.95);
            --border-light: rgba(226, 232, 240, 0.7);
            --border-hover: rgba(59, 130, 246, 0.4);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-radius: 24px;
            --border-radius-sm: 16px;
            --border-radius-xs: 12px;
            --card-spacing: 24px;
            --shadow-sm: 0 4px 24px rgba(15, 23, 42, 0.08);
            --shadow-md: 0 8px 32px rgba(15, 23, 42, 0.12);
            --shadow-lg: 0 12px 48px rgba(15, 23, 42, 0.18);
            --shadow-xl: 0 20px 80px rgba(15, 23, 42, 0.25);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-smooth: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        * {
            box-sizing: border-box;
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
            .data-visualization-section,
            .chart-card,
            .control-panel {
                backdrop-filter: none !important;
                box-shadow: none !important;
            }
        }

        body {
            margin: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                linear-gradient(135deg, #f8fafc 0%, #e2e8f0 30%, #f1f5f9 60%, #f8fafc 100%);
            background-attachment: fixed;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 35px,
                    rgba(255, 255, 255, 0.02) 35px,
                    rgba(255, 255, 255, 0.02) 70px
                );
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
        }

        .performance-shell {
            display: grid;
            gap: var(--card-spacing);
            animation: fadeInUp 0.8s ease-out;
            grid-template-columns: 1fr;
        }

        /* 统一卡片栅格：保证表格区块宽度充足且可自适应 */
        .grid-hybrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: var(--card-spacing);
        }
        @media (min-width: 1200px) {
            .grid-hybrid {
                grid-template-columns: repeat(auto-fit, minmax(720px, 1fr));
            }
        }

        /* 响应式网格布局系统 */
        .performance-shell > .guidance-banner {
            grid-column: 1 / -1;
        }

        .performance-shell > .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--card-spacing);
        }

        /* 平板设备优化 */
        @media (min-width: 768px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .trend-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .date-inputs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-panel {
                position: relative;
                top: 0;
            }
        }

        /* 桌面设备优化 */
        @media (min-width: 1024px) {
            .metrics-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .trend-grid {
                grid-template-columns: repeat(7, 1fr);
            }
        }

        /* 大屏设备优化 */
        @media (min-width: 1200px) {
            .performance-shell > .grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .performance-shell > .grid > section:first-child {
                grid-column: 1 / -1;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .control-panel {
                position: sticky;
                top: 24px;
                max-height: calc(100vh - 48px);
                overflow-y: auto;
            }
        }

        /* 超大屏设备优化 */
        @media (min-width: 1600px) {
            .container {
                max-width: 1800px;
            }
            
            .main-content-grid {
                grid-template-columns: 3fr 2fr;
                gap: 32px;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 28px;
            }
        }

        /* 超宽屏优化 */
        @media (min-width: 1920px) {
            .container {
                max-width: 2000px;
            }
            
            .date-inputs-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 24px;
            }
        }

        /* 新的响应式主网格布局 */
        .main-content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--card-spacing);
            margin-top: var(--card-spacing);
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: var(--card-spacing);
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: var(--card-spacing);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (min-width: 1200px) {
            .main-content-grid {
                grid-template-columns: 1fr; /* 保持单列，确保表格宽度充足、数据不被挤压 */
            }
        }

        @media (min-width: 1600px) {
            .main-content-grid {
                grid-template-columns: 1fr;
            }
        }

        /* 优化的数据可视化区域 */
        .data-visualization-section {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(6, 182, 212, 0.02), rgba(37, 99, 235, 0.02));
            backdrop-filter: blur(30px) saturate(1.2);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 32px;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .data-visualization-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--accent), var(--primary), var(--info));
            opacity: 0.8;
        }

        .data-visualization-section:hover {
            transform: translateY(-4px);
            box-shadow: 
                var(--shadow-xl),
                0 0 0 1px rgba(6, 182, 212, 0.2);
            border-color: var(--border-hover);
        }

        /* 增强的表格响应式设计 */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: var(--border-radius-sm);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            background: rgba(255, 255, 255, 0.5);
            padding: 2px;
        }

        .table-responsive::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        .table-responsive::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--primary-2));
            border-radius: 4px;
        }

        /* 改进的控制面板样式 */
        .control-panel {
            background: 
                linear-gradient(135deg, var(--bg-glass-heavy), var(--bg-card)),
                linear-gradient(135deg, rgba(37, 99, 235, 0.02), rgba(6, 182, 212, 0.02));
            backdrop-filter: blur(25px) saturate(1.15);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 24px;
            transition: var(--transition-smooth);
            position: sticky;
            top: 24px;
            z-index: 10;
            max-height: calc(100vh - 48px);
            overflow-y: auto;
        }

        .control-panel:hover {
            border-color: var(--border-hover);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        /* 优化的数据可视化卡片 */
        .chart-card {
            background: 
                linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95)),
                linear-gradient(135deg, rgba(99, 102, 241, 0.02), rgba(139, 92, 246, 0.02));
            backdrop-filter: blur(20px) saturate(1.1);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .chart-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(99, 102, 241, 0.03) 50%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .chart-card:hover::before {
            opacity: 1;
        }

        .chart-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                var(--shadow-lg),
                0 0 0 1px rgba(99, 102, 241, 0.15);
            border-color: var(--border-hover);
        }

        /* 增强的数据表格样式 */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .data-table thead {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(6, 182, 212, 0.06));
            backdrop-filter: blur(10px);
        }

        .data-table th {
            padding: 16px 12px;
            text-align: left;
            font-weight: 700;
            font-size: 13px;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-light);
            letter-spacing: 0.02em;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            background: inherit;
            z-index: 5;
        }
        @media (max-width: 768px) {
            .data-table th {
                position: static;
            }
        }

        .data-table td {
            padding: 14px 12px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .data-table tbody tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .data-table tbody tr:hover {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.04), rgba(6, 182, 212, 0.02));
            transform: translateX(4px);
        }

        .data-table tbody tr:hover td {
            color: var(--text-primary);
            border-bottom-color: rgba(37, 99, 235, 0.2);
        }

        /* 数值高亮显示 */
        .value-highlight {
            font-weight: 700;
            position: relative;
            display: inline-block;
        }

        .value-success {
            color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
            padding: 2px 6px;
            border-radius: 4px;
        }

        .value-warning {
            color: var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));
            padding: 2px 6px;
            border-radius: 4px;
        }

        .value-danger {
            color: var(--danger);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* 数据展示区优化 */
        .data-display-area {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass)),
                linear-gradient(135deg, rgba(99, 102, 241, 0.01), rgba(139, 92, 246, 0.01));
            backdrop-filter: blur(20px) saturate(1.1);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 28px;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .data-display-area::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(99, 102, 241, 0.03), transparent);
            animation: rotate 20s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        /* 统一的分区标题、标签与操作区 */
        .section-head {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
            margin: 0 0 18px;
        }

        .section-head .title-block {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .section-eyebrow {
            margin: 0;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .section-note {
            margin: 0;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .section-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .pill-soft {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 999px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(6, 182, 212, 0.06));
            border: 1px solid rgba(37, 99, 235, 0.2);
            font-size: 12px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.04em;
        }

        .pill-soft.pill-compact {
            padding: 6px 10px;
            gap: 6px;
            font-size: 11px;
            letter-spacing: 0.02em;
        }

        /* 表格工具条 */
        .table-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .table-toolbar .notes {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            color: var(--text-secondary);
            font-size: 13px;
            align-items: center;
        }

        .table-toolbar .notes strong {
            color: var(--text-primary);
        }

        /* 表格卡片内边距和阴影微调 */
        .table-card {
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            background: var(--bg-card);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200% center;
            }
            100% {
                background-position: 200% center;
            }
        }

        /* 增强的加载动画 */
        .loading-skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.1) 25%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0.1) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--border-radius-sm);
        }

        /* 延迟动画效果 */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }

        /* 页面元素进入动画 */
        .fade-in-up {
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
        }

        .slide-in-left {
            animation: slideInLeft 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
        }

        .slide-in-right {
            animation: slideInRight 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
        }

        .scale-in {
            animation: scaleIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
            opacity: 0;
        }

        /* 增强的智能引导区域样式 */
        .guidance-banner {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(99, 102, 241, 0.02), rgba(6, 182, 212, 0.02));
            backdrop-filter: blur(30px) saturate(1.2);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 40px;
            margin-bottom: var(--card-spacing);
            box-shadow: 
                var(--shadow-lg),
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideInDown 0.8s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .guidance-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: 
                linear-gradient(90deg, 
                    var(--primary) 0%, 
                    var(--primary-2) 20%, 
                    var(--accent) 40%, 
                    var(--success) 60%, 
                    var(--warning) 80%, 
                    var(--info) 100%);
            opacity: 0.9;
            animation: gradientShift 4s ease-in-out infinite;
            background-size: 200% 100%;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .guidance-banner::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.3; }
        }

        .guidance-banner:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 
                var(--shadow-xl),
                0 0 0 1px rgba(99, 102, 241, 0.2);
            border-color: var(--border-hover);
        }

        .guidance-banner-content {
            display: grid;
            grid-template-columns: minmax(0, 1.8fr) minmax(0, 1fr);
            gap: 32px;
            align-items: center;
        }

        .guidance-content h1 {
            margin: 0 0 16px;
            font-size: clamp(28px, 4vw, 36px);
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1.2;
            background: linear-gradient(135deg, var(--text-primary), #334155);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .guidance-content .lede {
            margin: 0 0 12px;
            color: var(--text-secondary);
            font-size: 16px;
            line-height: 1.6;
        }

        .guidance-meta {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .guidance-meta .lede {
            font-size: 14px;
            color: var(--text-muted);
        }

        .guidance-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: stretch;
            justify-content: center;
        }

        /* 增强的按钮系统 */
        .btn {
            border: none;
            border-radius: var(--border-radius-xs);
            padding: 14px 24px;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-family: inherit;
            letter-spacing: 0.02em;
            text-transform: none;
            white-space: nowrap;
            user-select: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, transparent, rgba(0, 0, 0, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover::after {
            opacity: 1;
        }

        .btn:active {
            transform: translateY(2px) scale(0.96);
        }

        .btn-primary {
            background: 
                linear-gradient(135deg, var(--primary), var(--primary-2), var(--primary-3)),
                linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(59, 130, 246, 0.9));
            color: #fff;
            box-shadow: 
                0 4px 20px rgba(37, 99, 235, 0.35),
                0 2px 8px rgba(37, 99, 235, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary:hover {
            box-shadow: 
                0 8px 32px rgba(37, 99, 235, 0.45),
                0 4px 16px rgba(37, 99, 235, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transform: translateY(-4px) scale(1.02);
        }

        .btn-secondary {
            background: 
                linear-gradient(135deg, rgba(255, 255, 255, 0.98), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(248, 250, 252, 0.9), rgba(241, 245, 249, 0.8));
            color: var(--text-primary);
            border: 2px solid var(--border-light);
            box-shadow: 
                var(--shadow-sm),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .btn-secondary:hover {
            background: 
                linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(248, 250, 252, 0.98)),
                linear-gradient(135deg, rgba(248, 250, 252, 0.95), rgba(241, 245, 249, 0.9));
            box-shadow: 
                var(--shadow-md),
                0 0 0 1px rgba(99, 102, 241, 0.1);
            transform: translateY(-4px) scale(1.02);
            border-color: var(--border-hover);
        }

        .btn-lg {
            padding: 18px 28px;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 0.02em;
            border-radius: var(--border-radius-sm);
        }

        .btn-accent {
            background: 
                linear-gradient(135deg, var(--accent), var(--accent-2)),
                linear-gradient(135deg, rgba(6, 182, 212, 0.9), rgba(8, 145, 178, 0.9));
            color: #fff;
            box-shadow: 
                0 4px 20px rgba(6, 182, 212, 0.35),
                0 2px 8px rgba(6, 182, 212, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-accent:hover {
            box-shadow: 
                0 8px 32px rgba(6, 182, 212, 0.45),
                0 4px 16px rgba(6, 182, 212, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transform: translateY(-4px) scale(1.02);
        }

        .btn-warning {
            background: 
                linear-gradient(135deg, var(--warning), var(--warning-2)),
                linear-gradient(135deg, rgba(245, 158, 11, 0.9), rgba(217, 119, 6, 0.9));
            color: #fff;
            box-shadow: 
                0 4px 20px rgba(245, 158, 11, 0.35),
                0 2px 8px rgba(245, 158, 11, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-warning:hover {
            box-shadow: 
                0 8px 32px rgba(245, 158, 11, 0.45),
                0 4px 16px rgba(245, 158, 11, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            transform: translateY(-4px) scale(1.02);
        }

        .action-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* 日期过滤器样式 */
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            padding: 0;
            margin: 8px 0;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-group label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .filter-group input[type="date"] {
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            font-size: 14px;
            background: linear-gradient(135deg, var(--bg-card), var(--bg-glass));
            color: var(--text-primary);
            outline: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 180px;
            font-family: inherit;
        }

        .filter-group input[type="date"]:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
            background: #fff;
            transform: translateY(-2px);
        }

        .filter-group input[type="date"]:hover {
            border-color: var(--border-hover);
            transform: translateY(-1px);
        }

        .filter-actions {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-ghost {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.06), rgba(15, 23, 42, 0.03));
            color: var(--text-primary);
            border: 1px solid rgba(15, 23, 42, 0.1);
            backdrop-filter: blur(10px);
        }

        .btn-ghost:hover {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.1), rgba(15, 23, 42, 0.06));
            border-color: var(--border-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* 增强的日期范围过滤器样式 */
        .date-range-filter {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-glass));
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 24px;
            margin: 16px 0;
            box-shadow: var(--shadow-md);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .date-range-filter:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .date-range-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .date-range-header h3 {
            margin: 0 0 8px;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .date-range-subtitle {
            margin: 0;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .date-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .date-input-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.6));
            border: 2px solid var(--border-light);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .date-input-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-2));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .date-input-card:hover::before {
            opacity: 1;
        }

        .date-input-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-hover);
        }

        .date-input-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .date-icon {
            font-size: 20px;
            line-height: 1;
        }

        .date-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .date-input-wrapper {
            position: relative;
        }

        .date-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--text-primary);
            outline: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            min-height: 44px;
        }

        .date-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
            background: #fff;
            transform: translateY(-1px);
        }

        .date-input:hover {
            border-color: var(--border-hover);
        }

        .date-input-hint {
            display: block;
            margin-top: 6px;
            font-size: 12px;
            color: var(--text-muted);
            font-style: italic;
        }

        .date-range-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .secondary-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .secondary-actions .btn {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
        }

        /* 增强的统一卡片系统 */
        .section-card {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(99, 102, 241, 0.01), rgba(6, 182, 212, 0.01));
            backdrop-filter: blur(25px) saturate(1.15);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            box-shadow: 
                var(--shadow-md),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            padding: 32px;
            margin-bottom: var(--card-spacing);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-2), var(--accent), var(--info));
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .section-card::after {
            content: '';
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.4s ease;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        .section-card:hover::before {
            opacity: 0.9;
        }

        .section-card:hover::after {
            opacity: 1;
        }

        .section-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 
                var(--shadow-xl),
                0 0 0 1px rgba(99, 102, 241, 0.1),
                0 0 40px rgba(99, 102, 241, 0.08);
            border-color: var(--border-hover);
        }

        .section-card h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .section-card h3 {
            margin: 0 0 20px;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            position: relative;
            z-index: 1;
        }

        /* 卡片内容区域增强 */
        .section-card-content {
            position: relative;
            z-index: 1;
        }

        /* 增强的指标网格系统 */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            position: relative;
        }

        .metric-card {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(99, 102, 241, 0.02), rgba(6, 182, 212, 0.02));
            backdrop-filter: blur(20px) saturate(1.1);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 28px 22px;
            text-align: left;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-2), var(--primary-3));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .metric-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .metric-card:hover {
            transform: translateY(-8px) scale(1.04);
            box-shadow: 
                var(--shadow-xl),
                0 0 0 1px rgba(99, 102, 241, 0.15),
                0 0 40px rgba(99, 102, 241, 0.1);
            border-color: var(--border-hover);
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            position: relative;
            z-index: 1;
        }

        .metric-value {
            margin: 0;
            font-size: 38px;
            font-weight: 900;
            background: 
                linear-gradient(135deg, var(--primary), var(--primary-2), var(--primary-3)),
                linear-gradient(135deg, var(--primary), var(--primary-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            transition: var(--transition-bounce);
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .metric-card:hover .metric-value {
            transform: scale(1.08) translateY(-2px);
        }

        .metric-card.danger .metric-value {
            background: 
                linear-gradient(135deg, var(--danger), var(--danger-2), #f87171),
                linear-gradient(135deg, var(--danger), var(--danger-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-card.danger::before {
            background: linear-gradient(90deg, var(--danger), var(--danger-2), #f87171);
        }

        .metric-card.danger:hover::after {
            background: radial-gradient(circle, rgba(239, 68, 68, 0.08) 0%, transparent 70%);
        }

        .metric-card.success .metric-value {
            background: 
                linear-gradient(135deg, var(--success), var(--success-2), #34d399),
                linear-gradient(135deg, var(--success), var(--success-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-card.success::before {
            background: linear-gradient(90deg, var(--success), var(--success-2), #34d399);
        }

        .metric-card.success:hover::after {
            background: radial-gradient(circle, rgba(16, 185, 129, 0.08) 0%, transparent 70%);
        }

        /* 指标卡片发光效果 */
        .metric-card.glow {
            animation: glowPulse 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { 
                box-shadow: var(--shadow-lg);
            }
            50% { 
                box-shadow: 
                    var(--shadow-lg),
                    0 0 30px rgba(99, 102, 241, 0.3);
            }
        }

        /* 增强的表格系统 */
        .table-responsive {
            overflow-x: auto;
            overflow-y: hidden;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            background: var(--bg-card);
            max-width: 100%;
            width: 100%;
            scrollbar-gutter: stable both-edges;
            /* 设置最小宽度确保表格正确显示 */
            min-width: 100%;
        }

        /* 完成率表统一列宽：保证表头与数据对齐 */
        .table-fixed.completion-table col.col-wide { width: auto; }
        .table-fixed.completion-table col.col-narrow { width: auto; }

        /* 优化列宽分配，防止溢出并保持对齐 */
        .table-fixed th.col-wide,
        .table-fixed td.col-wide {
            width: auto;
            min-width: 160px;
            max-width: 240px;
            word-wrap: break-word;
            word-break: break-word;
            text-align: left;
        }
        .table-fixed th.col-narrow,
        .table-fixed td.col-narrow {
            width: auto;
            min-width: 100px;
            max-width: 150px;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 14px 12px;
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum";
        }

        /* 针对长文本列的特殊处理 */
        .table-fixed th.col-wide:first-child,
        .table-fixed td.col-wide:first-child {
            text-align: left;
            word-wrap: break-word;
            white-space: normal;
            line-height: 1.4;
            padding-left: 14px;
            padding-right: 14px;
            font-weight: 700;
        }

        /* 表格单元格对齐优化 */
        .table-fixed td {
            vertical-align: middle;
            line-height: 1.4;
        }

        /* 百分比和数值的特殊对齐 */
        .table-fixed th.col-narrow:nth-child(n+2):nth-child(-n+9),
        .table-fixed td.col-narrow:nth-child(n+2):nth-child(-n+9) {
            text-align: left !important;
            padding-right: 12px;
        }

        /* 表格行高一致性 */
        .table-fixed tbody tr {
            min-height: 56px;
            transition: all 0.3s ease;
        }

        /* 表格边框和分隔线优化 */
        .table-fixed tbody tr:not(:last-child) td {
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        /* 表格悬停效果优化 */
        .table-fixed tbody tr:hover td {
            background-color: rgba(99, 102, 241, 0.04);
            color: var(--primary);
            font-weight: 500;
        }

        /* 防止表格内容溢出的额外措施 */
        .table-responsive {
            overflow-x: auto;
            overflow-y: visible;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: rgba(99, 102, 241, 0.3) transparent;
        }

        .table-responsive::-webkit-scrollbar {
            height: 8px;
        }

        .table-responsive::-webkit-scrollbar-track {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 4px;
        }

        .table-responsive::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.5);
        }

        /* 百分比列的特殊样式 */
        .table-fixed th.col-narrow:nth-child(5),
        .table-fixed th.col-narrow:nth-child(6),
        .table-fixed th.col-narrow:nth-child(7),
        .table-fixed td.col-narrow:nth-child(5),
        .table-fixed td.col-narrow:nth-child(6),
        .table-fixed td.col-narrow:nth-child(7) {
            min-width: 78px;
            font-weight: 600;
        }

        /* 时间数值列的特殊样式 */
        .table-fixed th.col-narrow:nth-child(8),
        .table-fixed th.col-narrow:nth-child(9),
        .table-fixed td.col-narrow:nth-child(8),
        .table-fixed td.col-narrow:nth-child(9) {
            min-width: 88px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--bg-card);
            border-spacing: 0;
        }

        /* 固定布局，避免列宽漂移导致错位 */
        .table-fixed {
            table-layout: auto;
            width: 100%;
            min-width: 880px; /* 确保表格有足够的最小宽度，避免数据挤压缺失 */
            width: max(100%, 880px);
        }

        /* 确保单元格不被压缩导致数据缺失 */
        .table-fixed th,
        .table-fixed td {
            min-width: 0;
        }

        .table th, .table td {
            padding: 16px 14px;
            border-bottom: 1px solid var(--border-light);
            text-align: left;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .table th {
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 12px;
            font-weight: 800;
            background: 
                linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(6, 182, 212, 0.08)),
                linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(6, 182, 212, 0.05));
            border-bottom: 2px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        /* 窄列与数据左对齐 */
        .table th.col-narrow {
            text-align: left;
        }

        .table td.col-narrow {
            text-align: left;
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum";
        }

        .table td.col-wide {
            font-weight: 600;
        }

        .table th::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
            opacity: 0.6;
        }

        .table tbody tr {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .table tbody tr::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary), var(--accent));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .table tbody tr:hover {
            background: 
                linear-gradient(135deg, rgba(99, 102, 241, 0.04), rgba(6, 182, 212, 0.04)),
                linear-gradient(135deg, rgba(37, 99, 235, 0.02), rgba(6, 182, 212, 0.02));
            transform: translateX(4px) scale(1.01);
        }

        .table tbody tr:hover::before {
            opacity: 1;
        }

        .table tbody tr:hover td {
            color: var(--primary);
            font-weight: 500;
        }

        .table tbody tr:nth-child(even) {
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.3), rgba(241, 245, 249, 0.2));
        }

        /* 响应式表格优化 */
        @media (max-width: 1400px) {
            .table-fixed {
                min-width: 820px;
            }
            .table-fixed th.col-wide,
            .table-fixed td.col-wide {
                min-width: 140px;
                max-width: 220px;
            }
            .table-fixed th.col-narrow,
            .table-fixed td.col-narrow {
                min-width: 90px;
                max-width: 130px;
                padding: 14px 10px;
            }
        }

        @media (max-width: 1200px) {
            .table-fixed {
                min-width: 780px;
            }
            .table-fixed th.col-wide,
            .table-fixed td.col-wide {
                min-width: 130px;
                max-width: 200px;
            }
            .table-fixed th.col-narrow,
            .table-fixed td.col-narrow {
                min-width: 82px;
                max-width: 120px;
                padding: 12px 8px;
            }
        }

        @media (max-width: 768px) {
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .table, .table thead, .table tbody, .table th, .table td, .table tr {
                display: block;
                width: 100%;
            }

            .table thead {
                display: none;
            }

            .table tr {
                margin-bottom: 16px;
                border: 1px solid var(--border-light);
                border-radius: var(--border-radius-sm);
                background: var(--bg-card);
                padding: 16px;
                box-shadow: var(--shadow-sm);
            }

            .table td {
                border: none;
                padding: 8px 0;
                position: relative;
                padding-left: 140px;
                min-height: 32px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .table td::before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                top: 8px;
                font-size: 11px;
                color: var(--text-muted);
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.04em;
                width: 130px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 1.2;
            }

            .table td:first-child {
                padding-left: 0;
                font-weight: 600;
                color: var(--text-primary);
                font-size: 14px;
            }

            .table td:first-child::before {
                display: none;
            }

            /* 移动端数值对齐优化 */
            .table td:nth-child(n+2):nth-child(-n+9) {
                justify-content: flex-end;
                font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
                font-weight: 500;
            }

            .grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        /* 增强的趋势网格系统 */
        .trend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
            position: relative;
        }

        .trend-card {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(139, 92, 246, 0.02), rgba(99, 102, 241, 0.02));
            backdrop-filter: blur(16px) saturate(1.1);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 20px 16px;
            text-align: center;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .trend-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--info), var(--info-2), var(--primary));
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .trend-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .trend-card:hover::before {
            opacity: 0.8;
        }

        .trend-card:hover::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .trend-card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 
                var(--shadow-lg),
                0 0 0 1px rgba(139, 92, 246, 0.15),
                0 0 30px rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .trend-date {
            font-size: 12px;
            color: var(--text-muted);
            margin: 0 0 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            position: relative;
            z-index: 1;
        }

        .trend-value {
            font-size: 32px;
            font-weight: 800;
            background: 
                linear-gradient(135deg, var(--info), var(--info-2), var(--primary)),
                linear-gradient(135deg, var(--info), var(--info-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 8px;
            line-height: 1.1;
            transition: var(--transition-bounce);
            position: relative;
            z-index: 1;
        }

        .trend-card:hover .trend-value {
            transform: scale(1.1);
        }

        .trend-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            line-height: 1.3;
        }

        .trend-bar {
            position: relative;
            height: 10px;
            border-radius: 999px;
            background: rgba(37, 99, 235, 0.08);
            overflow: hidden;
            margin-top: 8px;
        }

        .trend-bar span {
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            box-shadow: 0 6px 14px rgba(37, 99, 235, 0.25);
            border-radius: 999px;
        }

        /* 趋势卡片动画效果 */
        .trend-card.highlight {
            animation: trendHighlight 0.6s ease-out;
        }

        @keyframes trendHighlight {
            0% { 
                transform: scale(1);
                box-shadow: var(--shadow-md);
            }
            50% { 
                transform: scale(1.05) translateY(-8px);
                box-shadow: 
                    var(--shadow-xl),
                    0 0 30px rgba(139, 92, 246, 0.4);
            }
            100% { 
                transform: scale(1) translateY(0);
                box-shadow: var(--shadow-md);
            }
        }

        /* 增强的连签网格系统 */
        .streak-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(720px, 1fr));
            gap: 28px;
        }

        .grid > .section-card {
            min-width: 0; /* 防止表格宽度撑破网格布局 */
        }

        .streak-card {
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(245, 158, 11, 0.02), rgba(251, 191, 36, 0.02));
            backdrop-filter: blur(16px) saturate(1.1);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 24px 20px;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .streak-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--warning), var(--warning-2), #fbbf24);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .streak-card::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(245, 158, 11, 0.08) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .streak-card:hover::before {
            opacity: 0.8;
        }

        .streak-card:hover::after {
            transform: translate(-50%, -50%) scale(1);
        }

        .streak-card:hover {
            transform: translateY(-6px) scale(1.03);
            box-shadow: 
                var(--shadow-lg),
                0 0 0 1px rgba(245, 158, 11, 0.15),
                0 0 30px rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
        }

        .streak-role {
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--warning), var(--warning-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 12px;
            position: relative;
            z-index: 1;
        }

        .streak-stats {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
            line-height: 1.5;
        }

        .streak-stats strong {
            color: var(--warning);
            font-weight: 700;
        }

        /* 连签卡片火焰动画 */
        .streak-card.fire-effect::before {
            content: '🔥';
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 20px;
            animation: flame 1s ease-in-out infinite alternate;
        }

        @keyframes flame {
            0% { transform: scale(1) rotate(-5deg); }
            100% { transform: scale(1.1) rotate(5deg); }
        }

        /* SLA 任务列表卡片样式 */
        .sla-task-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sla-task-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-glass));
            backdrop-filter: blur(16px);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .sla-task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-2));
            opacity: 0.6;
        }

        .sla-task-card.sla-danger::before {
            background: linear-gradient(90deg, var(--danger), #f87171);
            opacity: 0.8;
        }

        .sla-task-card.sla-warning::before {
            background: linear-gradient(90deg, var(--warning), #fbbf24);
            opacity: 0.8;
        }

        .sla-task-card.sla-overdue::before {
            background: linear-gradient(90deg, #1e293b, #475569);
            opacity: 0.8;
        }

        .sla-task-card.sla-danger {
            border-color: rgba(239, 68, 68, 0.3);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), var(--bg-glass));
        }

        .sla-task-card.sla-warning {
            border-color: rgba(245, 158, 11, 0.3);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), var(--bg-glass));
        }

        .sla-task-card.sla-overdue {
            border-color: rgba(30, 41, 59, 0.3);
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.05), var(--bg-glass));
        }

        .sla-task-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }

        .sla-task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 12px;
        }

        .sla-task-title {
            flex: 1;
            min-width: 0;
        }

        .sla-task-title .task-link {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            line-height: 1.4;
            display: block;
            transition: color 0.3s ease;
        }

        .sla-task-title .task-link:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        .sla-level-badge .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            white-space: nowrap;
        }

        .badge-danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(248, 113, 113, 0.1));
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .badge-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(251, 191, 36, 0.1));
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-overdue {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.15), rgba(71, 85, 105, 0.1));
            color: var(--text-primary);
            border: 1px solid rgba(30, 41, 59, 0.3);
        }

        .sla-task-details {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .sla-task-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(226, 232, 240, 0.3);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .info-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
            text-align: right;
        }

        .text-danger {
            color: var(--danger) !important;
        }

        .text-warning {
            color: var(--warning) !important;
        }

        .text-overdue {
            color: var(--text-primary) !important;
        }

        .sla-task-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid rgba(226, 232, 240, 0.4);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
        }

        .due-time {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* 筛选条件可视化卡片 */
        .filter-summary-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)), linear-gradient(135deg, rgba(37, 99, 235, 0.03), rgba(6, 182, 212, 0.03));
            backdrop-filter: blur(25px) saturate(1.2);
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: var(--card-spacing);
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .filter-summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-2), var(--accent));
            opacity: 0.8;
            animation: gradientShift 3s ease-in-out infinite;
        }

        .filter-summary-content {
            position: relative;
            z-index: 1;
        }

        .filter-summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .filter-summary-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.08));
            color: var(--primary);
            border: 1px solid rgba(37, 99, 235, 0.2);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .filter-tag::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .filter-tag:hover::before {
            left: 100%;
        }

        .filter-tag:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(59, 130, 246, 0.12));
        }

        .filter-tag .remove-filter {
            cursor: pointer;
            font-size: 16px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .filter-tag .remove-filter:hover {
            opacity: 1;
        }

        .filter-tag.type-date {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(99, 102, 241, 0.08));
            color: var(--info);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .filter-tag.type-date:hover {
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }

        .filter-tag.type-mode {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.08));
            color: var(--warning);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .filter-tag.type-mode:hover {
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .no-filters {
            color: var(--text-muted);
            font-size: 14px;
            font-style: italic;
            padding: 12px 0;
        }

        /* 数据模块筛选标注 */
        .data-section {
            position: relative;
            border-left: 4px solid transparent;
            transition: border-color 0.3s ease;
        }

        .data-section.filtered {
            border-left-color: var(--primary);
        }

        .section-filter-info {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(59, 130, 246, 0.08));
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border: 1px solid rgba(37, 99, 235, 0.2);
            z-index: 2;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .section-filter-info:hover {
            opacity: 1;
        }

        /* 数据联动效果 */
        .interactive-data {
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .interactive-data::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, var(--primary), var(--accent), var(--success));
            border-radius: inherit;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
            filter: blur(8px);
        }

        .interactive-data:hover::after {
            opacity: 0.3;
        }

        .interactive-data:hover {
            transform: translateY(-2px) scale(1.02);
            z-index: 1;
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15);
        }

        .interactive-data.selected {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(59, 130, 246, 0.12));
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
        }

        /* 数据加载动画 */
        .data-updating {
            position: relative;
            overflow: hidden;
        }

        .data-updating::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.1), transparent);
            animation: dataLoading 1.5s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes dataLoading {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .data-updating * {
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        /* 增强的空状态样式 */
        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: var(--text-secondary);
            background: 
                linear-gradient(135deg, var(--bg-card), var(--bg-glass-heavy)),
                linear-gradient(135deg, rgba(139, 92, 246, 0.02), rgba(99, 102, 241, 0.02));
            backdrop-filter: blur(16px) saturate(1.1);
            border: 2px dashed var(--border-light);
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .empty-state::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.05) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: float 4s ease-in-out infinite;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.7;
            display: block;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .empty-state h3 {
            margin: 0 0 12px;
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state p {
            margin: 0;
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* 数据可视化增强效果 */
        .data-visualization {
            position: relative;
            margin: 20px 0;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--bg-section);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-2), var(--accent));
            border-radius: 10px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-bar.success {
            background: linear-gradient(90deg, var(--success), var(--success-2), #34d399);
        }

        .progress-bar.warning {
            background: linear-gradient(90deg, var(--warning), var(--warning-2), #fbbf24);
        }

        .progress-bar.danger {
            background: linear-gradient(90deg, var(--danger), var(--danger-2), #f87171);
        }

        /* 数据标签样式 */
        .data-label {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(6, 182, 212, 0.1));
            color: var(--primary);
            border: 1px solid rgba(99, 102, 241, 0.2);
            margin: 2px;
            transition: var(--transition);
        }

        .data-label:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(6, 182, 212, 0.15));
            transform: translateY(-2px) scale(1.05);
        }

        .data-label.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
            color: var(--success);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .data-label.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
            color: var(--warning);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .data-label.danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            color: var(--danger);
            border-color: rgba(239, 68, 68, 0.2);
        }

        /* 统计信息卡片 */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .stat-item {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-glass));
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-sm);
            padding: 16px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
            margin: 0 0 4px;
        }

        .stat-description {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin: 0;
        }

        /* 增强的响应式设计 */
        @media (max-width: 1200px) {
            .container {
                max-width: 100%;
                padding: 0 20px;
            }
            
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            }
        }

        @media (max-width: 980px) {
            .guidance-banner-content {
                grid-template-columns: 1fr;
                gap: 28px;
            }

            .guidance-actions {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 12px;
            }

            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                gap: 20px;
            }

            .grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            /* 筛选条件可视化响应式 */
            .filter-summary-header {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .filter-tags {
                gap: 6px;
            }

            .filter-tag {
                font-size: 12px;
                padding: 6px 10px;
            }

            .section-filter-info {
                font-size: 10px;
                padding: 4px 8px;
                top: 8px;
                right: 8px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .guidance-banner {
                padding: 28px;
                border-radius: var(--border-radius);
            }

            /* 筛选条件卡片移动端优化 */
            .filter-summary-card {
                padding: 20px;
                margin-bottom: 20px;
            }

            .filter-summary-header h3 {
                font-size: 16px;
            }

            .filter-tags {
                gap: 6px;
            }

            .filter-tag {
                font-size: 11px;
                padding: 5px 8px;
                gap: 4px;
            }

            .section-filter-info {
                display: none; /* 移动端隐藏 */
            }

            .data-section.filtered {
                border-left-width: 2px;
            }

            .interactive-data {
                transform: none !important; /* 移动端禁用缩放 */
            }

            .interactive-data:hover {
                transform: translateY(-1px) !important;
            }

            .section-card {
                padding: 24px;
                border-radius: var(--border-radius);
            }

            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 16px;
            }

            .trend-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 16px;
            }

            .streak-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .sla-task-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .sla-task-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .sla-level-badge {
                align-self: flex-start;
            }

            .info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
                padding: 10px 0;
            }

            .info-value {
                text-align: left;
            }

            .sla-task-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .btn-sm {
                width: 100%;
                justify-content: center;
            }

            .btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .btn-lg {
                padding: 16px 24px;
                font-size: 15px;
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 0 12px;
            }

            .guidance-banner {
                padding: 20px;
                border-radius: var(--border-radius-sm);
            }

            .section-card {
                padding: 20px;
                border-radius: var(--border-radius-sm);
            }

            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .trend-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .streak-grid {
                grid-template-columns: 1fr;
            }

            .metric-value {
                font-size: 36px;
            }

            .trend-value {
                font-size: 28px;
            }

            .table {
                font-size: 13px;
            }

            .table th, .table td {
                padding: 12px 10px;
            }

            .section-card h2 {
                font-size: 18px;
            }

            .section-card h3 {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .guidance-actions {
                flex-direction: column;
            }

            .guidance-banner {
                padding: 16px;
            }

            .section-card {
                padding: 16px;
            }

            .metric-value {
                font-size: 32px;
            }

            .trend-value {
                font-size: 24px;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .sla-task-grid {
                grid-template-columns: 1fr;
            }

            .sla-task-card {
                padding: 16px;
            }

            .date-range-filter {
                padding: 16px;
                margin: 12px 0;
            }

            .date-inputs-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .date-input-card {
                padding: 16px;
            }

            .date-range-actions {
                gap: 12px;
            }

            .secondary-actions {
                flex-direction: column;
                width: 100%;
            }

            .secondary-actions .btn {
                width: 100%;
                justify-content: center;
            }

            .btn {
                padding: 14px 16px;
                font-size: 13px;
            }

            .btn-lg {
                padding: 16px 20px;
                font-size: 14px;
            }
        }

        /* 性能优化样式 */
        .gpu-accelerated {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .will-change-transform {
            will-change: transform;
        }

        .will-change-opacity {
            will-change: opacity;
        }

        /* 减少动画对性能的影响 */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* 打印样式优化 */
        @media print {
            .guidance-banner,
            .btn,
            .secondary-actions,
            .date-range-filter {
                display: none !important;
            }

            .section-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
                margin-bottom: 20px;
            }

            .metrics-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            body {
                background: white;
            }

            .container {
                max-width: none;
                padding: 0;
            }
        }
{% endblock %}
{% block content %}
<div class="container">
    <div class="performance-shell">
        <section class="guidance-banner">
            <div class="guidance-banner-content">
                <div class="guidance-content">
                    <h1>绩效总览 / Performance Overview</h1>
                <p class="lede">项目与角色完成率、逾期率、连签趋势，一键导出与周报（数据约每 10 分钟刷新一次）/ Project & role completion, overdue, streaks with exports & weekly digest (cache ~10min)</p>
                <div class="guidance-meta">
                    {% if generated_at %}
                    <p class="lede">上次刷新：{{ generated_at|date:"Y-m-d H:i" }}（本地时区）/ Last refreshed (local): {{ generated_at|date:"Y-m-d H:i" }}</p>
                    {% endif %}
                    {% if sla_thresholds %}
                    <p class="lede">SLA 阈值：红 {{ sla_thresholds.red }}h / 黄 {{ sla_thresholds.amber }}h（正常状态高于黄） / SLA: Red {{ sla_thresholds.red }}h · Amber {{ sla_thresholds.amber }}h</p>
                    {% endif %}
                    <form method="get" class="date-range-filter">
                        <div class="date-range-header">
                            <h3>📅 筛选 / Filters</h3>
                            <p class="date-range-subtitle">时间、项目、角色过滤后所有指标同步更新 / All metrics sync with date/project/role filters</p>
                        </div>
                        
                        <div class="date-inputs-grid">
                            <div class="date-input-card">
                                <div class="date-input-header">
                                    <span class="date-icon">🚀</span>
                                    <label for="start" class="date-label">开始日期 / Start Date</label>
                                </div>
                                <div class="date-input-wrapper">
                                    <input type="date" id="start" name="start" value="{{ start|date:'Y-m-d' }}" class="date-input">
                                    <span class="date-input-hint">选择统计开始时间 / Select start time</span>
                                </div>
                            </div>
                            
                            <div class="date-input-card">
                                <div class="date-input-header">
                                    <span class="date-icon">🏁</span>
                                    <label for="end" class="date-label">结束日期 / End Date</label>
                                </div>
                                <div class="date-input-wrapper">
                                    <input type="date" id="end" name="end" value="{{ end|date:'Y-m-d' }}" class="date-input">
                                    <span class="date-input-hint">选择统计结束时间 / Select end time</span>
                                </div>
                            </div>
                        </div>
                        <div class="date-inputs-grid" style="margin-top:12px;">
                            <div class="date-input-card">
                                <div class="date-input-header">
                                    <span class="date-icon">🏗️</span>
                                    <label for="project" class="date-label">项目过滤 / Project Filter</label>
                                </div>
                                <div class="date-input-wrapper">
                                    <select id="project" name="project" class="date-input">
                                        <option value="">全部项目 / All projects</option>
                                        {% for p in projects %}
                                            <option value="{{ p.id }}" {% if project_filter == p.id %}selected{% endif %}>{{ p.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <span class="date-input-hint">选择要分析的项目 / Select project</span>
                                </div>
                            </div>
                            <div class="date-input-card">
                                <div class="date-input-header">
                                    <span class="date-icon">🧑‍💼</span>
                                    <label for="role" class="date-label">角色过滤 / Role Filter</label>
                                </div>
                                <div class="date-input-wrapper">
                                    <select id="role" name="role" class="date-input">
                                        <option value="">全部角色 / All roles</option>
                                        {% for val,label in report_roles %}
                                            <option value="{{ val }}" {% if role_filter == val %}selected{% endif %}>{{ label }}</option>
                                        {% endfor %}
                                    </select>
                                    <span class="date-input-hint">按角色筛选绩效 / Filter by role</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="date-range-actions">
                            <button type="submit" class="btn btn-primary btn-lg">
                                🔍 应用时间范围 / Apply Date Range
                            </button>
                            <div class="secondary-actions">
                                <a href="{% url 'reports:performance_board' %}" class="btn btn-ghost">
                                    🔄 重置时间 / Reset Time
                                </a>
                                <button type="button" class="btn btn-secondary" onclick="setLast30Days()">
                                    📊 最近30天 / Last 30 Days
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="setThisMonth()">
                                    📅 本月 / This Month
                                </button>
                            </div>
                        </div>
                    </form>
                    <a href="{% url 'reports:performance_board' %}{% if start or end or sla_only %}?{% endif %}{% if start %}start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}{% if start %}&{% endif %}end={{ end|date:'Y-m-d' }}{% endif %}{% if sla_only %}{% if start or end %}&{% endif %}sla_only=1{% endif %}" class="btn btn-secondary" style="max-width:220px;">🔄 刷新数据 / Refresh data</a>
                    <p class="lede" style="margin-top:4px;">提示：如遇导出数据过大，请先缩小过滤范围 / If export is too large, narrow filters first.</p>
                </div>
            </div>
            <div class="guidance-actions">
                <a href="{% url 'reports:performance_export' %}?scope=project{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}" class="btn btn-primary btn-lg">
                    📊 导出项目 / Export Projects
                </a>
                <div class="action-group">
                    <a href="{% url 'reports:performance_export' %}?scope=role{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}" class="btn btn-secondary">
                        👥 导出角色 / Export Roles
                    </a>
                    <a href="{% url 'reports:performance_export' %}?scope=user{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}" class="btn btn-secondary">
                        🙋 导出用户 / Export Users
                    </a>
                    <a href="{% url 'reports:performance_export' %}?scope=streak{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}" class="btn btn-secondary">
                        🔥 导出连签 / Export Streaks
                    </a>
                    <a href="?send_weekly=1{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}{% if sla_only %}&sla_only=1{% endif %}" class="btn btn-secondary">
                        📧 发送周报 / Send Weekly Digest
                    </a>
                    {% if sla_only %}
                        <a href="{% url 'reports:performance_board' %}{% if start %}?start={{ start|date:'Y-m-d' }}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}{% endif %}" class="btn btn-accent">
                            🔍 显示全部 / Show all
                        </a>
                    {% else %}
                        <a href="?sla_only=1{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}" class="btn btn-warning">
                            ⚠️ 仅看 SLA 预警 / SLA alerts only
                        </a>
                    {% endif %}
                </div>
            </div>
            </div>
        </section>

        <!-- 当前筛选条件可视化提示 -->
        <section class="filter-summary-card" id="filterSummary">
            <div class="filter-summary-content">
                <div class="filter-summary-header">
                    <h3>🎯 当前筛选条件 / Current Filters</h3>
                    <button type="button" class="btn btn-ghost btn-sm" onclick="clearAllFilters()">
                        🔄 清除所有 / Clear All
                    </button>
                </div>
                <div class="filter-tags" id="filterTags">
                    {% if start %}<span class="filter-tag">开始：{{ start|date:"Y-m-d" }}</span>{% endif %}
                    {% if end %}<span class="filter-tag">结束：{{ end|date:"Y-m-d" }}</span>{% endif %}
                    {% if project_filter %}
                        {% for p in projects %}{% if p.id == project_filter %}<span class="filter-tag">项目：{{ p.name }}</span>{% endif %}{% endfor %}
                    {% endif %}
                    {% if role_filter %}
                        {% for val,label in report_roles %}{% if role_filter == val %}<span class="filter-tag">角色：{{ label }}</span>{% endif %}{% endfor %}
                    {% endif %}
                    {% if not start and not end and not project_filter and not role_filter %}
                        <span class="filter-tag muted">未设置过滤 / No filters</span>
                    {% endif %}
                </div>
            </div>
        </section>

        {% if sla_only %}
        <section class="section-card">
            <div class="section-head">
                <div class="title-block">
                    <p class="section-eyebrow">SLA Watchlist</p>
                    <h2>⚠️ SLA 预警任务列表 / SLA Alerts Task List</h2>
                    <p class="section-note">仅显示红/黄等级或逾期任务；红 {{ sla_thresholds.red }}h / 黄 {{ sla_thresholds.amber }}h。点击任务标题查看详情。</p>
                </div>
                <div class="section-actions">
                    <span class="pill-soft">⏱ 阈值 {{ sla_thresholds.red }}h / {{ sla_thresholds.amber }}h</span>
                    <span class="pill-soft">🚨 仅显示预警</span>
                </div>
            </div>
            
            {% if sla_urgent_tasks %}
            <div class="sla-task-grid">
                {% for t in sla_urgent_tasks %}
                <div class="sla-task-card {% if t.sla_info.level == 'red' %}sla-danger{% elif t.sla_info.level == 'amber' %}sla-warning{% else %}sla-overdue{% endif %}">
                    <div class="sla-task-header">
                        <div class="sla-task-title">
                            <a href="{% url 'reports:task_view' t.pk %}" class="task-link" target="_blank">
                                {{ t.title|truncatechars:45 }}
                            </a>
                        </div>
                        <div class="sla-level-badge">
                            {% if t.sla_info.level == 'red' %}
                                <span class="badge badge-danger">🔴 Red</span>
                            {% elif t.sla_info.level == 'amber' %}
                                <span class="badge badge-warning">🟡 Amber</span>
                            {% else %}
                                <span class="badge badge-overdue">⚫ Overdue</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="sla-task-details">
                        <div class="sla-task-info">
                            <div class="info-item">
                                <span class="info-label">项目 / Project</span>
                                <span class="info-value">{{ t.project.name|default:"--" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">指派人 / Assignee</span>
                                <span class="info-value">{{ t.user.get_full_name|default:t.user.username|default:"--" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">剩余时间 / Remaining</span>
                                <span class="info-value {% if t.sla_info.level == 'red' %}text-danger{% elif t.sla_info.level == 'amber' %}text-warning{% else %}text-overdue{% endif %}">
                                    {% if t.sla_info.remaining_hours is not None %}
                                        {{ t.sla_info.remaining_hours }}h
                                    {% else %}
                                        逾期 / Overdue
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="sla-task-actions">
                            <a href="{% url 'reports:task_view' t.pk %}" class="btn btn-primary btn-sm" target="_blank">
                                👁️ 查看详情 / View
                            </a>
                            {% if t.due_at %}
                            <span class="due-time">
                                截止: {{ t.due_at|localtime|date:"m-d H:i" }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-icon">✅</div>
                <h3>无SLA预警任务 / No SLA Alerts</h3>
                <p>当前没有需要紧急处理的SLA预警任务 / No urgent SLA alerts at this time</p>
                <a class="btn btn-ghost" href="{% url 'reports:performance_board' %}{% if start or end %}?{% endif %}{% if start %}start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}{% if start %}&{% endif %}end={{ end|date:'Y-m-d' }}{% endif %}">返回全量视图 / Back to full view</a>
            </div>
            {% endif %}
        </section>
        {% endif %}

        <section class="section-card section-card-content">
            <div class="section-head">
                <div class="title-block">
                    <p class="section-eyebrow">Performance Snapshot</p>
                    <h2>📊 核心指标 / Key Metrics</h2>
                    <p class="section-note">概览关键指标，帮助快速判断整体健康度 / Quick read on velocity, risk and SLA health.</p>
                </div>
                <div class="section-actions">
                    <span class="pill-soft">⚡ 实时同步 / Live</span>
                    <span class="pill-soft">🎯 数据已过滤 / Filters applied</span>
                </div>
            </div>
            <div class="metrics-grid">
                <div class="metric-card gpu-accelerated will-change-transform">
                    <div class="metric-label">总任务 / Total Tasks</div>
                    <div class="metric-value">{{ total_tasks }}</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="metric-card danger gpu-accelerated will-change-transform">
                    <div class="metric-label">紧急任务 / Urgent Tasks</div>
                    <div class="metric-value">{{ urgent_tasks }}</div>
                    {% if total_tasks > 0 %}
                    <div class="progress-bar-container">
                        <div class="progress-bar danger" style="width: {% widthratio urgent_tasks total_tasks 100 %}%"></div>
                    </div>
                    {% endif %}
                </div>
                <div class="metric-card success gpu-accelerated will-change-transform">
                    <div class="metric-label">最高连签 / Max Streak</div>
                    <div class="metric-value">
                        {% with streaks=role_streaks|dictsortreversed:"max_streak" %}{% if streaks %}{{ streaks.0.max_streak }}{% else %}0{% endif %}{% endwith %}
                    </div>
                    {% with streaks=role_streaks|dictsortreversed:"max_streak" %}{% if streaks and streaks.0.max_streak > 0 %}
                    <div class="progress-bar-container">
                        <div class="progress-bar success" style="width: {% widthratio streaks.0.max_streak 20 100 %}%"></div>
                    </div>
                    {% endif %}{% endwith %}
                </div>
                <div class="metric-card gpu-accelerated will-change-transform {% if overall_sla_on_time_rate < 80 %}warning{% elif overall_sla_on_time_rate < 60 %}danger{% endif %}">
                    <div class="metric-label">SLA 准时率 / SLA On-time</div>
                    <div class="metric-value">{{ overall_sla_on_time_rate|floatformat:1 }}%</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar {% if overall_sla_on_time_rate >= 80 %}success{% elif overall_sla_on_time_rate >= 60 %}warning{% else %}danger{% endif %}" style="width: {{ overall_sla_on_time_rate|default:0 }}%"></div>
                    </div>
                </div>
                <div class="metric-card gpu-accelerated will-change-transform">
                    <div class="metric-label">Lead Time（中位/均值h）</div>
                    <div class="metric-value">
                        {% if overall_lead_p50 %}{{ overall_lead_p50 }}{% else %}--{% endif %} / {% if overall_lead_avg %}{{ overall_lead_avg }}{% else %}--{% endif %}
                    </div>
                    {% if overall_lead_p50 and overall_lead_avg %}
                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                        效率指数: {% if overall_lead_p50 < 24 %}🟢 优秀{% elif overall_lead_p50 < 48 %}🟡 良好{% else %}🔴 待优化{% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>

        <div class="main-content-grid">
            <!-- 左侧主要内容区域 -->
            <div class="left-column">
                <section class="section-card full-width">
                    <div class="section-head">
                        <div class="title-block">
                            <p class="section-eyebrow">Delivery by Project</p>
                            <h2>🏗️ 项目完成率 / Project Completion Rate</h2>
                            <p class="section-note">对比各项目的总量、完成、逾期与 SLA，便于迅速定位风险项目。</p>
                        </div>
                        <div class="section-actions">
                            <span class="pill-soft">📁 项目视角</span>
                            <span class="pill-soft">↗ 可点击行跳转</span>
                        </div>
                    </div>
                <div class="table-toolbar">
                    <div class="notes">
                        <span class="pill-soft pill-compact">字段对齐</span>
                        <span class="pill-soft pill-compact">名称自动换行</span>
                        <span class="pill-soft pill-compact">数值右对齐</span>
                    </div>
                    <div class="notes">
                        <span>数据列宽固定，滚动可见全部字段</span>
                    </div>
                </div>
            <div class="table-responsive">
                    <table class="table table-fixed completion-table">
                        <colgroup>
                            <col class="col-wide">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                        </colgroup>
                        <thead>
                            <tr>
                                <th class="col-wide">项目 / Project</th>
                                <th class="col-narrow">总任务 / Total</th>
                                <th class="col-narrow">完成 / Done</th>
                                <th class="col-narrow">逾期 / Overdue</th>
                                <th class="col-narrow">完成率 / Completion</th>
                                <th class="col-narrow">逾期率 / Overdue</th>
                                <th class="col-narrow">SLA 准时率 / SLA On-time</th>
                                <th class="col-narrow">Lead Time 中位 / Median (h)</th>
                                <th class="col-narrow">Lead Time 平均 / Avg (h)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in project_stats %}
                            <tr onclick="window.location='?{% if start %}start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}end={{ end|date:'Y-m-d' }}{% endif %}project={{ p.project_id }}{% if role_filter %}&role={{ role_filter }}{% endif %}'" style="cursor:pointer;">
                                <td class="col-wide" data-label="项目 / Project">{{ p.project|default:"--" }}</td>
                                <td class="col-narrow" data-label="总任务 / Total">{{ p.total }}</td>
                                <td class="col-narrow" data-label="完成 / Done">{{ p.completed }}</td>
                                <td class="col-narrow" data-label="逾期 / Overdue">{{ p.overdue }}</td>
                                <td class="col-narrow" data-label="完成率 / Completion">{{ p.completion_rate|floatformat:1 }}%</td>
                                <td class="col-narrow" data-label="逾期率 / Overdue">{{ p.overdue_rate|floatformat:1 }}%</td>
                                <td class="col-narrow" data-label="SLA 准时率 / SLA On-time">{{ p.sla_on_time_rate|floatformat:1 }}%</td>
                                <td class="col-narrow" data-label="Lead Time 中位 / Median (h)">{% if p.lead_time_p50 %}{{ p.lead_time_p50 }}{% else %}--{% endif %}</td>
                                <td class="col-narrow" data-label="Lead Time 平均 / Avg (h)">{% if p.lead_time_avg %}{{ p.lead_time_avg }}{% else %}--{% endif %}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="9" style="text-align:center;color:#94a3b8;">暂无数据 / No data</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

                <section class="section-card">
                    <div class="section-head">
                        <div class="title-block">
                            <p class="section-eyebrow">Delivery by Role</p>
                            <h2>👥 角色完成率 / Role Completion Rate</h2>
                            <p class="section-note">按角色对比产出、效率与 SLA，帮助识别角色瓶颈或亮点。</p>
                    </div>
                <div class="section-actions">
                    <span class="pill-soft">🧩 角色视角</span>
                    <span class="pill-soft">↗ 可点击行跳转</span>
                </div>
            </div>
                <div class="table-toolbar">
                    <div class="notes">
                        <span class="pill-soft pill-compact">字段对齐</span>
                        <span class="pill-soft pill-compact">名称自动换行</span>
                        <span class="pill-soft pill-compact">数值右对齐</span>
                    </div>
                    <div class="notes">
                        <span>数据列宽固定，滚动可见全部字段</span>
                    </div>
                </div>
            <div class="table-responsive">
                    <table class="table table-fixed completion-table">
                        <colgroup>
                            <col class="col-wide">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                            <col class="col-narrow">
                        </colgroup>
                        <thead>
                            <tr>
                                <th class="col-wide">角色 / Role</th>
                                <th class="col-narrow">总任务 / Total</th>
                                <th class="col-narrow">完成 / Done</th>
                                <th class="col-narrow">逾期 / Overdue</th>
                                <th class="col-narrow">完成率 / Completion</th>
                                <th class="col-narrow">逾期率 / Overdue</th>
                                <th class="col-narrow">SLA 准时率 / SLA On-time</th>
                                <th class="col-narrow">Lead Time 中位 / Median (h)</th>
                                <th class="col-narrow">Lead Time 平均 / Avg (h)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in role_stats %}
                            <tr onclick="window.location='?{% if start %}start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}end={{ end|date:'Y-m-d' }}{% endif %}role={{ r.role }}{% if project_filter %}&project={{ project_filter }}{% endif %}'" style="cursor:pointer;">
                                <td class="col-wide" data-label="角色 / Role">{{ r.role_label|default:"--" }}</td>
                                <td class="col-narrow" data-label="总任务 / Total">{{ r.total }}</td>
                                <td class="col-narrow" data-label="完成 / Done">{{ r.completed }}</td>
                                <td class="col-narrow" data-label="逾期 / Overdue">{{ r.overdue }}</td>
                                <td class="col-narrow" data-label="完成率 / Completion">{{ r.completion_rate|floatformat:1 }}%</td>
                                <td class="col-narrow" data-label="逾期率 / Overdue">{{ r.overdue_rate|floatformat:1 }}%</td>
                                <td class="col-narrow" data-label="SLA 准时率 / SLA On-time">{{ r.sla_on_time_rate|floatformat:1 }}%</td>
                                <td class="col-narrow" data-label="Lead Time 中位 / Median (h)">{% if r.lead_time_p50 %}{{ r.lead_time_p50 }}{% else %}--{% endif %}</td>
                                <td class="col-narrow" data-label="Lead Time 平均 / Avg (h)">{% if r.lead_time_avg %}{{ r.lead_time_avg }}{% else %}--{% endif %}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="9" style="text-align:center;color:#94a3b8;">暂无数据 / No data</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                </section>
            </div>

            <!-- 右侧边栏内容 -->
            <div class="right-column">
                <section class="data-visualization-section control-panel">
                    <div class="section-head">
                        <div class="title-block">
                            <p class="section-eyebrow">Individual Throughput</p>
                            <h2>🙋 用户绩效 / User Performance</h2>
                            <p class="section-note">用户维度的完成率、逾期与 Lead Time</p>
                        </div>
                        <div class="section-actions">
                            <span class="pill-soft">🧭 用户视角</span>
                            <span class="pill-soft">↗ 行点击查看任务</span>
                        </div>
                    </div>
            <div class="table-toolbar">
                <div class="notes">
                    <span class="pill-soft pill-compact">字段对齐</span>
                    <span class="pill-soft pill-compact">名称自动换行</span>
                    <span class="pill-soft pill-compact">数值右对齐</span>
                </div>
                <div class="notes">
                    <span>数据列宽固定，滚动可见全部字段</span>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-fixed completion-table">
                    <colgroup>
                        <col class="col-wide">
                        <col class="col-narrow">
                        <col class="col-narrow">
                        <col class="col-narrow">
                        <col class="col-narrow">
                        <col class="col-narrow">
                        <col class="col-narrow">
                        <col class="col-narrow">
                        <col class="col-narrow">
                    </colgroup>
                    <thead>
                        <tr>
                            <th class="col-wide">用户 / User</th>
                            <th class="col-narrow">总任务 / Total</th>
                            <th class="col-narrow">完成 / Done</th>
                            <th class="col-narrow">逾期 / Overdue</th>
                            <th class="col-narrow">完成率 / Completion</th>
                            <th class="col-narrow">逾期率 / Overdue</th>
                            <th class="col-narrow">SLA 准时率 / SLA On-time</th>
                            <th class="col-narrow">Lead Time 中位 / Median (h)</th>
                            <th class="col-narrow">Lead Time 平均 / Avg (h)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in user_stats_page %}
                        <tr onclick="window.location='{% url 'reports:admin_task_list' %}?user={{ u.user_id }}{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}{% if project_filter %}&project={{ project_filter }}{% endif %}{% if role_filter %}&role={{ role_filter }}{% endif %}'" style="cursor:pointer;">
                            <td class="col-wide" data-label="用户 / User">{{ u.user_label|default:"--" }}</td>
                            <td class="col-narrow" data-label="总任务 / Total">{{ u.total }}</td>
                            <td class="col-narrow" data-label="完成 / Done">{{ u.completed }}</td>
                            <td class="col-narrow" data-label="逾期 / Overdue">{{ u.overdue }}</td>
                            <td class="col-narrow" data-label="完成率 / Completion">{{ u.completion_rate|floatformat:1 }}%</td>
                            <td class="col-narrow" data-label="逾期率 / Overdue">{{ u.overdue_rate|floatformat:1 }}%</td>
                            <td class="col-narrow" data-label="SLA 准时率 / SLA On-time">{{ u.sla_on_time_rate|floatformat:1 }}%</td>
                            <td class="col-narrow" data-label="Lead Time 中位 / Median (h)">{% if u.lead_time_p50 %}{{ u.lead_time_p50 }}{% else %}--{% endif %}</td>
                            <td class="col-narrow" data-label="Lead Time 平均 / Avg (h)">{% if u.lead_time_avg %}{{ u.lead_time_avg }}{% else %}--{% endif %}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="9" style="text-align:center;color:#94a3b8;">暂无数据 / No data</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if user_stats_page.has_other_pages %}
            <div class="pagination" style="margin-top:12px;">
                {% if user_stats_page.has_previous %}
                    <a class="page-link" href="?upage={{ user_stats_page.previous_page_number }}{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}{% if sla_only %}&sla_only=1{% endif %}">上一页</a>
                {% else %}<span class="page-disabled">上一页</span>{% endif %}
                <span class="page-current">第 {{ user_stats_page.number }} / {{ user_stats_page.paginator.num_pages }} 页</span>
                {% if user_stats_page.has_next %}
                    <a class="page-link" href="?upage={{ user_stats_page.next_page_number }}{% if start %}&start={{ start|date:'Y-m-d' }}{% endif %}{% if end %}&end={{ end|date:'Y-m-d' }}{% endif %}{% if sla_only %}&sla_only=1{% endif %}">下一页</a>
                {% else %}<span class="page-disabled">下一页</span>{% endif %}
            </div>
            {% endif %}
        </section>

                <!-- 连签趋势和统计 -->
                <section class="data-display-area">
                    <div class="section-head">
                        <div class="title-block">
                            <p class="section-eyebrow">Engagement Signal</p>
                            <h2>🔥 连签趋势 / Streak Trends (7 Days)</h2>
                            <p class="section-note">最近 7 天连签趋势与角色分布，辅助评估习惯与参与度。</p>
                        </div>
                        <div class="section-actions">
                            <span class="pill-soft">🗓️ 7-day Window</span>
                        </div>
                    </div>
                    {% if trend %}
                    {% with trend_sorted=trend|dictsort:"count" %}
                    {% with trend_max=trend_sorted|last %}
                    {% with max_count=trend_max.count|default:1 %}
                    <div class="trend-grid">
                        {% for item in trend %}
                            <div class="trend-card">
                                <div class="trend-date">{{ item.date|date:"m-d" }}</div>
                                <div class="trend-value">{{ item.count }}</div>
                                <div class="trend-label">已提交日报 / Submitted Reports</div>
                                <div class="trend-bar">
                                    <span style="width:{% widthratio item.count max_count 100 %}%;"></span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    {% endwith %}
                    {% endwith %}
                    {% endwith %}
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">ℹ️</div>
                            <h3>暂无趋势数据 / No trend data</h3>
                            <p>选择其他时间范围再试 / Try another date range</p>
                        </div>
                    {% endif %}
                    <h3 style="margin-top: 32px; margin-bottom: 16px;">📈 角色连签统计 / Role Streak Statistics</h3>
                    <div class="streak-grid">
                        {% for s in role_streaks %}
                            <div class="streak-card">
                                <div class="streak-role">{{ s.role_label }}</div>
                                <div class="streak-stats">平均连签 / Average: {{ s.avg_streak }} 天 | 最高 / Max: {{ s.max_streak }} 天</div>
                            </div>
                        {% endfor %}
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // 日期范围快速选择功能
    function setLast30Days() {
        const end = new Date();
        const start = new Date();
        start.setDate(end.getDate() - 30);
        
        document.getElementById('start').value = start.toISOString().split('T')[0];
        document.getElementById('end').value = end.toISOString().split('T')[0];
        
        // 自动提交表单
        document.querySelector('.date-range-filter').submit();
    }

    function setThisMonth() {
        const now = new Date();
        const start = new Date(now.getFullYear(), now.getMonth(), 1);
        const end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
        
        document.getElementById('start').value = start.toISOString().split('T')[0];
        document.getElementById('end').value = end.toISOString().split('T')[0];
        
        // 自动提交表单
        document.querySelector('.date-range-filter').submit();
    }

    // 日期输入验证
    document.addEventListener('DOMContentLoaded', function() {
        const startDateInput = document.getElementById('start');
        const endDateInput = document.getElementById('end');
        
        function validateDateRange() {
            if (startDateInput.value && endDateInput.value) {
                const startDate = new Date(startDateInput.value);
                const endDate = new Date(endDateInput.value);
                
                if (startDate > endDate) {
                    endDateInput.setCustomValidity('结束日期必须晚于或等于开始日期 / End date must be on or after start date');
                } else {
                    endDateInput.setCustomValidity('');
                }
            }
        }
        
        startDateInput.addEventListener('change', validateDateRange);
        endDateInput.addEventListener('change', validateDateRange);
        
        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K: 聚焦到开始日期
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                startDateInput.focus();
            }
            // Ctrl/Cmd + Enter: 提交表单
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                document.querySelector('.date-range-filter').submit();
            }
        });
    });

    // 绩效看板卡片选择：同步服务端偏好（Fallback 本地）
    (function() {
        const key = 'performance_cards';
        const cards = document.querySelectorAll('.metrics-grid .metric-card');
        let prefs = {};

        function applyPrefs() {
            cards.forEach((card, idx) => {
                const name = card.dataset.card || `card${idx}`;
                if (prefs[name] === false) card.style.display = 'none';
                else card.style.display = '';
            });
        }

        async function loadPrefs() {
            try {
                const res = await fetch("{% url 'reports:preference_get_api' %}?key=" + key);
                const data = await res.json();
                prefs = data.data || {};
                applyPrefs();
            } catch (e) {
                prefs = JSON.parse(localStorage.getItem(key) || '{}');
                applyPrefs();
            }
        }

        async function savePrefs() {
            const form = new FormData();
            form.append('key', key);
            form.append('value', JSON.stringify(prefs));
            try { await fetch("{% url 'reports:preference_save_api' %}", {method:'POST', body: form, headers:{'X-CSRFToken':'{{ csrf_token }}'}}); }
            catch(e){ localStorage.setItem(key, JSON.stringify(prefs)); }
        }

        const panel = document.createElement('div');
        panel.style.display = 'flex';
        panel.style.gap = '8px';
        panel.style.flexWrap = 'wrap';
        panel.style.margin = '8px 0 12px';
        panel.innerHTML = '<strong style="font-size:13px;">显示卡片 / Show cards:</strong>';
        const names = Array.from(cards).map((c, idx) => c.dataset.card || `card${idx}`);
        names.forEach((name, i) => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.textContent = `卡片${i+1}`;
            btn.className = 'btn secondary';
            btn.style.padding = '8px 12px';
            btn.onclick = () => {
                const card = cards[i];
                const hidden = card.style.display === 'none';
                card.style.display = hidden ? '' : 'none';
                prefs[name] = hidden;
                savePrefs();
            };
            panel.appendChild(btn);
        });
        const shell = document.querySelector('.performance-shell');
        if (shell) shell.insertBefore(panel, shell.children[1] || null);
        loadPrefs();
    })();

    // 页面加载优化和动画增强
    document.addEventListener('DOMContentLoaded', function() {
        // 页面加载优化
        const initPageAnimations = () => {
            // 指标卡片动画
            const cards = document.querySelectorAll('.metrics-grid .metric-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('fade-in-up');
            });

            // 趋势卡片动画
            const trendCards = document.querySelectorAll('.trend-card');
            trendCards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.05}s`;
                card.classList.add('scale-in');
            });

            // 页面区域动画
            const sections = document.querySelectorAll('.section-card, .data-display-area, .data-visualization-section');
            sections.forEach((section, index) => {
                section.style.animationDelay = `${index * 0.15}s`;
                section.classList.add('fade-in-up');
            });
        };

        // 表格交互增强
        const enhanceTableInteractions = () => {
            const tableRows = document.querySelectorAll('table tbody tr[onclick]');
            
            tableRows.forEach(row => {
                // 鼠标悬停效果
                row.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateX(4px) scale(1.01)';
                    this.style.boxShadow = 'var(--shadow-md)';
                    this.style.background = 'linear-gradient(135deg, rgba(37, 99, 235, 0.04), rgba(6, 182, 212, 0.02))';
                });
                
                row.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateX(0) scale(1)';
                    this.style.boxShadow = 'none';
                    this.style.background = '';
                });

                // 点击反馈
                row.addEventListener('mousedown', function() {
                    this.style.transform = 'translateX(2px) scale(0.99)';
                });
                
                row.addEventListener('mouseup', function() {
                    this.style.transform = 'translateX(4px) scale(1.01)';
                });
            });
        };

        // 滚动动画观察器
        const initScrollAnimations = () => {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animate-in');
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            const animatedElements = document.querySelectorAll('.section-card, .data-display-area, .data-visualization-section, .chart-card');
            animatedElements.forEach(element => {
                if (!element.style.opacity) {
                    element.style.opacity = '0';
                    element.style.transform = 'translateY(30px)';
                    element.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                    observer.observe(element);
                }
            });
        };

        // 数据可视化增强
        const enhanceDataVisualization = () => {
            // 进度条动画
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                if (width && width !== '0%') {
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.transition = 'width 1.5s cubic-bezier(0.4, 0, 0.2, 1)';
                        bar.style.width = width;
                    }, 500);
                }
            });

            // 数值动画（仅对较大数值进行）
            const animateValues = document.querySelectorAll('.metric-value, .trend-value');
            animateValues.forEach(value => {
                const text = value.textContent.trim();
                const numericMatch = text.match(/^(\d+(?:\.\d+)?)/);
                
                if (numericMatch && parseFloat(numericMatch[1]) > 10) {
                    const finalValue = parseFloat(numericMatch[1]);
                    const suffix = text.replace(numericMatch[1], '');
                    const isPercentage = suffix.includes('%');
                    
                    let currentValue = 0;
                    const increment = finalValue / 50;
                    const timer = setInterval(() => {
                        currentValue += increment;
                        if (currentValue >= finalValue) {
                            currentValue = finalValue;
                            clearInterval(timer);
                        }
                        value.textContent = Math.round(currentValue) + suffix;
                    }, 30);
                }
            });
        };

        // 响应式布局优化
        const optimizeResponsiveLayout = () => {
            const handleResize = () => {
                const width = window.innerWidth;
                const controlPanel = document.querySelector('.control-panel');
                const mainContentGrid = document.querySelector('.main-content-grid');
                
                if (controlPanel && mainContentGrid) {
                    if (width < 1024) {
                        controlPanel.style.position = 'relative';
                        controlPanel.style.top = '0';
                        controlPanel.style.maxHeight = 'none';
                        mainContentGrid.style.gridTemplateColumns = '1fr';
                    } else {
                        controlPanel.style.position = 'sticky';
                        controlPanel.style.top = '24px';
                        controlPanel.style.maxHeight = 'calc(100vh - 48px)';
                        mainContentGrid.style.gridTemplateColumns = '1fr'; // 保持单列宽表格，防止数据被压缩
                    }
                }
            };

            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(handleResize, 250);
            });
            handleResize(); // 初始调用
        };

        // 性能监控
        const initPerformanceMonitoring = () => {
            if (window.performance && window.performance.timing) {
                window.addEventListener('load', () => {
                    const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
                    const domInteractive = window.performance.timing.domInteractive - window.performance.timing.navigationStart;
                    console.log(`页面加载时间: ${loadTime}ms, DOM交互时间: ${domInteractive}ms`);
                });
            }
        };

        // 初始化所有功能
        setTimeout(() => {
            initPageAnimations();
            enhanceTableInteractions();
            initScrollAnimations();
            enhanceDataVisualization();
            optimizeResponsiveLayout();
            initPerformanceMonitoring();
        }, 100);

        // 添加页面可见性API支持
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                console.log('页面重新可见');
            }
        });
    });

    // 筛选条件可视化功能
    function initFilterSummary() {
        updateFilterSummary();
        addInteractiveBehaviors();
        setupDataLinkage();
    }

    // 更新筛选条件摘要
    function updateFilterSummary() {
        const urlParams = new URLSearchParams(window.location.search);
        const filterTags = document.getElementById('filterTags');
        
        if (!filterTags) return;
        
        const tags = [];
        
        // 时间范围筛选
        const startDate = urlParams.get('start');
        const endDate = urlParams.get('end');
        if (startDate || endDate) {
            const dateTag = document.createElement('div');
            dateTag.className = 'filter-tag type-date';
            dateTag.innerHTML = `
                📅 ${startDate || '开始'} - ${endDate || '结束'}
                <span class="remove-filter" onclick="removeFilter('dateRange')">×</span>
            `;
            tags.push(dateTag);
        }
        
        // SLA模式筛选
        const slaOnly = urlParams.get('sla_only');
        if (slaOnly === '1') {
            const slaTag = document.createElement('div');
            slaTag.className = 'filter-tag type-mode';
            slaTag.innerHTML = `
                ⚠️ 仅SLA预警
                <span class="remove-filter" onclick="removeFilter('slaOnly')">×</span>
            `;
            tags.push(slaTag);
        }
        
        // 更新显示
        if (tags.length > 0) {
            filterTags.innerHTML = '';
            tags.forEach(tag => filterTags.appendChild(tag));
            
            // 添加筛选标记到数据模块
            document.querySelectorAll('.section-card').forEach(card => {
                card.classList.add('filtered');
                if (!card.querySelector('.section-filter-info')) {
                    const filterInfo = document.createElement('div');
                    filterInfo.className = 'section-filter-info';
                    filterInfo.textContent = '已筛选 / Filtered';
                    card.appendChild(filterInfo);
                }
            });
        } else {
            filterTags.innerHTML = '<div class="no-filters">📋 无筛选条件 / No filters applied</div>';
            
            // 移除筛选标记
            document.querySelectorAll('.section-card').forEach(card => {
                card.classList.remove('filtered');
                const filterInfo = card.querySelector('.section-filter-info');
                if (filterInfo) filterInfo.remove();
            });
        }
    }

    // 移除筛选条件
    function removeFilter(filterType) {
        const urlParams = new URLSearchParams(window.location.search);
        
        switch(filterType) {
            case 'dateRange':
                urlParams.delete('start');
                urlParams.delete('end');
                break;
            case 'slaOnly':
                urlParams.delete('sla_only');
                break;
        }
        
        // 重新加载页面
        const newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
        window.location.href = newUrl;
    }

    // 清除所有筛选条件
    function clearAllFilters() {
        window.location.href = window.location.pathname;
    }

    // 添加交互行为
    function addInteractiveBehaviors() {
        // 为表格行添加点击交互
        document.querySelectorAll('tbody tr').forEach(row => {
            if (!row.classList.contains('interactive-data')) {
                row.classList.add('interactive-data');
                row.addEventListener('click', function(e) {
                    // 如果点击的是链接，不触发行选择
                    if (e.target.tagName === 'A' || e.target.closest('a')) return;
                    
                    // 切换选中状态
                    this.classList.toggle('selected');
                    
                    // 获取数据并更新其他相关元素
                    const rowData = extractRowData(this);
                    if (rowData) {
                        highlightRelatedData(rowData);
                    }
                });
            }
        });

        // 为指标卡片添加点击交互
        document.querySelectorAll('.metric-card').forEach(card => {
            if (!card.classList.contains('interactive-data')) {
                card.classList.add('interactive-data');
                card.addEventListener('click', function() {
                    const metricType = extractMetricType(this);
                    if (metricType) {
                        filterByMetric(metricType);
                    }
                });
            }
        });
    }

    // 提取表格行数据
    function extractRowData(row) {
        const cells = row.querySelectorAll('td');
        const headers = Array.from(document.querySelectorAll('thead th')).map(th => th.textContent.trim());
        
        const data = {};
        headers.forEach((header, index) => {
            if (cells[index]) {
                data[header] = cells[index].textContent.trim();
            }
        });
        
        return data;
    }

    // 提取指标卡片类型
    function extractMetricType(card) {
        const label = card.querySelector('.metric-label');
        return label ? label.textContent.trim() : null;
    }

    // 高亮相关数据
    function highlightRelatedData(data) {
        // 简化版本：高亮相同项目/角色/用户的数据
        const project = data['项目 / Project'];
        const role = data['角色 / Role'];
        const user = data['用户 / User'];
        
        // 移除之前的高亮
        document.querySelectorAll('tbody tr').forEach(row => {
            row.classList.remove('highlighted');
        });
        
        // 添加新的高亮
        document.querySelectorAll('tbody tr').forEach(row => {
            const rowData = extractRowData(row);
            if (project && rowData['项目 / Project'] === project) {
                row.classList.add('highlighted');
            }
            if (role && rowData['角色 / Role'] === role) {
                row.classList.add('highlighted');
            }
            if (user && rowData['用户 / User'] === user) {
                row.classList.add('highlighted');
            }
        });
    }

    // 根据指标筛选
    function filterByMetric(metricType) {
        console.log('Filtering by metric:', metricType);
        
        // 显示加载动画
        document.querySelectorAll('.section-card').forEach(card => {
            card.classList.add('data-updating');
        });
        
        // 模拟数据更新
        setTimeout(() => {
            document.querySelectorAll('.section-card').forEach(card => {
                card.classList.remove('data-updating');
            });
        }, 1000);
    }

    // 设置数据联动
    function setupDataLinkage() {
        // 监听表单提交，添加加载动画
        const dateForm = document.querySelector('.date-range-filter');
        if (dateForm) {
            dateForm.addEventListener('submit', function() {
                document.querySelectorAll('.section-card').forEach(card => {
                    card.classList.add('data-updating');
                });
            });
        }
        
        // 监听日期变化，实时更新预览
        const dateInputs = document.querySelectorAll('input[type="date"]');
        dateInputs.forEach(input => {
            input.addEventListener('change', function() {
                updateFilterPreview();
            });
        });
    }

    // 更新筛选预览
    function updateFilterPreview() {
        const startDate = document.getElementById('start').value;
        const endDate = document.getElementById('end').value;
        
        if (startDate && endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            
            console.log(`Selected range: ${days} days`);
        }
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        initFilterSummary();
    });

    // 添加高亮样式
    const highlightStyle = document.createElement('style');
    highlightStyle.textContent = `
        tbody tr.highlighted {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(59, 130, 246, 0.06)) !important;
            border-left: 4px solid var(--primary);
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.15) !important;
        }
        
        tbody tr.highlighted td {
            color: var(--primary) !important;
            font-weight: 600 !important;
        }

        /* 数据更新状态动画 */
        .section-card.data-updating {
            opacity: 0.6;
            transform: scale(0.98);
            transition: all 0.3s ease;
        }

        .section-card.data-updating::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            animation: dataLoading 1.5s ease-in-out infinite;
        }

        @keyframes dataLoading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* 选中行状态 */
        tbody tr.selected {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(59, 130, 246, 0.08)) !important;
            border-left: 4px solid var(--primary);
        }

        tbody tr.selected td {
            color: var(--primary) !important;
            font-weight: 600 !important;
        }

        /* 移动端表格优化 */
        @media (max-width: 768px) {
            .table-fixed tbody tr {
                margin-bottom: 20px;
                border-radius: var(--border-radius-sm);
                box-shadow: var(--shadow-sm);
            }

            .table-fixed tbody tr:hover {
                transform: translateX(0);
                box-shadow: var(--shadow-md);
            }
        }
    `;
    document.head.appendChild(highlightStyle);
</script>
{% endblock %}
