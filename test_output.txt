Creating test database for alias 'default'...
System check identified some issues:

WARNINGS:
?: (urls.W005) URL namespace 'core' isn't unique. You may not be able to reverse all URLs in this namespace

System check identified 1 issue (0 silenced).
........./Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/core/handlers/base.py:61: UserWarning: No directory at: /Users/arlo/Downloads/workreport/staticfiles/
  mw_instance = middleware(adapted_handler)
..................................................................................................FF..................................F......F.Exception in thread Thread-2 (update_task):
Exception in thread Thread-1 (update_task):
Exception in thread Thread-3 (update_task):
Exception in thread Thread-4 (update_task):
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
Traceback (most recent call last):
Traceback (most recent call last):
sqlite3.OperationalError: database table is locked: tasks_task
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
sqlite3.OperationalError: database table is locked: tasks_task
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^

The above exception was the direct cause of the following exception:

  File "/Users/arlo/Downloads/workreport/audit/tests/test_audit_concurrency.py", line 30, in update_task
    t.save()
    ~~~~~~^^
sqlite3.OperationalError: database table is locked: tasks_task
sqlite3.OperationalError: database table is locked: tasks_task

The above exception was the direct cause of the following exception:

  File "/Users/arlo/Downloads/workreport/tasks/models.py", line 56, in save
    super().save(*args, **kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
Traceback (most recent call last):
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
        raw,
    ...<4 lines>...
        update_fields,
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
        base_qs, using, pk_val, values, update_fields, forced_update
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1288, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 1043, in _bootstrap_inner
    self.run()
    ~~~~~~~~^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/audit/tests/test_audit_concurrency.py", line 30, in update_task
    t.save()
    ~~~~~~^^
  File "/Users/arlo/Downloads/workreport/audit/tests/test_audit_concurrency.py", line 30, in update_task
    t.save()
    ~~~~~~^^
  File "/Users/arlo/Downloads/workreport/tasks/models.py", line 56, in save
    super().save(*args, **kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.7/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py", line 994, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/audit/tests/test_audit_concurrency.py", line 30, in update_task
    t.save()
    ~~~~~~^^
  File "/Users/arlo/Downloads/workreport/tasks/models.py", line 56, in save
    super().save(*args, **kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/tasks/models.py", line 56, in save
    super().save(*args, **kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
        raw,
    ...<4 lines>...
        update_fields,
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
        base_qs, using, pk_val, values, update_fields, forced_update
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1288, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
        raw,
    ...<4 lines>...
        update_fields,
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
        base_qs, using, pk_val, values, update_fields, forced_update
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1288, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
django.db.utils.OperationalError: database table is locked: tasks_task
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 902, in save
    self.save_base(
    ~~~~~~~~~~~~~~^
        using=using,
        ^^^^^^^^^^^^
    ...<2 lines>...
        update_fields=update_fields,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1008, in save_base
    updated = self._save_table(
        raw,
    ...<4 lines>...
        update_fields,
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1138, in _save_table
    updated = self._do_update(
        base_qs, using, pk_val, values, update_fields, forced_update
    )
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/base.py", line 1203, in _do_update
    return filtered._update(values) > 0
           ~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1288, in _update
    return query.get_compiler(self.db).execute_sql(ROW_COUNT)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 2060, in execute_sql
    row_count = super().execute_sql(result_type)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/models/sql/compiler.py", line 1623, in execute_sql
    cursor.execute(sql, params)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 79, in execute
    return self._execute_with_wrappers(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        sql, params, many=False, executor=self._execute
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 92, in _execute_with_wrappers
    return executor(sql, params, many, context)
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 100, in _execute
    with self.db.wrap_database_errors:
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
django.db.utils.OperationalError: database table is locked: tasks_task
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/utils.py", line 91, in __exit__
    raise dj_exc_value.with_traceback(traceback) from exc_value
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/utils.py", line 105, in _execute
    return self.cursor.execute(sql, params)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "/Users/arlo/Downloads/workreport/.venv/lib/python3.13/site-packages/django/db/backends/sqlite3/base.py", line 360, in execute
    return super().execute(query, params)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
django.db.utils.OperationalError: database table is locked: tasks_task
django.db.utils.OperationalError: database table is locked: tasks_task
..
======================================================================
FAIL: test_sla_settings_permission (workreport.tests.test_permissions_modules.ModulePermissionTests.test_sla_settings_permission)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/tests/test_permissions_modules.py", line 58, in test_sla_settings_permission
    self.assertEqual(resp.status_code, 200)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: 404 != 200

======================================================================
FAIL: test_teams_list_permission (workreport.tests.test_permissions_modules.ModulePermissionTests.test_teams_list_permission)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/tests/test_permissions_modules.py", line 41, in test_teams_list_permission
    self.assertNotEqual(resp.status_code, 200)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: 200 == 200

======================================================================
FAIL: test_sla_threshold_display_in_task_list (workreport.tests.test_sla_and_templates.CacheAndTemplateTests.test_sla_threshold_display_in_task_list)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/tests/test_sla_and_templates.py", line 158, in test_sla_threshold_display_in_task_list
    self.assertContains(resp, "SLA 阈值")
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
AssertionError: False is not true : Couldn't find 'SLA 阈值' in the following response
b'<!DOCTYPE html>\n<html lang="zh-CN">\n\n\n<head>\n    <meta charset="UTF-8">\n    <title>\xe6\x88\x91\xe7\x9a\x84\xe4\xbb\xbb\xe5\x8a\xa1 / My Tasks</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <link rel="preconnect" href="https://fonts.loli.net">\n    <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>\n    <link href="https://fonts.loli.net/css2?family=Space+Grotesk:wght@500;600;700&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">\n    <!-- Font Awesome -->\n    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\n    <link rel="stylesheet" href="/static/css/workreport.css">\n    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>\n    <style>\n        :root {\n            /* Core Palette */\n            --primary: #3b82f6;\n            --primary-hover: #2563eb;\n            --secondary: #64748b;\n            --bg-page: #f8fafc;\n            --bg-card: #ffffff;\n            --text-main: #1e293b;\n            --text-secondary: #64748b;\n            --border-color: #e2e8f0;\n            \n            /* Legacy mappings */\n            --bg: var(--bg-page);\n            --panel: var(--bg-card);\n            --card: var(--bg-card);\n            --ink: var(--text-main);\n            --muted: var(--text-secondary);\n            --primary-2: #06b6d4;\n            --accent: #f59e0b;\n            --success: #10b981;\n            --border: var(--border-color);\n            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n            --radius-lg: 20px;\n            --radius-md: 14px;\n            --radius-sm: 10px;\n        }\n        * { box-sizing: border-box; }\n        body {\n            margin: 0;\n            font-family: \'Space Grotesk\', \'Noto Sans SC\', \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 25%, #f0fdf4 50%, #fef3c7 75%, #fef2f2 100%);\n            background-attachment: fixed;\n            color: var(--ink);\n            min-height: 100vh;\n        }\n        .page { position: relative; min-height: 100vh; overflow: hidden; }\n        .page::after {\n            content: \'\';\n            position: absolute;\n            inset: 0;\n            background: radial-gradient(circle at 40% 0%, rgba(255, 255, 255, 0.6), transparent 25%),\n                        radial-gradient(circle at 70% 20%, rgba(37, 99, 235, 0.08), transparent 30%);\n            pointer-events: none;\n            z-index: 0;\n        }\n        .content { position: relative; z-index: 1; padding: 24px clamp(24px, 5vw, 48px) 48px; max-width: 1600px; margin: 0 auto; }\n        .topbar {\n            position: sticky;\n            top: 0;\n            z-index: 5;\n            backdrop-filter: blur(20px);\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));\n            border-bottom: 1px solid rgba(59, 130, 246, 0.15);\n            padding: 16px clamp(20px, 4vw, 40px);\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            gap: 20px;\n            flex-wrap: wrap;\n            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.12);\n            border-radius: 0 0 24px 24px;\n            margin-bottom: 8px;\n            position: relative;\n        }\n\n        .topbar::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 3px;\n            background: linear-gradient(90deg, var(--primary), var(--primary-2), var(--accent));\n            opacity: 0.8;\n        }\n\n        .topbar::after {\n            content: \'\';\n            position: absolute;\n            top: -30%;\n            right: -5%;\n            width: 300px;\n            height: 300px;\n            background: radial-gradient(circle, rgba(59, 130, 246, 0.06) 0%, transparent 70%);\n            border-radius: 50%;\n            animation: float 8s ease-in-out infinite;\n            pointer-events: none;\n        }\n        .brand { \n            display: flex; \n            align-items: center; \n            gap: 16px; \n            position: relative;\n            z-index: 1;\n        }\n        .brand-mark {\n            width: 48px; height: 48px;\n            border-radius: 16px;\n            background: linear-gradient(135deg, var(--primary), var(--primary-2));\n            color: #fff;\n            display: grid; place-items: center;\n            font-weight: 700; letter-spacing: 0.04em;\n            font-size: 16px;\n            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.35);\n            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n            position: relative;\n            overflow: hidden;\n        }\n        .brand-mark::before {\n            content: \'\';\n            position: absolute;\n            top: -50%;\n            left: -50%;\n            width: 200%;\n            height: 200%;\n            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.4), transparent);\n            animation: rotate 4s linear infinite;\n        }\n        @keyframes rotate {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        @keyframes float {\n            0%, 100% { transform: translateY(0px); }\n            50% { transform: translateY(-10px); }\n        }\n        .brand-mark:hover {\n            transform: scale(1.08) rotate(8deg);\n            box-shadow: 0 16px 32px rgba(59, 130, 246, 0.45);\n        }\n        .brand-title { \n            font-weight: 700; \n            font-size: 20px; \n            line-height: 1.2;\n            background: linear-gradient(135deg, var(--ink), var(--primary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n        }\n        .brand-sub { \n            color: var(--muted); \n            font-size: 13px;\n            margin-top: 2px;\n            font-weight: 500;\n        }\n        .actions { \n            display: flex; \n            gap: 12px; \n            align-items: center; \n            flex-wrap: wrap; \n            margin-top: 6px;\n            position: relative;\n            z-index: 1;\n        }\n        .nav-toggle {\n            display: none;\n            border: 1px solid rgba(59, 130, 246, 0.2);\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));\n            backdrop-filter: blur(10px);\n            border-radius: 14px;\n            padding: 10px 14px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);\n        }\n        .nav-toggle:hover {\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(6, 182, 212, 0.08));\n            border-color: rgba(59, 130, 246, 0.3);\n            transform: translateY(-1px);\n            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.15);\n        }\n        .nav-toggle:active { \n            transform: translateY(0px) scale(0.98); \n            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);\n        }\n        .pill, .ghost-link {\n            text-decoration: none;\n            font-weight: 600;\n            border-radius: 999px;\n            padding: 10px 16px;\n            font-size: 13px;\n            border: 1px solid transparent;\n            position: relative;\n            overflow: hidden;\n            backdrop-filter: blur(10px);\n            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .pill {\n            background: linear-gradient(135deg, var(--primary), var(--primary-2));\n            color: #fff;\n            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.35);\n            position: relative;\n        }\n        .pill::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n            transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .pill:hover::before {\n            left: 100%;\n        }\n        .pill:hover {\n            transform: translateY(-3px) scale(1.05);\n            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.45);\n        }\n        .ghost-link {\n            color: var(--ink);\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.7));\n            border-color: rgba(59, 130, 246, 0.2);\n            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.08);\n        }\n        .ghost-link::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);\n            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .ghost-link:hover::before {\n            left: 100%;\n        }\n        .ghost-link:hover {\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(6, 182, 212, 0.12));\n            border-color: rgba(59, 130, 246, 0.3);\n            transform: translateY(-2px) scale(1.02);\n            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.2);\n        }\n        .ghost-link.active {\n            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(6, 182, 212, 0.15));\n            border-color: rgba(37, 99, 235, 0.4);\n            color: var(--primary);\n            box-shadow: 0 6px 18px rgba(37, 99, 235, 0.25);\n            font-weight: 700;\n        }\n        .chip {\n            display: inline-flex; align-items: center; gap: 6px;\n            padding: 7px 10px;\n            border-radius: 12px;\n            border: 1px dashed rgba(15, 23, 42, 0.12);\n            background: rgba(15, 23, 42, 0.02);\n            font-size: 12px; color: var(--muted);\n        }\n        .flash-stack { display:grid; gap:8px; margin-bottom:12px; }\n        .flash { \n            padding:12px 16px; \n            border-radius:14px; \n            font-size:12px; \n            border:1px solid var(--border); \n            box-shadow:0 8px 20px rgba(59,130,246,0.1);\n            backdrop-filter: blur(8px);\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            position: relative;\n            overflow: hidden;\n        }\n        .flash::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n            transition: left 0.6s ease;\n        }\n        .flash:hover::before {\n            left: 100%;\n        }\n        .flash:hover {\n            transform: translateY(-1px) scale(1.01);\n            box-shadow:0 12px 28px rgba(59,130,246,0.15);\n        }\n        .flash-success { background: rgba(16,185,129,0.12); color:#065f46; border-color: rgba(16,185,129,0.35); }\n        .flash-error { background: rgba(239,68,68,0.12); color:#991b1b; border-color: rgba(239,68,68,0.35); }\n        .flash-info { background: rgba(59,130,246,0.12); color:#1d4ed8; border-color: rgba(59,130,246,0.35); }\n        @media (max-width: 860px) {\n            .topbar { \n                align-items: flex-start; \n                padding: 14px clamp(16px, 4vw, 24px);\n                border-radius: 0 0 20px 20px;\n            }\n            .nav-toggle { display: inline-flex; }\n            .actions {\n                display: none;\n                width: 100%;\n                flex-direction: column;\n                align-items: stretch;\n                gap: 10px;\n                margin-top: 12px;\n                padding-top: 12px;\n                border-top: 1px solid rgba(59, 130, 246, 0.1);\n            }\n            .actions.open { display: flex; }\n            .ghost-link, .pill { \n                width: 100%; \n                text-align: center; \n                justify-content: center;\n                padding: 12px 16px;\n            }\n            .brand {\n                gap: 12px;\n            }\n            .brand-mark {\n                width: 40px;\n                height: 40px;\n                font-size: 14px;\n            }\n            .brand-title {\n                font-size: 16px;\n            }\n            .brand-sub {\n                font-size: 11px;\n            }\n        }\n        \n    </style>\n</head>\n<body>\n<div class="page">\n    \n<header class="topbar">\n    <div class="brand">\n        <div class="brand-mark">TM</div>\n        <div>\n            <div class="brand-title">\xe6\x88\x91\xe7\x9a\x84\xe4\xbb\xbb\xe5\x8a\xa1 / My Tasks</div>\n            <div class="brand-sub">\xe6\x9f\xa5\xe7\x9c\x8b\xe3\x80\x81\xe7\xad\x9b\xe9\x80\x89\xe4\xb8\x8e\xe6\x9b\xb4\xe6\x96\xb0\xe6\x82\xa8\xe7\x9a\x84\xe6\x97\xa5\xe5\xb8\xb8\xe4\xbb\xbb\xe5\x8a\xa1 / View, filter & update your daily tasks</div>\n        </div>\n    </div>\n    <button class="nav-toggle" id="nav-toggle" aria-label="\xe5\x88\x87\xe6\x8d\xa2\xe8\x8f\x9c\xe5\x8d\x95 / Toggle menu">\xe2\x98\xb0 \xe8\x8f\x9c\xe5\x8d\x95 / Menu</button>\n    <div class="actions" id="nav-actions">\n        <!-- \xe4\xb8\xaa\xe4\xba\xba\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8f\xb0 - \xe9\xa6\x96\xe9\xa1\xb5\xe6\xa6\x82\xe8\xa7\x88 -->\n        <a class="ghost-link " href="/reports/workbench/">\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8f\xb0 / Workbench</a>\n        <!-- \xe9\xa1\xb9\xe7\x9b\xae\xe7\xae\xa1\xe7\x90\x86 -->\n        <a class="ghost-link " href="/projects/">\xe9\xa1\xb9\xe7\x9b\xae / Projects</a>   \n        <!-- \xe6\xa0\xb8\xe5\xbf\x83\xe5\x8a\x9f\xe8\x83\xbd - \xe6\x97\xa5\xe5\xb8\xb8\xe5\xb7\xa5\xe4\xbd\x9c -->\n        <a class="ghost-link active" href="/tasks/">\xe4\xbb\xbb\xe5\x8a\xa1 / My Tasks</a>\n        <a class="ghost-link " href="/reports/my/">\xe6\x97\xa5\xe6\x8a\xa5 / My Reports</a>\n        <a class="ghost-link " href="/reports/new/">\xe5\x86\x99\xe6\x97\xa5\xe6\x8a\xa5 / New Report</a>\n        \n        <!-- \xe7\xae\xa1\xe7\x90\x86\xe5\x8a\x9f\xe8\x83\xbd - \xe7\xae\xa1\xe7\x90\x86\xe5\x91\x98\xe4\xb8\x93\xe7\x94\xa8\xef\xbc\x88\xe4\xb8\x8b\xe6\x8b\x89\xe5\x90\x88\xe5\xb9\xb6\xef\xbc\x89 -->\n        \n            \n                \n                <div class="admin-dropdown">\n                    <button type="button" class="ghost-link admin-toggle" id="admin-toggle">\n                        \xe7\xae\xa1\xe7\x90\x86\xe5\x85\xa5\xe5\x8f\xa3 / Admin\n                        <span aria-hidden="true">\xe2\x96\xbe</span>\n                    </button>\n                    <div class="admin-menu" id="admin-menu">\n                        \n                            <a class="" href="/tasks/admin/">\xe4\xbb\xbb\xe5\x8a\xa1\xe7\xae\xa1\xe7\x90\x86 / Tasks Admin</a>\n                            <a class="" href="/reports/admin/reports/">\xe6\x97\xa5\xe6\x8a\xa5\xe7\xae\xa1\xe7\x90\x86 / Reports Admin</a>\n                            <a class="" href="/tasks/admin/stats/">\xe4\xbb\xbb\xe5\x8a\xa1\xe7\xbb\x9f\xe8\xae\xa1 / Task Stats</a>\n                            <a class="" href="/reports/teams/">\xe5\x9b\xa2\xe9\x98\x9f\xe7\xae\xa1\xe7\x90\x86 / Team Management</a>\n                        \n                        \n                            <a class="" href="/reports/performance/">\xe7\xbb\xa9\xe6\x95\x88\xe7\x9c\x8b\xe6\x9d\xbf / Performance Board</a>\n                            <a class="" href="/reports/templates/center/">\xe6\xa8\xa1\xe6\x9d\xbf\xe4\xb8\xad\xe5\xbf\x83 / Template Center</a>\n                            <a class="" href="/reports/templates/roles/">\xe8\xa7\x92\xe8\x89\xb2\xe6\xa8\xa1\xe6\x9d\xbf / Role Templates</a>\n                            <a class="" href="/reports/audit/">\xe5\xae\xa1\xe8\xae\xa1\xe6\x97\xa5\xe5\xbf\x97 / Audit Logs</a>\n                            <a class="" href="/tasks/sla/settings/">SLA \xe9\x85\x8d\xe7\xbd\xae / SLA Settings</a>\n                        \n                    </div>\n                </div>\n            \n        \n        \n        <!-- \xe7\x94\xa8\xe6\x88\xb7\xe6\x93\x8d\xe4\xbd\x9c -->\n        \n            <!-- Global Search Input -->\n            <form action="/reports/search/" method="get" style="margin-right: 8px;">\n                <input type="text" name="q" placeholder="\xf0\x9f\x94\x8d \xe6\x90\x9c\xe7\xb4\xa2 / Search..." \n                       style="padding: 8px 14px; border-radius: 99px; border: 1px solid rgba(59,130,246,0.2); background: rgba(255,255,255,0.6); font-size: 13px; width: 180px; transition: all 0.2s; outline: none;"\n                       onfocus="this.style.width=\'240px\'; this.style.background=\'#fff\'; this.style.boxShadow=\'0 4px 12px rgba(59,130,246,0.1)\'"\n                       onblur="this.style.width=\'180px\'; this.style.background=\'rgba(255,255,255,0.6)\'; this.style.boxShadow=\'none\'">\n            </form>\n\n            <div class="notification-center" id="notification-center">\n    <button class="ghost-link icon-btn" id="bell-btn" aria-label="Notifications">\n        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>\n            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n        </svg>\n        <span class="badge" id="notification-badge" style="display: none;">0</span>\n    </button>\n    \n    <div class="notification-dropdown" id="notification-dropdown">\n        <div class="dropdown-header">\n            <h3>\xe9\x80\x9a\xe7\x9f\xa5 / Notifications</h3>\n            <button class="text-btn" id="mark-all-read">\xe5\x85\xa8\xe9\x83\xa8\xe5\xb7\xb2\xe8\xaf\xbb / Mark all read</button>\n        </div>\n        <div class="notification-list" id="notification-list">\n            <div class="empty-state">\xe5\x8a\xa0\xe8\xbd\xbd\xe4\xb8\xad... / Loading...</div>\n        </div>\n        <div class="dropdown-footer">\n            <a href="/reports/notifications/">\xe6\x9f\xa5\xe7\x9c\x8b\xe5\x85\xa8\xe9\x83\xa8 / View All</a>\n        </div>\n    </div>\n</div>\n\n<style>\n    .notification-center {\n        position: relative;\n    }\n    .icon-btn {\n        padding: 8px;\n        border-radius: 50%;\n        position: relative;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 40px;\n        height: 40px;\n    }\n    .badge {\n        position: absolute;\n        top: -2px;\n        right: -2px;\n        background: #ef4444;\n        color: white;\n        font-size: 10px;\n        font-weight: bold;\n        padding: 2px 5px;\n        border-radius: 10px;\n        min-width: 18px;\n        text-align: center;\n        border: 2px solid #fff;\n    }\n    .badge.pulse {\n        animation: pulse-animation 1s infinite;\n    }\n    @keyframes pulse-animation {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.2); }\n        100% { transform: scale(1); }\n    }\n    .notification-dropdown {\n        position: absolute;\n        top: 110%;\n        right: -80px; /* Adjust alignment */\n        width: 360px;\n        background: #fff;\n        border-radius: 12px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15);\n        border: 1px solid rgba(0,0,0,0.05);\n        display: none;\n        flex-direction: column;\n        z-index: 1000;\n        max-height: 500px;\n    }\n    .notification-dropdown.open {\n        display: flex;\n    }\n    .dropdown-header {\n        padding: 12px 16px;\n        border-bottom: 1px solid #f1f5f9;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    .dropdown-header h3 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 700;\n    }\n    .text-btn {\n        background: none;\n        border: none;\n        color: #3b82f6;\n        font-size: 12px;\n        cursor: pointer;\n        padding: 0;\n    }\n    .text-btn:hover {\n        text-decoration: underline;\n    }\n    .notification-list {\n        overflow-y: auto;\n        flex: 1;\n        max-height: 400px;\n    }\n    .notification-item {\n        padding: 12px 16px;\n        border-bottom: 1px solid #f8fafc;\n        cursor: pointer;\n        transition: background 0.2s;\n        display: flex;\n        gap: 12px;\n        align-items: flex-start;\n    }\n    .notification-item:hover {\n        background: #f8fafc;\n    }\n    .notification-item.unread {\n        background: #eff6ff;\n    }\n    .notification-item.unread:hover {\n        background: #e0f2fe;\n    }\n    .notif-icon {\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        background: #f1f5f9;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n    }\n    .notif-content {\n        flex: 1;\n    }\n    .notif-title {\n        font-size: 13px;\n        font-weight: 600;\n        margin-bottom: 4px;\n        color: #0f172a;\n    }\n    .notif-msg {\n        font-size: 12px;\n        color: #64748b;\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n    }\n    .notif-time {\n        font-size: 11px;\n        color: #94a3b8;\n        margin-top: 4px;\n    }\n    .dropdown-footer {\n        padding: 10px;\n        text-align: center;\n        border-top: 1px solid #f1f5f9;\n        background: #f8fafc;\n        border-radius: 0 0 12px 12px;\n    }\n    .dropdown-footer a {\n        font-size: 12px;\n        color: #64748b;\n        text-decoration: none;\n    }\n    .empty-state {\n        padding: 20px;\n        text-align: center;\n        color: #94a3b8;\n        font-size: 13px;\n    }\n    \n    @media (max-width: 640px) {\n        .notification-dropdown {\n            position: fixed;\n            top: 60px;\n            left: 10px;\n            right: 10px;\n            width: auto;\n        }\n    }\n</style>\n\n<script>\n    document.addEventListener(\'DOMContentLoaded\', function() {\n        const bellBtn = document.getElementById(\'bell-btn\');\n        const dropdown = document.getElementById(\'notification-dropdown\');\n        const list = document.getElementById(\'notification-list\');\n        const badge = document.getElementById(\'notification-badge\');\n        const markAllBtn = document.getElementById(\'mark-all-read\');\n        let socket = null;\n        let isOpen = false;\n\n        // Toggle Dropdown\n        bellBtn.addEventListener(\'click\', (e) => {\n            e.stopPropagation();\n            isOpen = !isOpen;\n            dropdown.classList.toggle(\'open\', isOpen);\n            if (isOpen) {\n                fetchNotifications();\n            }\n        });\n\n        // Close when clicking outside\n        document.addEventListener(\'click\', (e) => {\n            if (isOpen && !dropdown.contains(e.target) && !bellBtn.contains(e.target)) {\n                isOpen = false;\n                dropdown.classList.remove(\'open\');\n            }\n        });\n\n        // Fetch Notifications via API\n        function fetchNotifications() {\n            fetch("/reports/api/notifications/list/")\n                .then(response => response.json())\n                .then(data => {\n                    renderList(data.notifications);\n                    updateBadge(data.unread_count);\n                });\n        }\n\n        function updateBadge(count) {\n            if (count > 0) {\n                badge.textContent = count > 99 ? \'99+\' : count;\n                badge.style.display = \'block\';\n                // Add pulse animation\n                badge.classList.add(\'pulse\');\n                setTimeout(() => badge.classList.remove(\'pulse\'), 1000);\n            } else {\n                badge.style.display = \'none\';\n            }\n        }\n\n        function renderList(notifications) {\n            if (notifications.length === 0) {\n                list.innerHTML = \'<div class="empty-state">\xe6\x9a\x82\xe6\x97\xa0\xe9\x80\x9a\xe7\x9f\xa5 / No notifications</div>\';\n                return;\n            }\n            list.innerHTML = notifications.map(n => `\n                <div class="notification-item ${n.is_read ? \'\' : \'unread\'} ${n.priority === \'high\' ? \'priority-high\' : \'\'}" onclick="handleNotificationClick(${n.id}, \'${n.notification_type}\', \'${n.data?.task_id || \'\'}\')">\n                    <div class="notif-icon">\n                        ${getIcon(n.notification_type, n.priority)}\n                    </div>\n                    <div class="notif-content">\n                        <div class="notif-title">\n                            ${n.priority === \'high\' ? \'<span style="color:#ef4444;margin-right:2px;">!</span>\' : \'\'}\n                            ${n.title}\n                        </div>\n                        <div class="notif-msg">${n.message}</div>\n                        <div class="notif-time">${n.time_since}</div>\n                    </div>\n                </div>\n            `).join(\'\');\n        }\n\n        function getIcon(type, priority) {\n            if (priority === \'high\') return \'\xe2\x9a\xa0\xef\xb8\x8f\';\n            // Simple SVG icons based on type\n            if (type === \'task_assigned\') return \'\xf0\x9f\x93\x8b\';\n            if (type === \'task_mention\') return \'@\';\n            if (type === \'task_updated\') return \'\xf0\x9f\x93\x9d\';\n            return \'\xf0\x9f\x94\x94\';\n        }\n\n        // WebSocket Connection\n        function connectWebSocket() {\n            const protocol = window.location.protocol === \'https:\' ? \'wss:\' : \'ws:\';\n            socket = new WebSocket(protocol + \'//\' + window.location.host + \'/ws/notifications/\');\n\n            socket.onopen = function(e) {\n                // console.log(\'Notification WebSocket connected\');\n            };\n\n            socket.onmessage = function(e) {\n                const data = JSON.parse(e.data);\n                // console.log(\'New notification:\', data);\n                \n                // Show badge increment\n                const current = parseInt(badge.textContent) || 0;\n                updateBadge(current + 1);\n                \n                // If open, prepend to list\n                if (isOpen) {\n                    // Re-fetch is easiest to keep sort order and format consistent\n                    fetchNotifications(); \n                }\n                \n                // Optional: Sound or Toast\n                playNotificationSound();\n            };\n\n            socket.onclose = function(e) {\n                console.error(\'WebSocket closed. Reconnecting in 5s...\');\n                setTimeout(connectWebSocket, 5000);\n            };\n        }\n\n        function playNotificationSound() {\n            // Simple beep or check user preference\n            // Audio context logic here if needed\n        }\n\n        // Mark All Read\n        markAllBtn.addEventListener(\'click\', () => {\n            fetch("/reports/api/notifications/mark-read/", {\n                method: \'POST\',\n                headers: {\n                    \'X-CSRFToken\': \'8aqvOBERrlxPS8zCZOPN9Aj9ECKKSkCjvSjQ9ASK5kYCqpWqdwBQCPIW5xAYNnw7\'\n                }\n            }).then(() => {\n                fetchNotifications();\n            });\n        });\n\n        // Initialize\n        if ("True" === "True") {\n            fetchNotifications(); // Initial fetch for badge\n            connectWebSocket();\n        }\n\n        // Global handler for click (needs to be attached to window or handled via event delegation above)\n        window.handleNotificationClick = function(id, type, targetId) {\n            // Mark read\n            fetch(`/reports/api/notifications/${id}/mark-read/`, {\n                method: \'POST\',\n                headers: {\n                    \'X-CSRFToken\': \'8aqvOBERrlxPS8zCZOPN9Aj9ECKKSkCjvSjQ9ASK5kYCqpWqdwBQCPIW5xAYNnw7\'\n                }\n            }).then(() => {\n                // Redirect logic\n                if (type.startsWith(\'task\') && targetId) {\n                    window.location.href = `/tasks/${targetId}/view/`;\n                } else {\n                    // Default redirect or just refresh\n                    fetchNotifications();\n                }\n            });\n        };\n    });\n</script>\n\n            <a class="user-center " href="/accounts/settings/">\n                <div class="user-avatar">\n                    \n                        \n                            A\n                        \n                    \n                </div>\n                <div class="user-meta">\n                    <div class="user-name">admin @admin</div>\n                    <div class="user-sub">\xe4\xb8\xaa\xe4\xba\xba\xe4\xb8\xad\xe5\xbf\x83 \xc2\xb7 Settings</div>\n                </div>\n                <span class="user-chevron" aria-hidden="true">\xe2\x86\x92</span>\n            </a>\n            <a class="pill" href="#" onclick="event.preventDefault(); document.getElementById(\'logout-form\').submit();">\xe9\x80\x80\xe5\x87\xba\xe7\x99\xbb\xe5\xbd\x95 / Logout</a>\n            <form id="logout-form" action="/accounts/logout/" method="post" style="display: none;">\n                <input type="hidden" name="csrfmiddlewaretoken" value="8aqvOBERrlxPS8zCZOPN9Aj9ECKKSkCjvSjQ9ASK5kYCqpWqdwBQCPIW5xAYNnw7">\n            </form>\n        \n    </div>\n</header>\n<script>\n    (function () {\n        const toggle = document.getElementById(\'nav-toggle\');\n        const actions = document.getElementById(\'nav-actions\');\n        const adminToggle = document.getElementById(\'admin-toggle\');\n        const adminMenu = document.getElementById(\'admin-menu\');\n        if (!toggle || !actions) return;\n        toggle.addEventListener(\'click\', () => {\n            actions.classList.toggle(\'open\');\n        });\n\n        if (adminToggle && adminMenu) {\n            adminToggle.addEventListener(\'click\', (e) => {\n                e.stopPropagation();\n                adminMenu.classList.toggle(\'open\');\n            });\n            document.addEventListener(\'click\', () => {\n                adminMenu.classList.remove(\'open\');\n            });\n        }\n    })();\n</script>\n\n<style>\n    .topbar {\n        /* position: relative;  Removed to allow sticky from base_topbar */\n        z-index: 40;\n        overflow: visible;\n    }\n    .topbar .actions {\n        overflow: visible;\n    }\n    .admin-dropdown {\n        position: relative;\n        overflow: visible;\n    }\n    .admin-toggle {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n    }\n    .admin-menu {\n        position: absolute;\n        top: 110%;\n        right: 0;\n        min-width: 200px;\n        background: rgba(255,255,255,0.98);\n        border: 1px solid rgba(226,232,240,0.9);\n        border-radius: 10px;\n        box-shadow: 0 12px 30px rgba(15,23,42,0.12);\n        padding: 8px;\n        display: none;\n        z-index: 999;\n    }\n    .admin-menu.open {\n        display: grid;\n        gap: 6px;\n    }\n    .admin-menu a {\n        padding: 8px 10px;\n        border-radius: 8px;\n        color: #0f172a;\n        text-decoration: none;\n        font-size: 13px;\n    }\n    .admin-menu a:hover,\n    .admin-menu a.active {\n        background: rgba(37,99,235,0.08);\n        color: #1d4ed8;\n    }\n    .user-center {\n        display: inline-flex;\n        align-items: center;\n        gap: 10px;\n        padding: 10px 14px;\n        border-radius: 14px;\n        border: 1px solid rgba(59,130,246,0.16);\n        background: linear-gradient(135deg, rgba(255,255,255,0.92), rgba(248,250,252,0.9));\n        box-shadow: 0 8px 20px rgba(59,130,246,0.12);\n        color: #0f172a;\n        text-decoration: none;\n        min-width: 180px;\n        position: relative;\n        overflow: hidden;\n        transition: all 0.3s ease;\n    }\n    .user-center::before {\n        content: \'\';\n        position: absolute;\n        inset: 0;\n        background: linear-gradient(135deg, rgba(59,130,246,0.08), rgba(6,182,212,0.08));\n        opacity: 0;\n        transition: opacity 0.3s ease;\n    }\n    .user-center:hover::before,\n    .user-center.active::before {\n        opacity: 1;\n    }\n    .user-center:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 12px 28px rgba(59,130,246,0.16);\n    }\n    .user-center .user-avatar {\n        width: 38px;\n        height: 38px;\n        border-radius: 12px;\n        overflow: hidden;\n        background: linear-gradient(135deg, #2563eb, #3b82f6, #06b6d4);\n        color: #fff;\n        display: grid;\n        place-items: center;\n        font-weight: 800;\n        letter-spacing: 0.02em;\n        box-shadow: inset 0 0 0 2px rgba(255,255,255,0.35);\n        position: relative;\n        z-index: 1;\n    }\n    .user-center .user-meta {\n        display: grid;\n        gap: 2px;\n        z-index: 1;\n    }\n    .user-center .user-name {\n        font-weight: 700;\n        font-size: 14px;\n        color: #0f172a;\n    }\n    .user-center .user-sub {\n        font-size: 12px;\n        color: #64748b;\n    }\n    .user-center .user-chevron {\n        margin-left: auto;\n        color: #3b82f6;\n        font-weight: 700;\n        z-index: 1;\n    }\n    @media (max-width: 860px) {\n        .admin-menu {\n            position: static;\n            box-shadow: none;\n            border: 1px dashed rgba(226,232,240,0.9);\n        }\n        .user-center {\n            width: 100%;\n        }\n    }\n</style>\n\n\n    <main class="content">\n        \n        \n<style>\n    /* --- Scoped Page Styles --- */\n    .page-container {\n        max-width: 1600px;\n        margin: 0 auto;\n        padding-bottom: 100px;\n    }\n\n    /* --- Header & Controls --- */\n    .page-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-end;\n        margin-bottom: 24px;\n        flex-wrap: wrap;\n        gap: 16px;\n    }\n\n    .header-content {\n        flex: 1;\n        min-width: 280px;\n    }\n\n    .page-title {\n        font-size: 28px;\n        font-weight: 800;\n        color: var(--text-main);\n        margin: 0 0 6px 0;\n        letter-spacing: -0.02em;\n        line-height: 1.2;\n    }\n\n    .page-subtitle {\n        color: var(--text-secondary);\n        font-size: 14px;\n        margin: 0;\n    }\n\n    .view-switcher {\n        display: flex;\n        background: white;\n        padding: 4px;\n        border-radius: 10px;\n        border: 1px solid var(--border-color);\n        box-shadow: var(--shadow-sm);\n    }\n\n    .view-btn {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 36px;\n        height: 36px;\n        border-radius: 6px;\n        color: var(--text-secondary);\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        transition: all 0.2s;\n    }\n\n    .view-btn:hover {\n        background: var(--bg-page);\n        color: var(--text-main);\n    }\n\n    .view-btn.active {\n        background: var(--primary-light);\n        color: var(--primary);\n    }\n\n    /* --- Filter Section --- */\n    .filter-panel {\n        background: white;\n        border: 1px solid var(--border-color);\n        border-radius: var(--radius-lg);\n        padding: 20px;\n        margin-bottom: 24px;\n        box-shadow: var(--shadow-sm);\n    }\n\n    .filter-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n        gap: 16px;\n        align-items: end;\n    }\n\n    .filter-row-bottom {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-top: 16px;\n        padding-top: 16px;\n        border-top: 1px solid var(--border-color);\n        flex-wrap: wrap;\n        gap: 16px;\n    }\n\n    /* --- Task Views --- */\n    \n    /* 1. Grid View (Default) */\n    .task-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));\n        gap: 20px;\n    }\n\n    /* 2. List View (Modifiers) */\n    .task-grid.view-list {\n        grid-template-columns: 1fr;\n        gap: 12px;\n    }\n\n    .task-grid.view-list .task-card {\n        flex-direction: row;\n        align-items: center;\n        padding: 12px 20px;\n        min-height: auto;\n        gap: 20px;\n    }\n\n    .task-grid.view-list .card-status-bar {\n        width: 4px;\n        height: 100%;\n        position: absolute;\n        left: 0;\n        top: 0;\n    }\n\n    .task-grid.view-list .task-checkbox-container {\n        position: static;\n        margin-right: 0;\n    }\n\n    .task-grid.view-list .card-body {\n        padding: 0;\n        flex-direction: row;\n        align-items: center;\n        flex: 1;\n        gap: 20px;\n    }\n\n    .task-grid.view-list .badge-group {\n        margin-bottom: 0;\n        width: 120px;\n        flex-shrink: 0;\n    }\n\n    .task-grid.view-list .task-title {\n        flex: 1;\n        font-size: 15px;\n        margin: 0;\n    }\n\n    .task-grid.view-list .task-content {\n        display: none; /* Hide description in list view */\n    }\n\n    .task-grid.view-list .card-meta-grid {\n        display: flex;\n        gap: 20px;\n        margin-top: 0;\n        padding-top: 0;\n        border-top: none;\n        width: auto;\n        flex-shrink: 0;\n    }\n    \n    .task-grid.view-list .card-footer {\n        background: transparent;\n        border-top: none;\n        padding: 0;\n        width: auto;\n        flex-shrink: 0;\n        gap: 20px;\n    }\n\n    /* 3. Kanban View */\n    .kanban-container {\n        display: none; /* Hidden by default */\n        gap: 16px;\n        overflow-x: auto;\n        padding-bottom: 20px;\n        align-items: flex-start;\n        min-height: 60vh;\n    }\n\n    .kanban-container.active {\n        display: flex;\n    }\n\n    .kanban-column {\n        flex: 0 0 300px;\n        background: #f8fafc;\n        border-radius: 12px;\n        border: 1px solid var(--border-color);\n        display: flex;\n        flex-direction: column;\n        max-height: 80vh;\n    }\n\n    .kanban-header {\n        padding: 12px 16px;\n        font-weight: 700;\n        font-size: 14px;\n        color: var(--text-secondary);\n        border-bottom: 1px solid var(--border-color);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        background: white;\n        border-radius: 12px 12px 0 0;\n    }\n\n    .kanban-body {\n        padding: 12px;\n        overflow-y: auto;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        min-height: 100px;\n    }\n    \n    /* Kanban Card overrides */\n    .kanban-column .task-card {\n        background: white;\n        box-shadow: var(--shadow-sm);\n        border: 1px solid var(--border-color);\n    }\n\n    /* --- Task Card Base --- */\n    .task-card {\n        background: white;\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        position: relative;\n        overflow: hidden;\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n        display: flex;\n        flex-direction: column;\n    }\n\n    .task-card:hover {\n        transform: translateY(-2px);\n        box-shadow: var(--shadow-md);\n        border-color: #cbd5e1;\n    }\n\n    .task-card.selected {\n        border-color: var(--primary);\n        background-color: #f0f9ff;\n    }\n\n    .card-status-bar {\n        height: 4px;\n        width: 100%;\n    }\n    .status-todo { background: #94a3b8; }\n    .status-in_progress { background: #3b82f6; }\n    .status-blocked { background: #ef4444; }\n    .status-in_review { background: #f59e0b; }\n    .status-done { background: #10b981; }\n    .status-closed { background: #64748b; }\n\n    .card-body {\n        padding: 16px;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n    }\n\n    .task-checkbox-container {\n        position: absolute;\n        top: 12px;\n        right: 12px;\n        z-index: 10;\n        background: rgba(255,255,255,0.8);\n        border-radius: 4px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .badge-group {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 6px;\n    }\n\n    .task-title {\n        font-size: 16px;\n        font-weight: 700;\n        margin: 0;\n        line-height: 1.4;\n        color: var(--text-main);\n    }\n    \n    .task-title a {\n        color: inherit;\n        text-decoration: none;\n    }\n    .task-title a:hover { color: var(--primary); }\n\n    .task-content {\n        font-size: 13px;\n        color: var(--text-secondary);\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n        margin: 0;\n        line-height: 1.5;\n    }\n\n    .card-meta-grid {\n        display: flex;\n        gap: 12px;\n        font-size: 12px;\n        color: var(--text-secondary);\n        align-items: center;\n        margin-top: auto;\n    }\n\n    .meta-item {\n        display: flex;\n        align-items: center;\n        gap: 4px;\n    }\n\n    .card-footer {\n        padding: 12px 16px;\n        background: #f8fafc;\n        border-top: 1px solid var(--border-color);\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n\n    /* --- Bulk Actions Sticky Bar --- */\n    .bulk-toolbar {\n        position: fixed;\n        bottom: 32px;\n        left: 50%;\n        transform: translateX(-50%) translateY(200%);\n        background: #1e293b;\n        color: white;\n        padding: 12px 24px;\n        border-radius: 100px;\n        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);\n        display: flex;\n        align-items: center;\n        gap: 20px;\n        z-index: 100;\n        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);\n    }\n\n    .bulk-toolbar.visible {\n        transform: translateX(-50%) translateY(0);\n    }\n\n    .bulk-info {\n        font-weight: 600;\n        font-size: 14px;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        padding-right: 20px;\n        border-right: 1px solid rgba(255,255,255,0.2);\n    }\n\n    .bulk-actions {\n        display: flex;\n        gap: 8px;\n    }\n\n    .bulk-btn {\n        background: rgba(255,255,255,0.1);\n        border: 1px solid rgba(255,255,255,0.2);\n        color: white;\n        padding: 8px 16px;\n        border-radius: 20px;\n        font-size: 13px;\n        font-weight: 500;\n        cursor: pointer;\n        transition: all 0.2s;\n        display: flex;\n        align-items: center;\n        gap: 6px;\n    }\n\n    .bulk-btn:hover {\n        background: white;\n        color: #1e293b;\n    }\n\n    /* --- Loading Overlay --- */\n    .loading-overlay {\n        position: fixed; inset: 0; background: rgba(255,255,255,0.6);\n        backdrop-filter: blur(2px); z-index: 2000;\n        display: flex; justify-content: center; align-items: center;\n        opacity: 0; pointer-events: none; transition: opacity 0.3s;\n    }\n    .loading-overlay.active { opacity: 1; pointer-events: all; }\n    \n    /* --- Media Queries --- */\n    @media (max-width: 768px) {\n        .task-grid.view-list .task-card {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 12px;\n            padding: 16px;\n        }\n        .task-grid.view-list .card-body {\n            width: 100%;\n            flex-direction: column;\n            align-items: flex-start;\n        }\n        .task-grid.view-list .card-footer {\n            width: 100%;\n            padding-top: 12px;\n            border-top: 1px solid var(--border-color);\n        }\n        .bulk-toolbar {\n            width: 90%;\n            flex-direction: column;\n            border-radius: 16px;\n            padding: 16px;\n            gap: 12px;\n        }\n        .bulk-info { border-right: none; padding-right: 0; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 12px; width: 100%; justify-content: center; }\n        .bulk-actions { width: 100%; justify-content: space-between; }\n        .bulk-btn { flex: 1; justify-content: center; }\n    }\n</style>\n\n<div class="page-container">\n    <!-- Loading -->\n    <div id="loadingOverlay" class="loading-overlay">\n        <div class="spinner" style="width: 40px; height: 40px; border: 3px solid #e2e8f0; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>\n    </div>\n    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>\n\n    <!-- Header -->\n    <div class="page-header">\n        <div class="header-content">\n            <h1 class="page-title">\xe6\x88\x91\xe7\x9a\x84\xe4\xbb\xbb\xe5\x8a\xa1 / My Tasks</h1>\n            <p class="page-subtitle">\xe7\xae\xa1\xe7\x90\x86\xe3\x80\x81\xe8\xbf\xbd\xe8\xb8\xaa\xe4\xb8\x8e\xe4\xba\xa4\xe4\xbb\x98\xe6\x82\xa8\xe7\x9a\x84\xe6\x97\xa5\xe5\xb8\xb8\xe5\xb7\xa5\xe4\xbd\x9c\xe4\xbb\xbb\xe5\x8a\xa1 / Manage, track and deliver your daily tasks</p>\n        </div>\n        \n        <div style="display: flex; gap: 12px; align-items: center;">\n            \n            \n            <!-- View Switcher -->\n            <div class="view-switcher">\n                <button class="view-btn active" data-view="grid" title="\xe7\xbd\x91\xe6\xa0\xbc\xe8\xa7\x86\xe5\x9b\xbe / Grid View" onclick="switchView(\'grid\')">\n                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>\n                </button>\n                <button class="view-btn" data-view="list" title="\xe5\x88\x97\xe8\xa1\xa8\xe8\xa7\x86\xe5\x9b\xbe / List View" onclick="switchView(\'list\')">\n                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>\n                </button>\n                <button class="view-btn" data-view="kanban" title="\xe7\x9c\x8b\xe6\x9d\xbf\xe8\xa7\x86\xe5\x9b\xbe / Kanban View" onclick="switchView(\'kanban\')">\n                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"></rect><path d="M9 3v18"></path><path d="M15 3v18"></path></svg>\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Filter Section -->\n    <div class="filter-panel">\n        <form method="get" id="filterForm" \n              hx-get="/tasks/" \n              hx-target="#taskListContainer" \n              hx-push-url="true" \n              hx-indicator="#loadingOverlay"\n              hx-trigger="change from:select, change from:input[type=\'checkbox\'], submit">\n            \n            <div class="filter-grid">\n                <!-- Search -->\n                <div class="form-group" style="grid-column: 1 / -1; max-width: 600px;">\n                    <label class="form-label">\xe6\x90\x9c\xe7\xb4\xa2 / Search</label>\n                    <div class="search-wrapper">\n                        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>\n                        <input type="text" name="q" class="search-input" value="" placeholder="\xe8\xbe\x93\xe5\x85\xa5\xe6\xa0\x87\xe9\xa2\x98\xe6\x88\x96\xe5\x86\x85\xe5\xae\xb9\xe5\x85\xb3\xe9\x94\xae\xe5\xad\x97... / Enter title or content keyword..."\n                               hx-trigger="keyup changed delay:500ms">\n                    </div>\n                </div>\n\n                <!-- Project -->\n                <div class="form-group">\n                    <label class="form-label">\xe9\xa1\xb9\xe7\x9b\xae / Project</label>\n                    <select name="project" class="form-select">\n                        <option value="">\xe5\x85\xa8\xe9\x83\xa8\xe9\xa1\xb9\xe7\x9b\xae / All Projects</option>\n                        \n                        <option value="1" >P1</option>\n                        \n                    </select>\n                </div>\n\n                <!-- Category -->\n                <div class="form-group">\n                    <label class="form-label">\xe5\x88\x86\xe7\xb1\xbb / Category</label>\n                    <select name="category" class="form-select">\n                        <option value="">\xe5\x85\xa8\xe9\x83\xa8\xe5\x88\x86\xe7\xb1\xbb / All Categories</option>\n                        \n                            <option value="TASK" >\xe4\xbb\xbb\xe5\x8a\xa1-TASK</option>\n                        \n                            <option value="BUG" >\xe7\xbc\xba\xe9\x99\xb7-BUG</option>\n                        \n                    </select>\n                </div>\n\n                <!-- Status -->\n                <div class="form-group">\n                    <label class="form-label">\xe7\x8a\xb6\xe6\x80\x81 / Status</label>\n                    <select name="status" class="form-select">\n                        <option value="">\xe5\x85\xa8\xe9\x83\xa8\xe7\x8a\xb6\xe6\x80\x81 / All Statuses</option>\n                        <option value="todo" >\xe5\xbe\x85\xe5\xa4\x84\xe7\x90\x86 / To Do</option>\n                        <option value="in_progress" >\xe8\xbf\x9b\xe8\xa1\x8c\xe4\xb8\xad / In Progress</option>\n                        <option value="blocked" >\xe9\x98\xbb\xe5\xa1\x9e\xe4\xb8\xad / Blocked</option>\n                        <option value="in_review" >\xe5\xbe\x85\xe8\xaf\x84\xe5\xae\xa1 / In Review</option>\n                        <option value="done" >\xe5\xb7\xb2\xe5\xae\x8c\xe6\x88\x90 / Done</option>\n                        <option value="closed" >\xe5\xb7\xb2\xe5\x85\xb3\xe9\x97\xad / Closed</option>\n                    </select>\n                </div>\n\n                <!-- Priority -->\n                <div class="form-group">\n                    <label class="form-label">\xe4\xbc\x98\xe5\x85\x88\xe7\xba\xa7 / Priority</label>\n                    <select name="priority" class="form-select">\n                        <option value="">\xe5\x85\xa8\xe9\x83\xa8\xe4\xbc\x98\xe5\x85\x88\xe7\xba\xa7 / All Priorities</option>\n                        \n                        <option value="high" >\xe9\xab\x98 / High</option>\n                        \n                        <option value="medium" >\xe4\xb8\xad / Medium</option>\n                        \n                        <option value="low" >\xe4\xbd\x8e / Low</option>\n                        \n                    </select>\n                </div>\n\n                <!-- Sort -->\n                <div class="form-group">\n                    <label class="form-label">\xe6\x8e\x92\xe5\xba\x8f / Sort By</label>\n                    <select name="sort" class="form-select">\n                        <option value="-created_at" selected>\xe5\x88\x9b\xe5\xbb\xba\xe6\x97\xb6\xe9\x97\xb4 (\xe6\x96\xb0\xe2\x86\x92\xe6\x97\xa7) / Created (New\xe2\x86\x92Old)</option>\n                        <option value="created_at" >\xe5\x88\x9b\xe5\xbb\xba\xe6\x97\xb6\xe9\x97\xb4 (\xe6\x97\xa7\xe2\x86\x92\xe6\x96\xb0) / Created (Old\xe2\x86\x92New)</option>\n                        <option value="-priority" >\xe4\xbc\x98\xe5\x85\x88\xe7\xba\xa7 (\xe9\xab\x98\xe2\x86\x92\xe4\xbd\x8e) / Priority (High\xe2\x86\x92Low)</option>\n                        <option value="due_at" >\xe6\x88\xaa\xe6\xad\xa2\xe6\x97\xb6\xe9\x97\xb4 (\xe8\xbf\x91\xe2\x86\x92\xe8\xbf\x9c) / Due Date (Near\xe2\x86\x92Far)</option>\n                    </select>\n                </div>\n            </div>\n\n            <div class="filter-row-bottom">\n                <div style="display: flex; gap: 16px; align-items: center;">\n                    <label class="chip" style="cursor: pointer;">\n                        <input type="checkbox" name="hot" value="1"  style="accent-color: var(--primary);">\n                        <span style="margin-left: 6px; font-weight: 600;">\xf0\x9f\x94\xa5 \xe4\xbb\x85\xe6\x98\xbe\xe7\xa4\xba\xe7\xb4\xa7\xe6\x80\xa5\xe4\xbb\xbb\xe5\x8a\xa1 / Urgent Only</span>\n                    </label>\n                    <label class="chip" style="cursor: pointer;">\n                        <input type="checkbox" id="selectAllCheckbox" style="accent-color: var(--primary);">\n                        <span style="margin-left: 6px;">\xe5\x85\xa8\xe9\x80\x89\xe6\x9c\xac\xe9\xa1\xb5 / Select All</span>\n                    </label>\n                </div>\n                \n                <div class="filter-actions">\n                    <a href="/tasks/" class="btn btn-ghost" onclick="showLoading()">\xe6\xb8\x85\xe9\x99\xa4\xe7\xad\x9b\xe9\x80\x89 / Clear Filters</a>\n                    <a href="/tasks/export/?" class="btn btn-secondary">\n                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>\n                        \xe5\xaf\xbc\xe5\x87\xba / Export\n                    </a>\n                    <!-- Submit button is still useful for explicit refresh -->\n                    <button type="submit" class="btn btn-primary">\xe5\xba\x94\xe7\x94\xa8\xe7\xad\x9b\xe9\x80\x89 / Apply Filter</button>\n                </div>\n            </div>\n        </form>\n    </div>\n\n    <!-- Main Content Area -->\n    <div id="taskListContainer">\n        <form id="bulkForm" method="post" action="/tasks/bulk/">\n    <input type="hidden" name="csrfmiddlewaretoken" value="8aqvOBERrlxPS8zCZOPN9Aj9ECKKSkCjvSjQ9ASK5kYCqpWqdwBQCPIW5xAYNnw7">\n    <input type="hidden" name="bulk_action" id="bulkActionInput">\n    <input type="hidden" name="redirect_to" value="/tasks/">\n\n    \n        <!-- Grid/List View Container -->\n        <div id="taskGrid" class="task-grid">\n            \n            <article class="task-card" id="task-1" data-status="todo" data-id="1">\n                <div class="card-status-bar status-todo"></div>\n                \n                <div class="task-checkbox-container">\n                    <input type="checkbox" name="task_ids" value="1" class="task-checkbox" style="width: 18px; height: 18px; cursor: pointer;">\n                </div>\n\n                <div class="card-body">\n                    <div class="badge-group">\n                        <span class="chip" style="background: white; border: 1px solid var(--border-color); font-size: 10px;">P1</span>\n                        \n                            <span class="chip" style="background: #eff6ff; color: #1d4ed8; border: 1px solid #dbeafe; font-size: 10px;">TASK</span>\n                        \n                        \n                        \n                    </div>\n\n                    <h3 class="task-title">\n                        <a href="/tasks/1/view/">t1</a>\n                    </h3>\n\n                    <p class="task-content">\n                        \xe6\x97\xa0\xe8\xaf\xa6\xe7\xbb\x86\xe5\x86\x85\xe5\xae\xb9 / No details\n                    </p>\n\n                    <div class="card-meta-grid">\n                        <div class="meta-item">\n                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>\n                            <span class="">\n                                --\n                            </span>\n                        </div>\n                        <div class="meta-item">\n                            <span class="status-dot" style="width: 8px; height: 8px; border-radius: 50%; background: var(--text-muted)"></span>\n                            <span>\xe5\xbe\x85\xe5\xa4\x84\xe7\x90\x86 / To Do</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card-footer">\n                    \n\n\n<div class="avatar-component" style="\n    width: 32px; \n    height: 32px; \n    border-radius: 50%; \n    overflow: hidden; \n    background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%); \n    color: #3b82f6; \n    display: inline-flex; \n    align-items: center; \n    justify-content: center; \n    font-weight: 700; \n    font-size: 12px;\n    flex-shrink: 0;\n    border: 1px solid rgba(255,255,255,0.5);\n    box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n    position: relative;\n    \n">\n    \n        <span>A</span>\n    \n</div>\n\n\n                    <div style="display: flex; gap: 8px;">\n                        \n                        <button type="submit" name="action" value="complete" formaction="/tasks/1/complete/?next=/tasks/" class="btn btn-sm btn-secondary" onclick="showLoading()">\n                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>\n                            \xe5\xae\x8c\xe6\x88\x90 / Complete\n                        </button>\n                        \n                        <a href="/tasks/1/view/" class="btn btn-sm btn-ghost">\xe8\xaf\xa6\xe6\x83\x85 / Details</a>\n                    </div>\n                </div>\n            </article>\n            \n        </div>\n\n        <!-- Kanban View Container (Populated via JS) -->\n        <div id="kanbanBoard" class="kanban-container">\n            <div class="kanban-column" data-status="todo">\n                <div class="kanban-header">\xe5\xbe\x85\xe5\xa4\x84\xe7\x90\x86 / To Do <span class="count" id="count-todo">0</span></div>\n                <div class="kanban-body" id="col-todo"></div>\n            </div>\n            <div class="kanban-column" data-status="in_progress">\n                <div class="kanban-header">\xe8\xbf\x9b\xe8\xa1\x8c\xe4\xb8\xad / In Progress <span class="count" id="count-in_progress">0</span></div>\n                <div class="kanban-body" id="col-in_progress"></div>\n            </div>\n            <div class="kanban-column" data-status="in_review">\n                <div class="kanban-header">\xe5\xbe\x85\xe8\xaf\x84\xe5\xae\xa1 / Review <span class="count" id="count-in_review">0</span></div>\n                <div class="kanban-body" id="col-in_review"></div>\n            </div>\n            <div class="kanban-column" data-status="blocked">\n                <div class="kanban-header">\xe9\x98\xbb\xe5\xa1\x9e / Blocked <span class="count" id="count-blocked">0</span></div>\n                <div class="kanban-body" id="col-blocked"></div>\n            </div>\n            <div class="kanban-column" data-status="done">\n                <div class="kanban-header">\xe5\xb7\xb2\xe5\xae\x8c\xe6\x88\x90 / Done <span class="count" id="count-done">0</span></div>\n                <div class="kanban-body" id="col-done"></div>\n            </div>\n        </div>\n\n    \n\n    <!-- Sticky Bulk Toolbar -->\n    <div id="bulkToolbar" class="bulk-toolbar">\n        <div class="bulk-info">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>\n            <span>\xe5\xb7\xb2\xe9\x80\x89\xe6\x8b\xa9 <span id="selectedCount">0</span> \xe9\xa1\xb9 / Selected</span>\n        </div>\n        <div class="bulk-actions">\n            <button type="button" class="bulk-btn" onclick="submitBulk(\'complete\')">\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>\n                \xe6\xa0\x87\xe8\xae\xb0\xe5\xae\x8c\xe6\x88\x90 / Mark Complete\n            </button>\n            <button type="button" class="bulk-btn" onclick="submitBulk(\'reopen\')">\n                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path></svg>\n                \xe9\x87\x8d\xe6\x96\xb0\xe6\x89\x93\xe5\xbc\x80 / Reopen\n            </button>\n            \n        </div>\n    </div>\n</form>\n\n<!-- Pagination -->\n\n\n    </div>\n\n</div>\n\n<script>\n    // --- Global Helpers ---\n    function showLoading() {\n        document.getElementById(\'loadingOverlay\').classList.add(\'active\');\n    }\n\n    // --- View Switcher Logic ---\n    function switchView(viewName) {\n        localStorage.setItem(\'taskViewMode\', viewName);\n        applyView(viewName);\n    }\n\n    function applyView(viewName) {\n        const grid = document.getElementById(\'taskGrid\');\n        const kanban = document.getElementById(\'kanbanBoard\');\n        const btns = document.querySelectorAll(\'.view-btn\');\n        const pagination = document.getElementById(\'paginationControl\');\n        \n        if (!grid) return; // Empty state\n\n        // Update Buttons\n        btns.forEach(btn => {\n            if (btn.dataset.view === viewName) btn.classList.add(\'active\');\n            else btn.classList.remove(\'active\');\n        });\n\n        // Toggle Views\n        if (viewName === \'kanban\') {\n            grid.style.display = \'none\';\n            kanban.classList.add(\'active\');\n            distributeToKanban();\n            if (pagination) pagination.style.display = \'flex\'; \n        } else {\n            kanban.classList.remove(\'active\');\n            grid.style.display = \'grid\';\n            \n            if (viewName === \'list\') {\n                grid.classList.add(\'view-list\');\n            } else {\n                grid.classList.remove(\'view-list\');\n            }\n            if (pagination) pagination.style.display = \'flex\';\n        }\n    }\n\n    // --- Kanban Logic (Client-side Distribution) ---\n    // Make this global so it persists\n    window.kanbanDistributed = false;\n    \n    function distributeToKanban() {\n        if (window.kanbanDistributed) return; // Already done\n        \n        const tasks = document.querySelectorAll(\'.task-card\');\n        const colMap = {\n            \'todo\': document.getElementById(\'col-todo\'),\n            \'in_progress\': document.getElementById(\'col-in_progress\'),\n            \'in_review\': document.getElementById(\'col-in_review\'),\n            \'blocked\': document.getElementById(\'col-blocked\'),\n            \'done\': document.getElementById(\'col-done\'),\n            \'closed\': document.getElementById(\'col-done\') // Merge closed to done\n        };\n        \n        // Check if columns exist (might be empty state)\n        if (!colMap[\'todo\']) return;\n\n        // Reset columns if needed (for re-runs)\n        Object.values(colMap).forEach(col => col.innerHTML = \'\');\n\n        // Counters\n        const counts = { todo:0, in_progress:0, in_review:0, blocked:0, done:0 };\n\n        tasks.forEach(task => {\n            const status = task.dataset.status;\n            const targetCol = colMap[status] || colMap[\'todo\']; // Fallback\n            \n            // Clone the card for Kanban display\n            const clone = task.cloneNode(true);\n            clone.id = \'kanban-\' + task.id;\n            \n            // Remove checkbox from Kanban card (Keep it read-only)\n            const cb = clone.querySelector(\'.task-checkbox-container\');\n            if(cb) cb.remove();\n            \n            // Update Card Footer for Kanban (simplify)\n            const footer = clone.querySelector(\'.card-footer\');\n            if(footer) footer.style.padding = \'8px 12px\';\n            \n            targetCol.appendChild(clone);\n            \n            // Count\n            if (status === \'closed\') counts[\'done\']++;\n            else if (counts[status] !== undefined) counts[status]++;\n        });\n\n        // Update counts\n        for (const [k, v] of Object.entries(counts)) {\n            const el = document.getElementById(\'count-\' + k);\n            if(el) el.textContent = v;\n        }\n\n        window.kanbanDistributed = true;\n    }\n\n    // --- Bulk Actions Helper ---\n    function updateToolbar() {\n        const checked = document.querySelectorAll(\'.task-checkbox:checked\');\n        const toolbar = document.getElementById(\'bulkToolbar\');\n        const countSpan = document.getElementById(\'selectedCount\');\n        \n        if (!toolbar) return;\n\n        if (checked.length > 0) {\n            toolbar.classList.add(\'visible\');\n            countSpan.textContent = checked.length;\n            // Highlight cards\n            document.querySelectorAll(\'.task-card\').forEach(c => c.classList.remove(\'selected\'));\n            checked.forEach(cb => {\n                const card = cb.closest(\'.task-card\');\n                if(card) card.classList.add(\'selected\');\n            });\n        } else {\n            toolbar.classList.remove(\'visible\');\n            document.querySelectorAll(\'.task-card\').forEach(c => c.classList.remove(\'selected\'));\n        }\n    }\n\n    // --- Initialization Logic ---\n    function initTaskPage() {\n        // Reset kanban flag on re-init\n        window.kanbanDistributed = false;\n\n        // Init View\n        const savedView = localStorage.getItem(\'taskViewMode\') || \'grid\';\n        applyView(savedView);\n        \n        // Remove loading overlay\n        document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n\n        // Note: Checkbox listeners are handled via delegation below\n        // Just update toolbar state in case of browser bfcache or preserved state\n        updateToolbar();\n    }\n\n    // --- Event Delegation & Lifecycle ---\n    document.addEventListener(\'DOMContentLoaded\', function() {\n        \n        // 1. Initial Setup\n        initTaskPage();\n\n        // 2. Select All Logic (Persistent Element)\n        const selectAllCheckbox = document.getElementById(\'selectAllCheckbox\');\n        if (selectAllCheckbox) {\n            selectAllCheckbox.addEventListener(\'change\', function() {\n                const isChecked = this.checked;\n                // Query current checkboxes\n                document.querySelectorAll(\'.task-checkbox\').forEach(cb => cb.checked = isChecked);\n                updateToolbar();\n            });\n        }\n\n        // 3. Global Bulk Submit\n        window.submitBulk = function(action) {\n            const checked = document.querySelectorAll(\'.task-checkbox:checked\');\n            if (checked.length === 0) return;\n            \n            if (confirm(`\xe7\xa1\xae\xe5\xae\x9a\xe8\xa6\x81\xe5\xaf\xb9 ${checked.length} \xe4\xb8\xaa\xe4\xbb\xbb\xe5\x8a\xa1\xe6\x89\xa7\xe8\xa1\x8c\xe6\xad\xa4\xe6\x93\x8d\xe4\xbd\x9c\xe5\x90\x97\xef\xbc\x9f / Are you sure you want to perform this action on ${checked.length} tasks?`)) {\n                showLoading();\n                document.getElementById(\'bulkActionInput\').value = action;\n                document.getElementById(\'bulkForm\').submit();\n            }\n        };\n\n        // 4. Bfcache fix\n        window.addEventListener(\'pageshow\', function(event) {\n            if (event.persisted) {\n                document.getElementById(\'loadingOverlay\').classList.remove(\'active\');\n            }\n        });\n    });\n\n    // 5. Event Delegation for Checkboxes (Handles dynamic content)\n    document.body.addEventListener(\'change\', function(e) {\n        if (e.target.matches(\'.task-checkbox\')) {\n            updateToolbar();\n            // Update Select All state\n            const selectAllCheckbox = document.getElementById(\'selectAllCheckbox\');\n            if (!e.target.checked && selectAllCheckbox) {\n                selectAllCheckbox.checked = false;\n            }\n        }\n    });\n\n    // 6. HTMX After Swap Hook\n    document.body.addEventListener(\'htmx:afterSwap\', function(evt) {\n        if (evt.target.id === \'taskListContainer\') {\n            initTaskPage();\n        }\n    });\n\n</script>\n\n    </main>\n</div>\n    \n    <script src="/static/js/command_palette.js"></script>\n</body>\n</html>\n'

======================================================================
FAIL: test_task_stats_page_renders (workreport.tests.test_ui_rendering.UIRenderingTests.test_task_stats_page_renders)
Test that the task stats page renders correctly with the new structure.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/Users/arlo/Downloads/workreport/tests/test_ui_rendering.py", line 38, in test_task_stats_page_renders
    self.assertContains(response, 'summary-grid') # Updated from dashboard-grid
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: False is not true : Couldn't find 'summary-grid' in the following response
b'<!DOCTYPE html>\n<html lang="zh-CN">\n\n\n<head>\n    <meta charset="UTF-8">\n    <title>\xe7\xbb\xa9\xe6\x95\x88\xe4\xb8\x8e\xe7\xbb\x9f\xe8\xae\xa1\xe7\x9c\x8b\xe6\x9d\xbf / Performance Dashboard</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <link rel="preconnect" href="https://fonts.loli.net">\n    <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>\n    <link href="https://fonts.loli.net/css2?family=Space+Grotesk:wght@500;600;700&family=Noto+Sans+SC:wght@400;500;600&display=swap" rel="stylesheet">\n    <!-- Font Awesome -->\n    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\n    <link rel="stylesheet" href="/static/css/workreport.css">\n    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>\n    <style>\n        :root {\n            /* Core Palette */\n            --primary: #3b82f6;\n            --primary-hover: #2563eb;\n            --secondary: #64748b;\n            --bg-page: #f8fafc;\n            --bg-card: #ffffff;\n            --text-main: #1e293b;\n            --text-secondary: #64748b;\n            --border-color: #e2e8f0;\n            \n            /* Legacy mappings */\n            --bg: var(--bg-page);\n            --panel: var(--bg-card);\n            --card: var(--bg-card);\n            --ink: var(--text-main);\n            --muted: var(--text-secondary);\n            --primary-2: #06b6d4;\n            --accent: #f59e0b;\n            --success: #10b981;\n            --border: var(--border-color);\n            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n            --radius-lg: 20px;\n            --radius-md: 14px;\n            --radius-sm: 10px;\n        }\n        * { box-sizing: border-box; }\n        body {\n            margin: 0;\n            font-family: \'Space Grotesk\', \'Noto Sans SC\', \'SF Pro Display\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\n            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 25%, #f0fdf4 50%, #fef3c7 75%, #fef2f2 100%);\n            background-attachment: fixed;\n            color: var(--ink);\n            min-height: 100vh;\n        }\n        .page { position: relative; min-height: 100vh; overflow: hidden; }\n        .page::after {\n            content: \'\';\n            position: absolute;\n            inset: 0;\n            background: radial-gradient(circle at 40% 0%, rgba(255, 255, 255, 0.6), transparent 25%),\n                        radial-gradient(circle at 70% 20%, rgba(37, 99, 235, 0.08), transparent 30%);\n            pointer-events: none;\n            z-index: 0;\n        }\n        .content { position: relative; z-index: 1; padding: 24px clamp(24px, 5vw, 48px) 48px; max-width: 1600px; margin: 0 auto; }\n        .topbar {\n            position: sticky;\n            top: 0;\n            z-index: 5;\n            backdrop-filter: blur(20px);\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));\n            border-bottom: 1px solid rgba(59, 130, 246, 0.15);\n            padding: 16px clamp(20px, 4vw, 40px);\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            gap: 20px;\n            flex-wrap: wrap;\n            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.12);\n            border-radius: 0 0 24px 24px;\n            margin-bottom: 8px;\n            position: relative;\n        }\n\n        .topbar::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            height: 3px;\n            background: linear-gradient(90deg, var(--primary), var(--primary-2), var(--accent));\n            opacity: 0.8;\n        }\n\n        .topbar::after {\n            content: \'\';\n            position: absolute;\n            top: -30%;\n            right: -5%;\n            width: 300px;\n            height: 300px;\n            background: radial-gradient(circle, rgba(59, 130, 246, 0.06) 0%, transparent 70%);\n            border-radius: 50%;\n            animation: float 8s ease-in-out infinite;\n            pointer-events: none;\n        }\n        .brand { \n            display: flex; \n            align-items: center; \n            gap: 16px; \n            position: relative;\n            z-index: 1;\n        }\n        .brand-mark {\n            width: 48px; height: 48px;\n            border-radius: 16px;\n            background: linear-gradient(135deg, var(--primary), var(--primary-2));\n            color: #fff;\n            display: grid; place-items: center;\n            font-weight: 700; letter-spacing: 0.04em;\n            font-size: 16px;\n            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.35);\n            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n            position: relative;\n            overflow: hidden;\n        }\n        .brand-mark::before {\n            content: \'\';\n            position: absolute;\n            top: -50%;\n            left: -50%;\n            width: 200%;\n            height: 200%;\n            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.4), transparent);\n            animation: rotate 4s linear infinite;\n        }\n        @keyframes rotate {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        @keyframes float {\n            0%, 100% { transform: translateY(0px); }\n            50% { transform: translateY(-10px); }\n        }\n        .brand-mark:hover {\n            transform: scale(1.08) rotate(8deg);\n            box-shadow: 0 16px 32px rgba(59, 130, 246, 0.45);\n        }\n        .brand-title { \n            font-weight: 700; \n            font-size: 20px; \n            line-height: 1.2;\n            background: linear-gradient(135deg, var(--ink), var(--primary));\n            -webkit-background-clip: text;\n            -webkit-text-fill-color: transparent;\n            background-clip: text;\n        }\n        .brand-sub { \n            color: var(--muted); \n            font-size: 13px;\n            margin-top: 2px;\n            font-weight: 500;\n        }\n        .actions { \n            display: flex; \n            gap: 12px; \n            align-items: center; \n            flex-wrap: wrap; \n            margin-top: 6px;\n            position: relative;\n            z-index: 1;\n        }\n        .nav-toggle {\n            display: none;\n            border: 1px solid rgba(59, 130, 246, 0.2);\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));\n            backdrop-filter: blur(10px);\n            border-radius: 14px;\n            padding: 10px 14px;\n            font-size: 14px;\n            font-weight: 600;\n            cursor: pointer;\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);\n        }\n        .nav-toggle:hover {\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(6, 182, 212, 0.08));\n            border-color: rgba(59, 130, 246, 0.3);\n            transform: translateY(-1px);\n            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.15);\n        }\n        .nav-toggle:active { \n            transform: translateY(0px) scale(0.98); \n            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);\n        }\n        .pill, .ghost-link {\n            text-decoration: none;\n            font-weight: 600;\n            border-radius: 999px;\n            padding: 10px 16px;\n            font-size: 13px;\n            border: 1px solid transparent;\n            position: relative;\n            overflow: hidden;\n            backdrop-filter: blur(10px);\n            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .pill {\n            background: linear-gradient(135deg, var(--primary), var(--primary-2));\n            color: #fff;\n            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.35);\n            position: relative;\n        }\n        .pill::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);\n            transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .pill:hover::before {\n            left: 100%;\n        }\n        .pill:hover {\n            transform: translateY(-3px) scale(1.05);\n            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.45);\n        }\n        .ghost-link {\n            color: var(--ink);\n            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.7));\n            border-color: rgba(59, 130, 246, 0.2);\n            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.08);\n        }\n        .ghost-link::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);\n            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);\n        }\n        .ghost-link:hover::before {\n            left: 100%;\n        }\n        .ghost-link:hover {\n            background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(6, 182, 212, 0.12));\n            border-color: rgba(59, 130, 246, 0.3);\n            transform: translateY(-2px) scale(1.02);\n            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.2);\n        }\n        .ghost-link.active {\n            background: linear-gradient(135deg, rgba(37, 99, 235, 0.15), rgba(6, 182, 212, 0.15));\n            border-color: rgba(37, 99, 235, 0.4);\n            color: var(--primary);\n            box-shadow: 0 6px 18px rgba(37, 99, 235, 0.25);\n            font-weight: 700;\n        }\n        .chip {\n            display: inline-flex; align-items: center; gap: 6px;\n            padding: 7px 10px;\n            border-radius: 12px;\n            border: 1px dashed rgba(15, 23, 42, 0.12);\n            background: rgba(15, 23, 42, 0.02);\n            font-size: 12px; color: var(--muted);\n        }\n        .flash-stack { display:grid; gap:8px; margin-bottom:12px; }\n        .flash { \n            padding:12px 16px; \n            border-radius:14px; \n            font-size:12px; \n            border:1px solid var(--border); \n            box-shadow:0 8px 20px rgba(59,130,246,0.1);\n            backdrop-filter: blur(8px);\n            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            position: relative;\n            overflow: hidden;\n        }\n        .flash::before {\n            content: \'\';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);\n            transition: left 0.6s ease;\n        }\n        .flash:hover::before {\n            left: 100%;\n        }\n        .flash:hover {\n            transform: translateY(-1px) scale(1.01);\n            box-shadow:0 12px 28px rgba(59,130,246,0.15);\n        }\n        .flash-success { background: rgba(16,185,129,0.12); color:#065f46; border-color: rgba(16,185,129,0.35); }\n        .flash-error { background: rgba(239,68,68,0.12); color:#991b1b; border-color: rgba(239,68,68,0.35); }\n        .flash-info { background: rgba(59,130,246,0.12); color:#1d4ed8; border-color: rgba(59,130,246,0.35); }\n        @media (max-width: 860px) {\n            .topbar { \n                align-items: flex-start; \n                padding: 14px clamp(16px, 4vw, 24px);\n                border-radius: 0 0 20px 20px;\n            }\n            .nav-toggle { display: inline-flex; }\n            .actions {\n                display: none;\n                width: 100%;\n                flex-direction: column;\n                align-items: stretch;\n                gap: 10px;\n                margin-top: 12px;\n                padding-top: 12px;\n                border-top: 1px solid rgba(59, 130, 246, 0.1);\n            }\n            .actions.open { display: flex; }\n            .ghost-link, .pill { \n                width: 100%; \n                text-align: center; \n                justify-content: center;\n                padding: 12px 16px;\n            }\n            .brand {\n                gap: 12px;\n            }\n            .brand-mark {\n                width: 40px;\n                height: 40px;\n                font-size: 14px;\n            }\n            .brand-title {\n                font-size: 16px;\n            }\n            .brand-sub {\n                font-size: 11px;\n            }\n        }\n        \n    :root {\n        --dash-bg: #f8fafc;\n        --card-bg: #ffffff;\n        --card-radius: 16px;\n        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);\n        --text-main: #1e293b;\n        --text-secondary: #64748b;\n        --text-muted: #94a3b8;\n        --border-color: #e2e8f0;\n        \n        --color-primary: var(--primary, #3b82f6);\n        --color-success: #10b981;\n        --color-warning: #f59e0b;\n        --color-danger: #ef4444;\n        --color-info: #06b6d4;\n    }\n\n    .dashboard-container {\n        display: flex;\n        flex-direction: column;\n        gap: 24px;\n        padding-bottom: 60px;\n        max-width: 1600px;\n        margin: 0 auto;\n        width: 100%;\n    }\n\n    /* 1. Filter Section */\n    .filter-section {\n        background: var(--card-bg);\n        border-radius: var(--card-radius);\n        padding: 20px 24px;\n        box-shadow: var(--card-shadow);\n        display: flex;\n        flex-wrap: wrap;\n        gap: 20px;\n        align-items: flex-end;\n        border: 1px solid rgba(226, 232, 240, 0.6);\n    }\n\n    .filter-group {\n        display: flex;\n        flex-direction: column;\n        gap: 8px;\n    }\n\n    .filter-label {\n        font-size: 12px;\n        font-weight: 700;\n        color: var(--text-secondary);\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n    }\n\n    .period-selector {\n        display: inline-flex;\n        background: #f1f5f9;\n        padding: 4px;\n        border-radius: 10px;\n        gap: 2px;\n    }\n\n    .period-btn {\n        padding: 8px 16px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        transition: all 0.2s ease;\n    }\n\n    .period-btn:hover {\n        color: var(--text-main);\n        background: rgba(255, 255, 255, 0.6);\n    }\n\n    .period-btn.active {\n        background: #ffffff;\n        color: var(--color-primary);\n        box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n    }\n\n    .form-control {\n        padding: 10px 14px;\n        border: 1px solid var(--border-color);\n        border-radius: 8px;\n        font-size: 14px;\n        color: var(--text-main);\n        background: #fff;\n        transition: border-color 0.2s;\n        min-width: 160px;\n    }\n    .form-control:focus {\n        outline: none;\n        border-color: var(--color-primary);\n        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n    }\n\n    /* 2. KPI Cards */\n    .kpi-row {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n        gap: 24px;\n    }\n\n    .kpi-card {\n        background: var(--card-bg);\n        border-radius: var(--card-radius);\n        padding: 24px;\n        box-shadow: var(--card-shadow);\n        display: flex;\n        flex-direction: column;\n        position: relative;\n        overflow: hidden;\n        border: 1px solid rgba(226, 232, 240, 0.6);\n        transition: transform 0.2s, box-shadow 0.2s;\n    }\n\n    .kpi-card:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n    }\n\n    .kpi-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-start;\n        margin-bottom: 16px;\n    }\n\n    .kpi-icon-wrapper {\n        width: 48px;\n        height: 48px;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 24px;\n    }\n\n    .kpi-title {\n        font-size: 14px;\n        color: var(--text-secondary);\n        font-weight: 500;\n        margin-top: 4px;\n    }\n\n    .kpi-value {\n        font-size: 36px;\n        font-weight: 800;\n        color: var(--text-main);\n        line-height: 1;\n        letter-spacing: -0.03em;\n        margin-bottom: 8px;\n    }\n\n    .kpi-footer {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        font-size: 13px;\n    }\n\n    .trend-badge {\n        display: inline-flex;\n        align-items: center;\n        padding: 2px 8px;\n        border-radius: 20px;\n        font-weight: 600;\n        font-size: 12px;\n    }\n    .trend-up { background: #dcfce7; color: #166534; }\n    .trend-down { background: #fee2e2; color: #991b1b; }\n    .trend-neutral { background: #f1f5f9; color: #64748b; }\n\n    /* 3. Charts Section */\n    .chart-grid {\n        display: grid;\n        grid-template-columns: 2fr 1fr;\n        gap: 24px;\n    }\n\n    .chart-card {\n        background: var(--card-bg);\n        border-radius: var(--card-radius);\n        padding: 24px;\n        box-shadow: var(--card-shadow);\n        border: 1px solid rgba(226, 232, 240, 0.6);\n        display: flex;\n        flex-direction: column;\n        min-height: 420px;\n    }\n\n    .chart-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 24px;\n    }\n\n    .chart-title {\n        font-size: 18px;\n        font-weight: 700;\n        color: var(--text-main);\n    }\n\n    .chart-legend {\n        display: flex;\n        gap: 16px;\n    }\n    .legend-item {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        font-size: 13px;\n        color: var(--text-secondary);\n    }\n    .legend-dot {\n        width: 10px; height: 10px; border-radius: 50%;\n    }\n\n    /* 4. Table Section */\n    .table-card {\n        background: var(--card-bg);\n        border-radius: var(--card-radius);\n        box-shadow: var(--card-shadow);\n        border: 1px solid rgba(226, 232, 240, 0.6);\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .table-tabs {\n        display: flex;\n        padding: 0 24px;\n        border-bottom: 1px solid var(--border-color);\n        background: #fafafa;\n    }\n\n    .tab-item {\n        padding: 20px 0;\n        margin-right: 32px;\n        font-size: 15px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        cursor: pointer;\n        position: relative;\n        transition: color 0.2s;\n    }\n\n    .tab-item:hover {\n        color: var(--text-main);\n    }\n\n    .tab-item.active {\n        color: var(--color-primary);\n    }\n\n    .tab-item.active::after {\n        content: \'\';\n        position: absolute;\n        bottom: -1px; left: 0; right: 0;\n        height: 3px;\n        background: var(--color-primary);\n        border-radius: 3px 3px 0 0;\n    }\n\n    .table-container {\n        height: 500px;\n        overflow-y: auto;\n        scrollbar-width: thin;\n        scrollbar-color: #cbd5e1 transparent;\n    }\n    .table-container::-webkit-scrollbar { width: 6px; }\n    .table-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }\n\n    .data-table {\n        width: 100%;\n        border-collapse: separate;\n        border-spacing: 0;\n    }\n\n    .data-table th {\n        position: sticky;\n        top: 0;\n        background: #fff;\n        z-index: 10;\n        padding: 16px 24px;\n        text-align: left;\n        font-size: 13px;\n        font-weight: 600;\n        color: var(--text-secondary);\n        border-bottom: 1px solid var(--border-color);\n        box-shadow: 0 1px 0 rgba(0,0,0,0.05);\n    }\n\n    .data-table td {\n        padding: 16px 24px;\n        border-bottom: 1px solid #f1f5f9;\n        font-size: 14px;\n        color: var(--text-main);\n        vertical-align: middle;\n    }\n\n    .data-table tr:hover td {\n        background: #f8fafc;\n    }\n\n    .data-table tr:last-child td {\n        border-bottom: none;\n    }\n\n    /* Utilities */\n    .text-right { text-align: right !important; }\n    .text-center { text-align: center !important; }\n    \n    .progress-bar {\n        height: 6px;\n        background: #f1f5f9;\n        border-radius: 3px;\n        overflow: hidden;\n        width: 100%;\n        min-width: 80px;\n    }\n    .progress-value {\n        height: 100%;\n        border-radius: 3px;\n        transition: width 0.5s ease;\n    }\n\n    .avatar-sm {\n        width: 32px; height: 32px;\n        border-radius: 50%;\n        background: #e2e8f0;\n        display: flex; align-items: center; justify-content: center;\n        font-size: 12px; font-weight: 600; color: #64748b;\n        margin-right: 12px;\n    }\n    \n    .user-cell { display: flex; align-items: center; }\n\n    @media (max-width: 1024px) {\n        .chart-grid { grid-template-columns: 1fr; }\n    }\n    @media (max-width: 640px) {\n        .kpi-row { grid-template-columns: 1fr; }\n        .filter-section { flex-direction: column; align-items: stretch; }\n        .form-control { width: 100%; }\n    }\n\n    </style>\n</head>\n<body>\n<div class="page">\n    \n<header class="topbar">\n    <div class="brand">\n        <div class="brand-mark">TM</div>\n        <div>\n            <div class="brand-title">\xe7\xbb\xa9\xe6\x95\x88\xe4\xb8\x8e\xe7\xbb\x9f\xe8\xae\xa1\xe7\x9c\x8b\xe6\x9d\xbf / Performance Dashboard</div>\n            <div class="brand-sub">\xe5\x85\xa8\xe6\x96\xb9\xe4\xbd\x8d\xe6\x95\xb0\xe6\x8d\xae\xe6\xb4\x9e\xe5\xaf\x9f\xe4\xb8\x8e\xe5\x9b\xa2\xe9\x98\x9f\xe6\x95\x88\xe8\x83\xbd\xe5\x88\x86\xe6\x9e\x90 / Comprehensive data insights and team performance analysis</div>\n        </div>\n    </div>\n    <button class="nav-toggle" id="nav-toggle" aria-label="\xe5\x88\x87\xe6\x8d\xa2\xe8\x8f\x9c\xe5\x8d\x95 / Toggle menu">\xe2\x98\xb0 \xe8\x8f\x9c\xe5\x8d\x95 / Menu</button>\n    <div class="actions" id="nav-actions">\n        <!-- \xe4\xb8\xaa\xe4\xba\xba\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8f\xb0 - \xe9\xa6\x96\xe9\xa1\xb5\xe6\xa6\x82\xe8\xa7\x88 -->\n        <a class="ghost-link " href="/reports/workbench/">\xe5\xb7\xa5\xe4\xbd\x9c\xe5\x8f\xb0 / Workbench</a>\n        <!-- \xe9\xa1\xb9\xe7\x9b\xae\xe7\xae\xa1\xe7\x90\x86 -->\n        <a class="ghost-link " href="/projects/">\xe9\xa1\xb9\xe7\x9b\xae / Projects</a>   \n        <!-- \xe6\xa0\xb8\xe5\xbf\x83\xe5\x8a\x9f\xe8\x83\xbd - \xe6\x97\xa5\xe5\xb8\xb8\xe5\xb7\xa5\xe4\xbd\x9c -->\n        <a class="ghost-link " href="/tasks/">\xe4\xbb\xbb\xe5\x8a\xa1 / My Tasks</a>\n        <a class="ghost-link " href="/reports/my/">\xe6\x97\xa5\xe6\x8a\xa5 / My Reports</a>\n        <a class="ghost-link " href="/reports/new/">\xe5\x86\x99\xe6\x97\xa5\xe6\x8a\xa5 / New Report</a>\n        \n        <!-- \xe7\xae\xa1\xe7\x90\x86\xe5\x8a\x9f\xe8\x83\xbd - \xe7\xae\xa1\xe7\x90\x86\xe5\x91\x98\xe4\xb8\x93\xe7\x94\xa8\xef\xbc\x88\xe4\xb8\x8b\xe6\x8b\x89\xe5\x90\x88\xe5\xb9\xb6\xef\xbc\x89 -->\n        \n            \n                \n                <div class="admin-dropdown">\n                    <button type="button" class="ghost-link admin-toggle" id="admin-toggle">\n                        \xe7\xae\xa1\xe7\x90\x86\xe5\x85\xa5\xe5\x8f\xa3 / Admin\n                        <span aria-hidden="true">\xe2\x96\xbe</span>\n                    </button>\n                    <div class="admin-menu" id="admin-menu">\n                        \n                            <a class="" href="/tasks/admin/">\xe4\xbb\xbb\xe5\x8a\xa1\xe7\xae\xa1\xe7\x90\x86 / Tasks Admin</a>\n                            <a class="" href="/reports/admin/reports/">\xe6\x97\xa5\xe6\x8a\xa5\xe7\xae\xa1\xe7\x90\x86 / Reports Admin</a>\n                            <a class="active" href="/tasks/admin/stats/">\xe4\xbb\xbb\xe5\x8a\xa1\xe7\xbb\x9f\xe8\xae\xa1 / Task Stats</a>\n                            <a class="" href="/reports/teams/">\xe5\x9b\xa2\xe9\x98\x9f\xe7\xae\xa1\xe7\x90\x86 / Team Management</a>\n                        \n                        \n                            <a class="" href="/reports/performance/">\xe7\xbb\xa9\xe6\x95\x88\xe7\x9c\x8b\xe6\x9d\xbf / Performance Board</a>\n                            <a class="" href="/reports/templates/center/">\xe6\xa8\xa1\xe6\x9d\xbf\xe4\xb8\xad\xe5\xbf\x83 / Template Center</a>\n                            <a class="" href="/reports/templates/roles/">\xe8\xa7\x92\xe8\x89\xb2\xe6\xa8\xa1\xe6\x9d\xbf / Role Templates</a>\n                            <a class="" href="/reports/audit/">\xe5\xae\xa1\xe8\xae\xa1\xe6\x97\xa5\xe5\xbf\x97 / Audit Logs</a>\n                            <a class="" href="/tasks/sla/settings/">SLA \xe9\x85\x8d\xe7\xbd\xae / SLA Settings</a>\n                        \n                    </div>\n                </div>\n            \n        \n        \n        <!-- \xe7\x94\xa8\xe6\x88\xb7\xe6\x93\x8d\xe4\xbd\x9c -->\n        \n            <!-- Global Search Input -->\n            <form action="/reports/search/" method="get" style="margin-right: 8px;">\n                <input type="text" name="q" placeholder="\xf0\x9f\x94\x8d \xe6\x90\x9c\xe7\xb4\xa2 / Search..." \n                       style="padding: 8px 14px; border-radius: 99px; border: 1px solid rgba(59,130,246,0.2); background: rgba(255,255,255,0.6); font-size: 13px; width: 180px; transition: all 0.2s; outline: none;"\n                       onfocus="this.style.width=\'240px\'; this.style.background=\'#fff\'; this.style.boxShadow=\'0 4px 12px rgba(59,130,246,0.1)\'"\n                       onblur="this.style.width=\'180px\'; this.style.background=\'rgba(255,255,255,0.6)\'; this.style.boxShadow=\'none\'">\n            </form>\n\n            <div class="notification-center" id="notification-center">\n    <button class="ghost-link icon-btn" id="bell-btn" aria-label="Notifications">\n        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>\n            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>\n        </svg>\n        <span class="badge" id="notification-badge" style="display: none;">0</span>\n    </button>\n    \n    <div class="notification-dropdown" id="notification-dropdown">\n        <div class="dropdown-header">\n            <h3>\xe9\x80\x9a\xe7\x9f\xa5 / Notifications</h3>\n            <button class="text-btn" id="mark-all-read">\xe5\x85\xa8\xe9\x83\xa8\xe5\xb7\xb2\xe8\xaf\xbb / Mark all read</button>\n        </div>\n        <div class="notification-list" id="notification-list">\n            <div class="empty-state">\xe5\x8a\xa0\xe8\xbd\xbd\xe4\xb8\xad... / Loading...</div>\n        </div>\n        <div class="dropdown-footer">\n            <a href="/reports/notifications/">\xe6\x9f\xa5\xe7\x9c\x8b\xe5\x85\xa8\xe9\x83\xa8 / View All</a>\n        </div>\n    </div>\n</div>\n\n<style>\n    .notification-center {\n        position: relative;\n    }\n    .icon-btn {\n        padding: 8px;\n        border-radius: 50%;\n        position: relative;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        width: 40px;\n        height: 40px;\n    }\n    .badge {\n        position: absolute;\n        top: -2px;\n        right: -2px;\n        background: #ef4444;\n        color: white;\n        font-size: 10px;\n        font-weight: bold;\n        padding: 2px 5px;\n        border-radius: 10px;\n        min-width: 18px;\n        text-align: center;\n        border: 2px solid #fff;\n    }\n    .badge.pulse {\n        animation: pulse-animation 1s infinite;\n    }\n    @keyframes pulse-animation {\n        0% { transform: scale(1); }\n        50% { transform: scale(1.2); }\n        100% { transform: scale(1); }\n    }\n    .notification-dropdown {\n        position: absolute;\n        top: 110%;\n        right: -80px; /* Adjust alignment */\n        width: 360px;\n        background: #fff;\n        border-radius: 12px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15);\n        border: 1px solid rgba(0,0,0,0.05);\n        display: none;\n        flex-direction: column;\n        z-index: 1000;\n        max-height: 500px;\n    }\n    .notification-dropdown.open {\n        display: flex;\n    }\n    .dropdown-header {\n        padding: 12px 16px;\n        border-bottom: 1px solid #f1f5f9;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    .dropdown-header h3 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 700;\n    }\n    .text-btn {\n        background: none;\n        border: none;\n        color: #3b82f6;\n        font-size: 12px;\n        cursor: pointer;\n        padding: 0;\n    }\n    .text-btn:hover {\n        text-decoration: underline;\n    }\n    .notification-list {\n        overflow-y: auto;\n        flex: 1;\n        max-height: 400px;\n    }\n    .notification-item {\n        padding: 12px 16px;\n        border-bottom: 1px solid #f8fafc;\n        cursor: pointer;\n        transition: background 0.2s;\n        display: flex;\n        gap: 12px;\n        align-items: flex-start;\n    }\n    .notification-item:hover {\n        background: #f8fafc;\n    }\n    .notification-item.unread {\n        background: #eff6ff;\n    }\n    .notification-item.unread:hover {\n        background: #e0f2fe;\n    }\n    .notif-icon {\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        background: #f1f5f9;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n    }\n    .notif-content {\n        flex: 1;\n    }\n    .notif-title {\n        font-size: 13px;\n        font-weight: 600;\n        margin-bottom: 4px;\n        color: #0f172a;\n    }\n    .notif-msg {\n        font-size: 12px;\n        color: #64748b;\n        line-height: 1.4;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        overflow: hidden;\n    }\n    .notif-time {\n        font-size: 11px;\n        color: #94a3b8;\n        margin-top: 4px;\n    }\n    .dropdown-footer {\n        padding: 10px;\n        text-align: center;\n        border-top: 1px solid #f1f5f9;\n        background: #f8fafc;\n        border-radius: 0 0 12px 12px;\n    }\n    .dropdown-footer a {\n        font-size: 12px;\n        color: #64748b;\n        text-decoration: none;\n    }\n    .empty-state {\n        padding: 20px;\n        text-align: center;\n        color: #94a3b8;\n        font-size: 13px;\n    }\n    \n    @media (max-width: 640px) {\n        .notification-dropdown {\n            position: fixed;\n            top: 60px;\n            left: 10px;\n            right: 10px;\n            width: auto;\n        }\n    }\n</style>\n\n<script>\n    document.addEventListener(\'DOMContentLoaded\', function() {\n        const bellBtn = document.getElementById(\'bell-btn\');\n        const dropdown = document.getElementById(\'notification-dropdown\');\n        const list = document.getElementById(\'notification-list\');\n        const badge = document.getElementById(\'notification-badge\');\n        const markAllBtn = document.getElementById(\'mark-all-read\');\n        let socket = null;\n        let isOpen = false;\n\n        // Toggle Dropdown\n        bellBtn.addEventListener(\'click\', (e) => {\n            e.stopPropagation();\n            isOpen = !isOpen;\n            dropdown.classList.toggle(\'open\', isOpen);\n            if (isOpen) {\n                fetchNotifications();\n            }\n        });\n\n        // Close when clicking outside\n        document.addEventListener(\'click\', (e) => {\n            if (isOpen && !dropdown.contains(e.target) && !bellBtn.contains(e.target)) {\n                isOpen = false;\n                dropdown.classList.remove(\'open\');\n            }\n        });\n\n        // Fetch Notifications via API\n        function fetchNotifications() {\n            fetch("/reports/api/notifications/list/")\n                .then(response => response.json())\n                .then(data => {\n                    renderList(data.notifications);\n                    updateBadge(data.unread_count);\n                });\n        }\n\n        function updateBadge(count) {\n            if (count > 0) {\n                badge.textContent = count > 99 ? \'99+\' : count;\n                badge.style.display = \'block\';\n                // Add pulse animation\n                badge.classList.add(\'pulse\');\n                setTimeout(() => badge.classList.remove(\'pulse\'), 1000);\n            } else {\n                badge.style.display = \'none\';\n            }\n        }\n\n        function renderList(notifications) {\n            if (notifications.length === 0) {\n                list.innerHTML = \'<div class="empty-state">\xe6\x9a\x82\xe6\x97\xa0\xe9\x80\x9a\xe7\x9f\xa5 / No notifications</div>\';\n                return;\n            }\n            list.innerHTML = notifications.map(n => `\n                <div class="notification-item ${n.is_read ? \'\' : \'unread\'} ${n.priority === \'high\' ? \'priority-high\' : \'\'}" onclick="handleNotificationClick(${n.id}, \'${n.notification_type}\', \'${n.data?.task_id || \'\'}\')">\n                    <div class="notif-icon">\n                        ${getIcon(n.notification_type, n.priority)}\n                    </div>\n                    <div class="notif-content">\n                        <div class="notif-title">\n                            ${n.priority === \'high\' ? \'<span style="color:#ef4444;margin-right:2px;">!</span>\' : \'\'}\n                            ${n.title}\n                        </div>\n                        <div class="notif-msg">${n.message}</div>\n                        <div class="notif-time">${n.time_since}</div>\n                    </div>\n                </div>\n            `).join(\'\');\n        }\n\n        function getIcon(type, priority) {\n            if (priority === \'high\') return \'\xe2\x9a\xa0\xef\xb8\x8f\';\n            // Simple SVG icons based on type\n            if (type === \'task_assigned\') return \'\xf0\x9f\x93\x8b\';\n            if (type === \'task_mention\') return \'@\';\n            if (type === \'task_updated\') return \'\xf0\x9f\x93\x9d\';\n            return \'\xf0\x9f\x94\x94\';\n        }\n\n        // WebSocket Connection\n        function connectWebSocket() {\n            const protocol = window.location.protocol === \'https:\' ? \'wss:\' : \'ws:\';\n            socket = new WebSocket(protocol + \'//\' + window.location.host + \'/ws/notifications/\');\n\n            socket.onopen = function(e) {\n                // console.log(\'Notification WebSocket connected\');\n            };\n\n            socket.onmessage = function(e) {\n                const data = JSON.parse(e.data);\n                // console.log(\'New notification:\', data);\n                \n                // Show badge increment\n                const current = parseInt(badge.textContent) || 0;\n                updateBadge(current + 1);\n                \n                // If open, prepend to list\n                if (isOpen) {\n                    // Re-fetch is easiest to keep sort order and format consistent\n                    fetchNotifications(); \n                }\n                \n                // Optional: Sound or Toast\n                playNotificationSound();\n            };\n\n            socket.onclose = function(e) {\n                console.error(\'WebSocket closed. Reconnecting in 5s...\');\n                setTimeout(connectWebSocket, 5000);\n            };\n        }\n\n        function playNotificationSound() {\n            // Simple beep or check user preference\n            // Audio context logic here if needed\n        }\n\n        // Mark All Read\n        markAllBtn.addEventListener(\'click\', () => {\n            fetch("/reports/api/notifications/mark-read/", {\n                method: \'POST\',\n                headers: {\n                    \'X-CSRFToken\': \'MLEneUix4surBn5iG81tGpu8WocmrpKvv1vATz8iuPyeqiWnRd0tMf0NISFHkdtd\'\n                }\n            }).then(() => {\n                fetchNotifications();\n            });\n        });\n\n        // Initialize\n        if ("True" === "True") {\n            fetchNotifications(); // Initial fetch for badge\n            connectWebSocket();\n        }\n\n        // Global handler for click (needs to be attached to window or handled via event delegation above)\n        window.handleNotificationClick = function(id, type, targetId) {\n            // Mark read\n            fetch(`/reports/api/notifications/${id}/mark-read/`, {\n                method: \'POST\',\n                headers: {\n                    \'X-CSRFToken\': \'MLEneUix4surBn5iG81tGpu8WocmrpKvv1vATz8iuPyeqiWnRd0tMf0NISFHkdtd\'\n                }\n            }).then(() => {\n                // Redirect logic\n                if (type.startsWith(\'task\') && targetId) {\n                    window.location.href = `/tasks/${targetId}/view/`;\n                } else {\n                    // Default redirect or just refresh\n                    fetchNotifications();\n                }\n            });\n        };\n    });\n</script>\n\n            <a class="user-center " href="/accounts/settings/">\n                <div class="user-avatar">\n                    \n                        \n                            T\n                        \n                    \n                </div>\n                <div class="user-meta">\n                    <div class="user-name">testuser @testuser</div>\n                    <div class="user-sub">\xe4\xb8\xaa\xe4\xba\xba\xe4\xb8\xad\xe5\xbf\x83 \xc2\xb7 Settings</div>\n                </div>\n                <span class="user-chevron" aria-hidden="true">\xe2\x86\x92</span>\n            </a>\n            <a class="pill" href="#" onclick="event.preventDefault(); document.getElementById(\'logout-form\').submit();">\xe9\x80\x80\xe5\x87\xba\xe7\x99\xbb\xe5\xbd\x95 / Logout</a>\n            <form id="logout-form" action="/accounts/logout/" method="post" style="display: none;">\n                <input type="hidden" name="csrfmiddlewaretoken" value="MLEneUix4surBn5iG81tGpu8WocmrpKvv1vATz8iuPyeqiWnRd0tMf0NISFHkdtd">\n            </form>\n        \n    </div>\n</header>\n<script>\n    (function () {\n        const toggle = document.getElementById(\'nav-toggle\');\n        const actions = document.getElementById(\'nav-actions\');\n        const adminToggle = document.getElementById(\'admin-toggle\');\n        const adminMenu = document.getElementById(\'admin-menu\');\n        if (!toggle || !actions) return;\n        toggle.addEventListener(\'click\', () => {\n            actions.classList.toggle(\'open\');\n        });\n\n        if (adminToggle && adminMenu) {\n            adminToggle.addEventListener(\'click\', (e) => {\n                e.stopPropagation();\n                adminMenu.classList.toggle(\'open\');\n            });\n            document.addEventListener(\'click\', () => {\n                adminMenu.classList.remove(\'open\');\n            });\n        }\n    })();\n</script>\n\n<style>\n    .topbar {\n        /* position: relative;  Removed to allow sticky from base_topbar */\n        z-index: 40;\n        overflow: visible;\n    }\n    .topbar .actions {\n        overflow: visible;\n    }\n    .admin-dropdown {\n        position: relative;\n        overflow: visible;\n    }\n    .admin-toggle {\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n    }\n    .admin-menu {\n        position: absolute;\n        top: 110%;\n        right: 0;\n        min-width: 200px;\n        background: rgba(255,255,255,0.98);\n        border: 1px solid rgba(226,232,240,0.9);\n        border-radius: 10px;\n        box-shadow: 0 12px 30px rgba(15,23,42,0.12);\n        padding: 8px;\n        display: none;\n        z-index: 999;\n    }\n    .admin-menu.open {\n        display: grid;\n        gap: 6px;\n    }\n    .admin-menu a {\n        padding: 8px 10px;\n        border-radius: 8px;\n        color: #0f172a;\n        text-decoration: none;\n        font-size: 13px;\n    }\n    .admin-menu a:hover,\n    .admin-menu a.active {\n        background: rgba(37,99,235,0.08);\n        color: #1d4ed8;\n    }\n    .user-center {\n        display: inline-flex;\n        align-items: center;\n        gap: 10px;\n        padding: 10px 14px;\n        border-radius: 14px;\n        border: 1px solid rgba(59,130,246,0.16);\n        background: linear-gradient(135deg, rgba(255,255,255,0.92), rgba(248,250,252,0.9));\n        box-shadow: 0 8px 20px rgba(59,130,246,0.12);\n        color: #0f172a;\n        text-decoration: none;\n        min-width: 180px;\n        position: relative;\n        overflow: hidden;\n        transition: all 0.3s ease;\n    }\n    .user-center::before {\n        content: \'\';\n        position: absolute;\n        inset: 0;\n        background: linear-gradient(135deg, rgba(59,130,246,0.08), rgba(6,182,212,0.08));\n        opacity: 0;\n        transition: opacity 0.3s ease;\n    }\n    .user-center:hover::before,\n    .user-center.active::before {\n        opacity: 1;\n    }\n    .user-center:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 12px 28px rgba(59,130,246,0.16);\n    }\n    .user-center .user-avatar {\n        width: 38px;\n        height: 38px;\n        border-radius: 12px;\n        overflow: hidden;\n        background: linear-gradient(135deg, #2563eb, #3b82f6, #06b6d4);\n        color: #fff;\n        display: grid;\n        place-items: center;\n        font-weight: 800;\n        letter-spacing: 0.02em;\n        box-shadow: inset 0 0 0 2px rgba(255,255,255,0.35);\n        position: relative;\n        z-index: 1;\n    }\n    .user-center .user-meta {\n        display: grid;\n        gap: 2px;\n        z-index: 1;\n    }\n    .user-center .user-name {\n        font-weight: 700;\n        font-size: 14px;\n        color: #0f172a;\n    }\n    .user-center .user-sub {\n        font-size: 12px;\n        color: #64748b;\n    }\n    .user-center .user-chevron {\n        margin-left: auto;\n        color: #3b82f6;\n        font-weight: 700;\n        z-index: 1;\n    }\n    @media (max-width: 860px) {\n        .admin-menu {\n            position: static;\n            box-shadow: none;\n            border: 1px dashed rgba(226,232,240,0.9);\n        }\n        .user-center {\n            width: 100%;\n        }\n    }\n</style>\n\n\n    <main class="content">\n        \n        \n<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>\n\n<div class="page-container dashboard-container">\n\n    <!-- 1. Filter Section -->\n    <form method="get" class="filter-section" id="filterForm">\n        <div class="filter-group" style="flex: 2; min-width: 300px;">\n            <label class="filter-label">\xe7\xbb\x9f\xe8\xae\xa1\xe5\x91\xa8\xe6\x9c\x9f / Time Period</label>\n            <div class="period-selector">\n                <button type="button" class="period-btn " onclick="setPeriod(\'today\')">\xe4\xbb\x8a\xe6\x97\xa5 / Today</button>\n                <button type="button" class="period-btn " onclick="setPeriod(\'week\')">\xe6\x9c\xac\xe5\x91\xa8 / Week</button>\n                <button type="button" class="period-btn active" onclick="setPeriod(\'month\')">\xe6\x9c\xac\xe6\x9c\x88 / Month</button>\n                <button type="button" class="period-btn " onclick="setPeriod(\'year\')">\xe4\xbb\x8a\xe5\xb9\xb4 / Year</button>\n                <button type="button" class="period-btn " onclick="toggleCustomDate()">\xe8\x87\xaa\xe5\xae\x9a\xe4\xb9\x89 / Custom</button>\n            </div>\n            <input type="hidden" name="period" id="periodInput" value="month">\n        </div>\n\n        <div class="filter-group" id="customDateGroup" style="display:none; flex-direction: row; gap: 12px; flex: 1;">\n            <div style="flex: 1;">\n                <label class="filter-label">\xe5\xbc\x80\xe5\xa7\x8b\xe6\x97\xa5\xe6\x9c\x9f / Start Date</label>\n                <input type="date" name="start" class="form-control" value="2026-02-01">\n            </div>\n            <div style="flex: 1;">\n                <label class="filter-label">\xe7\xbb\x93\xe6\x9d\x9f\xe6\x97\xa5\xe6\x9c\x9f / End Date</label>\n                <input type="date" name="end" class="form-control" value="2026-02-15">\n            </div>\n        </div>\n\n        <div class="filter-group" style="flex: 1;">\n            <label class="filter-label">\xe6\x89\x80\xe5\xb1\x9e\xe9\xa1\xb9\xe7\x9b\xae / Project</label>\n            <select name="project" class="form-control" onchange="this.form.submit()">\n                <option value="">\xe5\x85\xa8\xe9\x83\xa8\xe9\xa1\xb9\xe7\x9b\xae / All Projects</option>\n                \n                <option value="1" >Test Project</option>\n                \n            </select>\n        </div>\n\n        <div class="filter-group" style="flex: 1;">\n            <label class="filter-label">\xe8\xa7\x92\xe8\x89\xb2 / Role</label>\n            <select name="role" class="form-control" onchange="this.form.submit()">\n                <option value="">\xe5\x85\xa8\xe9\x83\xa8\xe8\xa7\x92\xe8\x89\xb2 / All Roles</option>\n                \n                <option value="dev" >\xe5\xbc\x80\xe5\x8f\x91 / Developer</option>\n                \n                <option value="qa" >\xe6\xb5\x8b\xe8\xaf\x95 / QA</option>\n                \n                <option value="pm" >\xe4\xba\xa7\xe5\x93\x81 / Product Manager</option>\n                \n                <option value="ui" >\xe8\xae\xbe\xe8\xae\xa1 / UI / UX</option>\n                \n                <option value="ops" >\xe8\xbf\x90\xe7\xbb\xb4 / Ops</option>\n                \n                <option value="mgr" >\xe9\xa1\xb9\xe7\x9b\xae\xe7\xae\xa1\xe7\x90\x86 / PM / PMO</option>\n                \n            </select>\n        </div>\n        \n        <div class="filter-group" style="width: 200px;">\n             <label class="filter-label">\xe6\x90\x9c\xe7\xb4\xa2 / Search</label>\n             <input type="text" name="q" class="form-control" placeholder="\xe6\x90\x9c\xe7\xb4\xa2\xe7\x94\xa8\xe6\x88\xb7..." value="" onblur="this.form.submit()">\n        </div>\n    </form>\n\n    <!-- 2. KPI Overview -->\n    <div class="kpi-row">\n        <!-- New Tasks -->\n        <div class="kpi-card">\n            <div class="kpi-header">\n                <div class="kpi-icon-wrapper bg-blue-subtle text-primary" style="background: #eff6ff; color: #3b82f6;">\n                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>\n                </div>\n                <div class="trend-badge trend-up">\n                    \xe2\x86\x91 0%\n                </div>\n            </div>\n            <div class="kpi-value">0</div>\n            <div class="kpi-title">\xe6\x96\xb0\xe5\xa2\x9e\xe4\xbb\xbb\xe5\x8a\xa1 / Created</div>\n            <div class="kpi-footer text-muted">\n                \xe5\xaf\xb9\xe6\xaf\x94\xe4\xb8\x8a\xe4\xb8\xaa\xe5\x91\xa8\xe6\x9c\x9f / vs last period\n            </div>\n        </div>\n\n        <!-- Completed -->\n        <div class="kpi-card">\n            <div class="kpi-header">\n                <div class="kpi-icon-wrapper bg-green-subtle text-success" style="background: #ecfdf5; color: #10b981;">\n                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>\n                </div>\n                <div class="trend-badge trend-up">\n                    \xe2\x86\x91 0%\n                </div>\n            </div>\n            <div class="kpi-value">0</div>\n            <div class="kpi-title">\xe5\xb7\xb2\xe5\xae\x8c\xe6\x88\x90 / Completed</div>\n            <div class="kpi-footer text-muted">\n                \xe5\x90\x9e\xe5\x90\x90\xe7\x8e\x87 / Throughput: 0%\n            </div>\n        </div>\n\n        <!-- On-Time Rate -->\n        <div class="kpi-card">\n            <div class="kpi-header">\n                <div class="kpi-icon-wrapper bg-purple-subtle" style="background: #f3e8ff; color: #9333ea;">\n                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>\n                </div>\n                <div class="trend-badge trend-up">\n                    \xe2\x86\x91 0%\n                </div>\n            </div>\n            <div class="kpi-value">0%</div>\n            <div class="kpi-title">\xe6\x8c\x89\xe6\x97\xb6\xe4\xba\xa4\xe4\xbb\x98\xe7\x8e\x87 / On-Time Rate</div>\n            <div class="kpi-footer text-muted">\n                SLA \xe8\xbe\xbe\xe6\xa0\x87\xe6\x83\x85\xe5\x86\xb5 / SLA Met\n            </div>\n        </div>\n        \n        <!-- Avg Time -->\n        <div class="kpi-card">\n            <div class="kpi-header">\n                <div class="kpi-icon-wrapper bg-orange-subtle" style="background: #fff7ed; color: #f97316;">\n                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>\n                </div>\n                <div class="trend-badge trend-neutral">\n                    0h\n                </div>\n            </div>\n            <div class="kpi-value">0<span style="font-size: 16px; font-weight: 500;">h</span></div>\n            <div class="kpi-title">\xe5\xb9\xb3\xe5\x9d\x87\xe8\x80\x97\xe6\x97\xb6 / Avg Time</div>\n            <div class="kpi-footer text-muted">\n                \xe4\xbb\x8e\xe5\x88\x9b\xe5\xbb\xba\xe5\x88\xb0\xe5\xae\x8c\xe6\x88\x90 / Create to Done\n            </div>\n        </div>\n\n        <!-- Overdue -->\n        <div class="kpi-card" style="border-color: #fecaca;">\n            <div class="kpi-header">\n                <div class="kpi-icon-wrapper bg-red-subtle text-danger" style="background: #fef2f2; color: #ef4444;">\n                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>\n                </div>\n                <div class="trend-badge trend-down" style="background: #fee2e2; color: #b91c1c;">\n                    Attention\n                </div>\n            </div>\n            <div class="kpi-value text-danger">0</div>\n            <div class="kpi-title text-danger">\xe5\xbd\x93\xe5\x89\x8d\xe9\x80\xbe\xe6\x9c\x9f / Overdue</div>\n            <div class="kpi-footer text-danger">\n                \xe9\x9c\x80\xe8\xa6\x81\xe7\xab\x8b\xe5\x8d\xb3\xe5\xa4\x84\xe7\x90\x86 / Action Required\n            </div>\n        </div>\n    </div>\n\n    <!-- 3. Charts -->\n    <div class="chart-grid">\n        <!-- Main Trend -->\n        <div class="chart-card">\n            <div class="chart-header">\n                <div class="chart-title">\xe8\xb6\x8b\xe5\x8a\xbf\xe5\x88\x86\xe6\x9e\x90 / Trend Analysis</div>\n                <div class="chart-legend">\n                    <div class="legend-item"><div class="legend-dot" style="background: #3b82f6;"></div> \xe6\x96\xb0\xe5\xa2\x9e Created</div>\n                    <div class="legend-item"><div class="legend-dot" style="background: #10b981;"></div> \xe5\xae\x8c\xe6\x88\x90 Completed</div>\n                </div>\n            </div>\n            <div style="flex: 1; position: relative;">\n                <canvas id="trendChart"></canvas>\n            </div>\n        </div>\n\n        <!-- Distribution -->\n        <div class="chart-card">\n            <div class="chart-header">\n                <div class="chart-title">\xe7\x8a\xb6\xe6\x80\x81\xe5\x88\x86\xe5\xb8\x83 / Status</div>\n            </div>\n            <div style="flex: 1; position: relative; display: flex; justify-content: center;">\n                <canvas id="distChart"></canvas>\n            </div>\n            <div style="margin-top: 20px; text-align: center; font-size: 13px; color: var(--text-secondary);">\n                \xe5\xbd\x93\xe5\x89\x8d\xe6\xb4\xbb\xe8\xb7\x83\xe4\xbb\xbb\xe5\x8a\xa1\xe5\x88\x86\xe5\xb8\x83 (Active Tasks)\n            </div>\n        </div>\n    </div>\n\n    <!-- 4. Detailed Stats Tables -->\n    <div class="table-card">\n        <div class="table-tabs">\n            <div class="tab-item active" onclick="switchTab(\'user\', this)">\xe4\xba\xba\xe5\x91\x98\xe7\xbb\xa9\xe6\x95\x88 / Team Performance</div>\n            <div class="tab-item" onclick="switchTab(\'project\', this)">\xe9\xa1\xb9\xe7\x9b\xae\xe6\xa6\x82\xe5\x86\xb5 / Project Health</div>\n            <div style="margin-left: auto; display: flex; align-items: center;">\n                <a href="/tasks/admin/stats/export/?" class="btn btn-sm btn-outline-primary" style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 6px; font-weight: 500;">\n                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>\n                    \xe5\xaf\xbc\xe5\x87\xba\xe6\x8a\xa5\xe8\xa1\xa8 / Export Report\n                </a>\n            </div>\n        </div>\n\n        <!-- User Table -->\n        <div id="tab-user" class="tab-content">\n            <div class="table-container">\n                <table class="data-table">\n                    <thead>\n                        <tr>\n                            <th style="width: 250px;">\xe6\x88\x90\xe5\x91\x98 / Member</th>\n                            <th class="text-center">\xe6\x80\xbb\xe4\xbb\xbb\xe5\x8a\xa1 / Total</th>\n                            <th class="text-center">\xe5\xb7\xb2\xe5\xae\x8c\xe6\x88\x90 / Done</th>\n                            <th class="text-center">\xe6\x8c\x89\xe6\x97\xb6\xe4\xba\xa4\xe4\xbb\x98 / On-Time</th>\n                            <th style="width: 200px;">\xe5\xae\x8c\xe6\x88\x90\xe7\x8e\x87 / Completion Rate</th>\n                            <th class="text-center">\xe9\x80\xbe\xe6\x9c\x9f / Overdue</th>\n                            <th class="text-center">\xe5\xb9\xb3\xe5\x9d\x87\xe8\x80\x97\xe6\x97\xb6 / Avg Time</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        \n                        <tr><td colspan="7" class="text-center text-muted" style="padding: 40px;">\xe6\x9a\x82\xe6\x97\xa0\xe6\x95\xb0\xe6\x8d\xae / No Data</td></tr>\n                        \n                    </tbody>\n                </table>\n            </div>\n        </div>\n\n        <!-- Project Table -->\n        <div id="tab-project" class="tab-content" style="display: none;">\n            <div class="table-container">\n                <table class="data-table">\n                    <thead>\n                        <tr>\n                            <th style="width: 300px;">\xe9\xa1\xb9\xe7\x9b\xae\xe5\x90\x8d\xe7\xa7\xb0 / Project</th>\n                            <th class="text-center">\xe4\xbb\xbb\xe5\x8a\xa1\xe6\x80\xbb\xe6\x95\xb0 / Total</th>\n                            <th class="text-center">\xe5\xb7\xb2\xe5\xae\x8c\xe6\x88\x90 / Done</th>\n                            <th style="width: 200px;">\xe8\xbf\x9b\xe5\xba\xa6 / Progress</th>\n                            <th class="text-center">\xe9\x80\xbe\xe6\x9c\x9f / Overdue</th>\n                            <th class="text-center">\xe5\xb9\xb3\xe5\x9d\x87\xe8\x80\x97\xe6\x97\xb6 / Avg Time</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        \n                        <tr><td colspan="6" class="text-center text-muted" style="padding: 40px;">\xe6\x9a\x82\xe6\x97\xa0\xe6\x95\xb0\xe6\x8d\xae / No Data</td></tr>\n                        \n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n\n</div>\n\n<!-- Data Injection -->\n<script id="chart-labels" type="application/json">["02-01", "02-02", "02-03", "02-04", "02-05", "02-06", "02-07", "02-08", "02-09", "02-10", "02-11", "02-12", "02-13", "02-14", "02-15"]</script>\n<script id="chart-created" type="application/json">[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</script>\n<script id="chart-completed" type="application/json">[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</script>\n<script id="chart-status" type="application/json">[]</script>\n\n<script>\n    // --- 1. Filter Logic ---\n    function setPeriod(p) {\n        document.getElementById(\'periodInput\').value = p;\n        document.getElementById(\'filterForm\').submit();\n    }\n    \n    function toggleCustomDate() {\n        const group = document.getElementById(\'customDateGroup\');\n        if (group.style.display === \'none\') {\n            group.style.display = \'flex\';\n            document.getElementById(\'periodInput\').value = \'custom\';\n        } else {\n            group.querySelector(\'input\').focus();\n        }\n    }\n\n    // --- 2. Tab Logic ---\n    function switchTab(tabId, btn) {\n        document.querySelectorAll(\'.tab-content\').forEach(el => el.style.display = \'none\');\n        document.getElementById(\'tab-\' + tabId).style.display = \'block\';\n        \n        document.querySelectorAll(\'.tab-item\').forEach(item => item.classList.remove(\'active\'));\n        btn.classList.add(\'active\');\n    }\n\n    // --- 3. Chart Logic ---\n    document.addEventListener(\'DOMContentLoaded\', function() {\n        Chart.defaults.font.family = "\'Inter\', \'System-UI\', \'sans-serif\'";\n        Chart.defaults.color = \'#64748b\';\n\n        // Trend Chart\n        const ctxTrend = document.getElementById(\'trendChart\').getContext(\'2d\');\n        const gradientCreated = ctxTrend.createLinearGradient(0, 0, 0, 400);\n        gradientCreated.addColorStop(0, \'rgba(59, 130, 246, 0.2)\');\n        gradientCreated.addColorStop(1, \'rgba(59, 130, 246, 0)\');\n\n        const gradientCompleted = ctxTrend.createLinearGradient(0, 0, 0, 400);\n        gradientCompleted.addColorStop(0, \'rgba(16, 185, 129, 0.2)\');\n        gradientCompleted.addColorStop(1, \'rgba(16, 185, 129, 0)\');\n\n        new Chart(ctxTrend, {\n            type: \'line\',\n            data: {\n                labels: JSON.parse(document.getElementById(\'chart-labels\').textContent),\n                datasets: [\n                    {\n                        label: \'\xe6\x96\xb0\xe5\xa2\x9e / Created\',\n                        data: JSON.parse(document.getElementById(\'chart-created\').textContent),\n                        borderColor: \'#3b82f6\',\n                        backgroundColor: gradientCreated,\n                        borderWidth: 3,\n                        pointBackgroundColor: \'#fff\',\n                        pointBorderColor: \'#3b82f6\',\n                        pointBorderWidth: 2,\n                        tension: 0.4,\n                        fill: true\n                    },\n                    {\n                        label: \'\xe5\xae\x8c\xe6\x88\x90 / Completed\',\n                        data: JSON.parse(document.getElementById(\'chart-completed\').textContent),\n                        borderColor: \'#10b981\',\n                        backgroundColor: gradientCompleted,\n                        borderWidth: 3,\n                        pointBackgroundColor: \'#fff\',\n                        pointBorderColor: \'#10b981\',\n                        pointBorderWidth: 2,\n                        tension: 0.4,\n                        fill: true\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                maintainAspectRatio: false,\n                interaction: { mode: \'index\', intersect: false },\n                plugins: {\n                    legend: { display: false }, // Custom legend\n                    tooltip: {\n                        backgroundColor: \'rgba(255, 255, 255, 0.95)\',\n                        titleColor: \'#1e293b\',\n                        bodyColor: \'#475569\',\n                        borderColor: \'#e2e8f0\',\n                        borderWidth: 1,\n                        padding: 12,\n                        boxPadding: 4,\n                        titleFont: { size: 13, weight: 600 },\n                        bodyFont: { size: 12 },\n                        displayColors: true,\n                        callbacks: {\n                            labelTextColor: () => \'#475569\'\n                        }\n                    }\n                },\n                scales: {\n                    y: { \n                        grid: { borderDash: [4, 4], color: \'#f1f5f9\' }, \n                        beginAtZero: true,\n                        ticks: { font: { size: 11 } }\n                    },\n                    x: { \n                        grid: { display: false },\n                        ticks: { font: { size: 11 } }\n                    }\n                }\n            }\n        });\n\n        // Dist Chart\n        const statusData = JSON.parse(document.getElementById(\'chart-status\').textContent);\n        const ctxDist = document.getElementById(\'distChart\').getContext(\'2d\');\n        \n        const statusColors = {\n            \'todo\': \'#94a3b8\',      // Grey\n            \'in_progress\': \'#3b82f6\', // Blue\n            \'blocked\': \'#ef4444\',     // Red\n            \'in_review\': \'#f59e0b\',   // Amber\n            \'done\': \'#10b981\',        // Green\n            \'closed\': \'#64748b\'       // Slate\n        };\n\n        new Chart(ctxDist, {\n            type: \'doughnut\',\n            data: {\n                labels: statusData.map(d => d.label),\n                datasets: [{\n                    data: statusData.map(d => d.value),\n                    backgroundColor: statusData.map(d => statusColors[d.code] || \'#cbd5e1\'),\n                    borderWidth: 2,\n                    borderColor: \'#ffffff\',\n                    hoverOffset: 4\n                }]\n            },\n            options: {\n                responsive: true,\n                maintainAspectRatio: false,\n                plugins: {\n                    legend: { position: \'right\', labels: { usePointStyle: true, boxWidth: 8, font: { size: 12 } } }\n                },\n                cutout: \'75%\'\n            }\n        });\n    });\n</script>\n\n    </main>\n</div>\n    \n    <script src="/static/js/command_palette.js"></script>\n</body>\n</html>\n'

----------------------------------------------------------------------
Ran 154 tests in 36.268s

FAILED (failures=4)
Destroying test database for alias 'default'...
Found 154 test(s).
Successfully loaded and rendered core_tags
Initializing templates from reports/data/definitions/test_roles.yaml for prod environment...
Created RoleTemplate: Test Dev Template (dev)
Processed 1/1 templates.
Successfully initialized all templates.
Initializing templates from reports/data/definitions/test_roles.yaml for prod environment...
Updated RoleTemplate: Test Dev Template (dev)
Processed 1/1 templates.
Successfully initialized all templates.
Initializing templates from reports/data/definitions/test_roles.yaml for prod environment...
Created RoleTemplate: Test Dev Template (dev)
Processed 1/1 templates.
Successfully initialized all templates.
Initializing templates from reports/data/definitions/test_roles.yaml for prod environment...
Created RoleTemplate: Test Dev Template (dev)
Skipping invalid role: invalid_role
Processed 2/2 templates.
Successfully initialized all templates.
Starting standard template initialization...
Successfully initialized all standard templates.
Manager delete response: 403
Total Logs: 1
Log: update - Details: {'diff': {'status': {'verbose_name': '状态', 'old': '待处理 / To Do', 'new': '进行中 / In Progress'}}}

--- Superuser Performance ---
Superuser Queries: 10

--- Manager Performance ---
Manager Queries: 13

--- Admin Task Stats Performance ---
Queries: 12

--- Performance Board Stats ---
Queries: 16

--- Teams View Performance ---
Queries: 12
SQL: SELECT "django_session"."session_key", "django_session"."session_data", "django_session"."expire_date" FROM "django_session" WHERE ("django_session"."expire_date" > '2026-02-15 05:44:26.931733' AND "django_session"."session_key" = 'xgz6qvacvbe2o7zhz4vl73qeijeuzbd8') LIMIT 21
SQL: SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21
SQL: SELECT COUNT(*) AS "__count" FROM "auth_user"
SQL: SELECT COUNT(*) FROM (SELECT "projects_project"."id" AS "col1" FROM "projects_project" LEFT OUTER JOIN "projects_project_members" ON ("projects_project"."id" = "projects_project_members"."project_id") LEFT OUTER JOIN "projects_project_managers" ON ("projects_project"."id" = "projects_project_managers"."project_id") WHERE "projects_project"."is_active" GROUP BY 1) subquery
SQL: SELECT "projects_project_members"."project_id" AS "project_memberships", "core_profile"."position" AS "profile__position", COUNT("auth_user"."id") AS "count" FROM "auth_user" INNER JOIN "projects_project_members" ON ("auth_user"."id" = "projects_project_members"."user_id") LEFT OUTER JOIN "core_profile" ON ("auth_user"."id" = "core_profile"."user_id") WHERE "projects_project_members"."project_id" IN (SELECT U0."id" FROM "projects_project" U0 LEFT OUTER JOIN "projects_project_members" U1 ON (U0."id" = U1."project_id") LEFT OUTER JOIN "projects_project_managers" U3 ON (U0."id" = U3."project_id") WHERE U0."is_active" GROUP BY U0."id", U0."name" ORDER BY U0."name" ASC LIMIT 20) GROUP BY 1, 2
SQL: SELECT "projects_project"."id", "projects_project"."name", "projects_project"."code", "projects_project"."description", "projects_project"."start_date", "projects_project"."end_date", "projects_project"."owner_id", "projects_project"."is_active", "projects_project"."sla_hours", "projects_project"."current_phase_id", "projects_project"."overall_progress", "projects_project"."progress_note", "projects_project"."created_at", COUNT(DISTINCT "projects_project_members"."user_id") AS "member_count", COUNT(DISTINCT "projects_project_managers"."user_id") AS "manager_count", T6."id", T6."password", T6."last_login", T6."is_superuser", T6."username", T6."first_name", T6."last_name", T6."email", T6."is_staff", T6."is_active", T6."date_joined" FROM "projects_project" LEFT OUTER JOIN "projects_project_members" ON ("projects_project"."id" = "projects_project_members"."project_id") LEFT OUTER JOIN "projects_project_managers" ON ("projects_project"."id" = "projects_project_managers"."project_id") LEFT OUTER JOIN "auth_user" T6 ON ("projects_project"."owner_id" = T6."id") WHERE "projects_project"."is_active" GROUP BY "projects_project"."id", "projects_project"."name", "projects_project"."code", "projects_project"."description", "projects_project"."start_date", "projects_project"."end_date", "projects_project"."owner_id", "projects_project"."is_active", "projects_project"."sla_hours", "projects_project"."current_phase_id", "projects_project"."overall_progress", "projects_project"."progress_note", "projects_project"."created_at", T6."id", T6."password", T6."last_login", T6."is_superuser", T6."username", T6."first_name", T6."last_name", T6."email", T6."is_staff", T6."is_active", T6."date_joined" ORDER BY "projects_project"."name" ASC LIMIT 20
SQL: SELECT COUNT(*) AS "__count" FROM "auth_user"
SQL: SELECT "core_profile"."id", "core_profile"."user_id", "core_profile"."position", "core_profile"."employment_status", "core_profile"."hire_date", "core_profile"."probation_months", "core_profile"."probation_salary", "core_profile"."official_salary", "core_profile"."salary_currency", "core_profile"."intermediary_company", "core_profile"."intermediary_fee_amount", "core_profile"."intermediary_fee_currency", "core_profile"."resignation_date", "core_profile"."hr_note" FROM "core_profile" WHERE "core_profile"."user_id" = 1 LIMIT 21
SQL: SELECT "core_userpreference"."id", "core_userpreference"."user_id", "core_userpreference"."data", "core_userpreference"."updated_at" FROM "core_userpreference" WHERE "core_userpreference"."user_id" = 1 LIMIT 21
SQL: SELECT "projects_project"."id", "projects_project"."name", "projects_project"."code", "projects_project"."description", "projects_project"."start_date", "projects_project"."end_date", "projects_project"."owner_id", "projects_project"."is_active", "projects_project"."sla_hours", "projects_project"."current_phase_id", "projects_project"."overall_progress", "projects_project"."progress_note", "projects_project"."created_at" FROM "projects_project" WHERE "projects_project"."is_active" ORDER BY "projects_project"."name" ASC
SQL: SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined", "core_profile"."id", "core_profile"."user_id", "core_profile"."position", "core_profile"."employment_status", "core_profile"."hire_date", "core_profile"."probation_months", "core_profile"."probation_salary", "core_profile"."official_salary", "core_profile"."salary_currency", "core_profile"."intermediary_company", "core_profile"."intermediary_fee_amount", "core_profile"."intermediary_fee_currency", "core_profile"."resignation_date", "core_profile"."hr_note", "core_userpreference"."id", "core_userpreference"."user_id", "core_userpreference"."data", "core_userpreference"."updated_at" FROM "auth_user" LEFT OUTER JOIN "core_profile" ON ("auth_user"."id" = "core_profile"."user_id") LEFT OUTER JOIN "core_userpreference" ON ("auth_user"."id" = "core_userpreference"."user_id") ORDER BY "auth_user"."username" ASC LIMIT 20
SQL: SELECT ("projects_project_members"."user_id") AS "_prefetch_related_val_user_id", "projects_project"."id", "projects_project"."name", "projects_project"."code", "projects_project"."description", "projects_project"."start_date", "projects_project"."end_date", "projects_project"."owner_id", "projects_project"."is_active", "projects_project"."sla_hours", "projects_project"."current_phase_id", "projects_project"."overall_progress", "projects_project"."progress_note", "projects_project"."created_at" FROM "projects_project" INNER JOIN "projects_project_members" ON ("projects_project"."id" = "projects_project_members"."project_id") WHERE "projects_project_members"."user_id" IN (1, 2, 3, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 4, 22, 23, 24, 25, 26, 27) ORDER BY "projects_project"."name" ASC
